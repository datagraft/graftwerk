.git/COMMIT_EDITMSG:# On branch input-formatter
.git/COMMIT_EDITMSG:# Your branch is up-to-date with 'origin/input-formatter'.
.git/COMMIT_EDITMSG:#	new file:   maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1.jar
.git/config:[branch "rdf-formats"]
.git/config:	merge = refs/heads/rdf-formats
.git/config:[branch "input-formatter"]
.git/config:	merge = refs/heads/input-formatter
.git/FETCH_HEAD:d62fa8e24012ca998982f17de93dba757617f268	not-for-merge	branch 'experimental-js' of https://github.com/datagraft/graftwerk.git
.git/FETCH_HEAD:383e637772e9459e8dd1db6b15b6ce5830be874c	not-for-merge	branch 'input-formatter' of https://github.com/datagraft/graftwerk.git
.git/FETCH_HEAD:0db40c74e57e3c797d24abe689dcb2b2fb710f78	not-for-merge	branch 'rdf-formats' of https://github.com/datagraft/graftwerk.git
.git/FETCH_HEAD:0a31a9d38674f42df414edc5b7bf4de33dd60d11	not-for-merge	branch 'scalable-graftwerk' of https://github.com/datagraft/graftwerk.git
.git/FETCH_HEAD:f905452a4c2b6b6b873f8f5c8b92cbc1769e0856	not-for-merge	branch 'spark-test' of https://github.com/datagraft/graftwerk.git
.git/FETCH_HEAD:8eafbc2b4a95059af5d5534ddff633a7c99c6cfc	not-for-merge	branch 'upgraded-to-grafter0.7' of https://github.com/datagraft/graftwerk.git
.git/hooks/applypatch-msg.sample:# applypatch from an e-mail message.
.git/hooks/applypatch-msg.sample:# The hook should exit with non-zero status after issuing an
.git/hooks/applypatch-msg.sample:# To enable this hook, rename this file to "applypatch-msg".
.git/hooks/applypatch-msg.sample:. git-sh-setup
.git/hooks/applypatch-msg.sample:commitmsg="$(git rev-parse --git-path hooks/commit-msg)"
.git/hooks/applypatch-msg.sample:test -x "$commitmsg" && exec "$commitmsg" ${1+"$@"}
.git/hooks/commit-msg.sample:# that has the commit message.  The hook should exit with non-zero
.git/hooks/commit-msg.sample:# To enable this hook, rename this file to "commit-msg".
.git/hooks/commit-msg.sample:# Uncomment the below to add a Signed-off-by line to the message.
.git/hooks/commit-msg.sample:# Doing this in a hook is a bad idea in general, but the prepare-commit-msg
.git/hooks/commit-msg.sample:# SOB=$(git var GIT_AUTHOR_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
.git/hooks/commit-msg.sample:# grep -qs "^$SOB" "$1" || echo "$SOB" >> "$1"
.git/hooks/commit-msg.sample:# This example catches duplicate Signed-off-by lines.
.git/hooks/commit-msg.sample:test "" = "$(grep '^Signed-off-by: ' "$1" |
.git/hooks/commit-msg.sample:	 sort | uniq -c | sed -e '/^[ 	]*1[ 	]/d')" || {
.git/hooks/commit-msg.sample:	echo >&2 Duplicate Signed-off-by lines.
.git/hooks/post-update.sample:# To enable this hook, rename this file to "post-update".
.git/hooks/post-update.sample:exec git update-server-info
.git/hooks/pre-applypatch.sample:# by applypatch from an e-mail message.
.git/hooks/pre-applypatch.sample:# The hook should exit with non-zero status after issuing an
.git/hooks/pre-applypatch.sample:# To enable this hook, rename this file to "pre-applypatch".
.git/hooks/pre-applypatch.sample:. git-sh-setup
.git/hooks/pre-applypatch.sample:precommit="$(git rev-parse --git-path hooks/pre-commit)"
.git/hooks/pre-applypatch.sample:test -x "$precommit" && exec "$precommit" ${1+"$@"}
.git/hooks/pre-commit.sample:# exit with non-zero status after issuing an appropriate message if
.git/hooks/pre-commit.sample:# To enable this hook, rename this file to "pre-commit".
.git/hooks/pre-commit.sample:if git rev-parse --verify HEAD >/dev/null 2>&1
.git/hooks/pre-commit.sample:# If you want to allow non-ASCII filenames set this variable to true.
.git/hooks/pre-commit.sample:allownonascii=$(git config --bool hooks.allownonascii)
.git/hooks/pre-commit.sample:# Cross platform projects tend to avoid non-ASCII filenames; prevent
.git/hooks/pre-commit.sample:	test $(git diff --cached --name-only --diff-filter=A -z $against |
.git/hooks/pre-commit.sample:	  LC_ALL=C tr -d '[ -~]\0' | wc -c) != 0
.git/hooks/pre-commit.sample:Error: Attempt to add a non-ASCII file name.
.git/hooks/pre-commit.sample:exec git diff-index --check --cached $against --
.git/hooks/pre-push.sample:# pushed.  If this script exits with a non-zero status nothing will be pushed.
.git/hooks/pre-push.sample:# $1 -- Name of the remote to which the push is being done
.git/hooks/pre-push.sample:# $2 -- URL to which the push is being done
.git/hooks/pre-push.sample:		commit=`git rev-list -n 1 --grep '^WIP' "$range"`
.git/hooks/pre-push.sample:		if [ -n "$commit" ]
.git/hooks/pre-rebase.sample:# The "pre-rebase" hook is run just before "git rebase" starts doing
.git/hooks/pre-rebase.sample:# non-zero status.
.git/hooks/pre-rebase.sample:# $1 -- the upstream the series was forked from.
.git/hooks/pre-rebase.sample:# $2 -- the branch being rebased (or empty when rebasing the current branch).
.git/hooks/pre-rebase.sample:	topic=`git symbolic-ref HEAD` ||
.git/hooks/pre-rebase.sample:git show-ref -q "$topic" || {
.git/hooks/pre-rebase.sample:not_in_master=`git rev-list --pretty=oneline ^master "$topic"`
.git/hooks/pre-rebase.sample:if test -z "$not_in_master"
.git/hooks/pre-rebase.sample:only_next_1=`git rev-list ^master "^$topic" ${publish} | sort`
.git/hooks/pre-rebase.sample:only_next_2=`git rev-list ^master           ${publish} | sort`
.git/hooks/pre-rebase.sample:	not_in_topic=`git rev-list "^$topic" master`
.git/hooks/pre-rebase.sample:	if test -z "$not_in_topic"
.git/hooks/pre-rebase.sample:		echo >&2 "$topic is already up-to-date with master"
.git/hooks/pre-rebase.sample:	not_in_next=`git rev-list --pretty=oneline ^${publish} "$topic"`
.git/hooks/pre-rebase.sample:	/usr/bin/perl -e '
.git/hooks/pre-rebase.sample:			/^([0-9a-f]+) /;
.git/hooks/pre-rebase.sample:				/^([0-9a-f]+) (.*)$/;
.git/hooks/pre-rebase.sample:			if (!exists $not_in_next{$elem->[0]}) {
.git/hooks/pre-rebase.sample:				print STDERR " $elem->[1]\n";
.git/hooks/pre-rebase.sample:    build on top of it -- other people may already want to
.git/hooks/pre-rebase.sample:		   o---o---o---o---o---o---o---o---o---o "next"
.git/hooks/pre-rebase.sample:		 /   a---a---b A     /           /
.git/hooks/pre-rebase.sample:	       /   /   c---c---c---c B         /
.git/hooks/pre-rebase.sample:	     /   /   /   b---b C     \       /
.git/hooks/pre-rebase.sample:    ---o---o---o---o---o---o---o---o---o---o---o "master"
.git/hooks/pre-rebase.sample:	git rev-list ^master ^topic next
.git/hooks/pre-rebase.sample:	git rev-list ^master        next
.git/hooks/pre-rebase.sample:	git rev-list master..topic
.git/hooks/prepare-commit-msg.sample:# message file.  If the hook fails with a non-zero status,
.git/hooks/prepare-commit-msg.sample:# To enable this hook, rename this file to "prepare-commit-msg".
.git/hooks/prepare-commit-msg.sample:# The second includes the output of "git diff --name-status -r"
.git/hooks/prepare-commit-msg.sample:# commented because it doesn't cope with --amend or with squashed
.git/hooks/prepare-commit-msg.sample:# The third example adds a Signed-off-by line to the message, that can
.git/hooks/prepare-commit-msg.sample:    /usr/bin/perl -i.bak -ne 's/^/# /, s/^# #/#/ if /^Conflicts/ .. /#/; print' "$1" ;;
.git/hooks/prepare-commit-msg.sample:#   /usr/bin/perl -i.bak -pe '
.git/hooks/prepare-commit-msg.sample:#      print "\n" . `git diff --cached --name-status -r`
.git/hooks/prepare-commit-msg.sample:# SOB=$(git var GIT_AUTHOR_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
.git/hooks/prepare-commit-msg.sample:# grep -qs "^$SOB" "$1" || echo "$SOB" >> "$1"
.git/hooks/update.sample:# Called by "git receive-pack" with arguments: refname sha1-old sha1-new
.git/hooks/update.sample:# ------
.git/hooks/update.sample:# --- Command line
.git/hooks/update.sample:# --- Safety check
.git/hooks/update.sample:if [ -z "$GIT_DIR" ]; then
.git/hooks/update.sample:if [ -z "$refname" -o -z "$oldrev" -o -z "$newrev" ]; then
.git/hooks/update.sample:# --- Config
.git/hooks/update.sample:allowunannotated=$(git config --bool hooks.allowunannotated)
.git/hooks/update.sample:allowdeletebranch=$(git config --bool hooks.allowdeletebranch)
.git/hooks/update.sample:denycreatebranch=$(git config --bool hooks.denycreatebranch)
.git/hooks/update.sample:allowdeletetag=$(git config --bool hooks.allowdeletetag)
.git/hooks/update.sample:allowmodifytag=$(git config --bool hooks.allowmodifytag)
.git/hooks/update.sample:projectdesc=$(sed -e '1q' "$GIT_DIR/description")
.git/hooks/update.sample:# --- Check types
.git/hooks/update.sample:	newrev_type=$(git cat-file -t $newrev)
.git/hooks/update.sample:		# un-annotated tag
.git/hooks/update.sample:			echo "*** The un-annotated tag, $short_refname, is not allowed in this repository" >&2
.git/hooks/update.sample:			echo "*** Use 'git tag [ -a | -s ]' for tags you want to propagate." >&2
.git/hooks/update.sample:		if [ "$allowmodifytag" != "true" ] && git rev-parse $refname > /dev/null 2>&1
.git/hooks/update.sample:		if [ "$oldrev" = "$zero" -a "$denycreatebranch" = "true" ]; then
.git/hooks/update.sample:# --- Finished
Binary file .git/index matches
.git/info/exclude:# git ls-files --others --exclude-from=.git/info/exclude
.git/logs/HEAD:620275007ac2a0d4eadf936e7eb7bd6ae090b19f 0db40c74e57e3c797d24abe689dcb2b2fb710f78 Dina Sukhobok <dina.suhobok@gmail.com> 1479216361 +0100	checkout: moving from master to rdf-formats
.git/logs/HEAD:0db40c74e57e3c797d24abe689dcb2b2fb710f78 620275007ac2a0d4eadf936e7eb7bd6ae090b19f Dina Sukhobok <dina.suhobok@gmail.com> 1479293158 +0100	checkout: moving from rdf-formats to master
.git/logs/HEAD:620275007ac2a0d4eadf936e7eb7bd6ae090b19f 0db40c74e57e3c797d24abe689dcb2b2fb710f78 Dina Sukhobok <dina.suhobok@gmail.com> 1479293188 +0100	checkout: moving from master to rdf-formats
.git/logs/HEAD:0db40c74e57e3c797d24abe689dcb2b2fb710f78 620275007ac2a0d4eadf936e7eb7bd6ae090b19f Dina Sukhobok <dina.suhobok@gmail.com> 1479974915 +0100	checkout: moving from rdf-formats to master
.git/logs/HEAD:620275007ac2a0d4eadf936e7eb7bd6ae090b19f e79d064c1c91b2aedec7592056abeb3e7f89f8eb Dina Sukhobok <dina.suhobok@gmail.com> 1479974951 +0100	merge rdf-formats: Merge made by the 'recursive' strategy.
.git/logs/HEAD:e79d064c1c91b2aedec7592056abeb3e7f89f8eb 383e637772e9459e8dd1db6b15b6ce5830be874c Dina Sukhobok <dina.suhobok@gmail.com> 1479986124 +0100	checkout: moving from master to input-formatter
.git/logs/HEAD:383e637772e9459e8dd1db6b15b6ce5830be874c e79d064c1c91b2aedec7592056abeb3e7f89f8eb Dina Sukhobok <dina.suhobok@gmail.com> 1479996025 +0100	checkout: moving from input-formatter to master
.git/logs/HEAD:e79d064c1c91b2aedec7592056abeb3e7f89f8eb e64d5dc03bd7c0c9028107cd6ed1221a3d5034ea Dina Sukhobok <dina.suhobok@gmail.com> 1479996032 +0100	merge input-formatter: Merge made by the 'recursive' strategy.
.git/logs/refs/heads/input-formatter:0000000000000000000000000000000000000000 383e637772e9459e8dd1db6b15b6ce5830be874c Dina Sukhobok <dina.suhobok@gmail.com> 1479986124 +0100	branch: Created from refs/remotes/origin/input-formatter
.git/logs/refs/heads/master:620275007ac2a0d4eadf936e7eb7bd6ae090b19f e79d064c1c91b2aedec7592056abeb3e7f89f8eb Dina Sukhobok <dina.suhobok@gmail.com> 1479974951 +0100	merge rdf-formats: Merge made by the 'recursive' strategy.
.git/logs/refs/heads/master:e79d064c1c91b2aedec7592056abeb3e7f89f8eb e64d5dc03bd7c0c9028107cd6ed1221a3d5034ea Dina Sukhobok <dina.suhobok@gmail.com> 1479996032 +0100	merge input-formatter: Merge made by the 'recursive' strategy.
.git/logs/refs/heads/rdf-formats:0000000000000000000000000000000000000000 0db40c74e57e3c797d24abe689dcb2b2fb710f78 Dina Sukhobok <dina.suhobok@gmail.com> 1479216361 +0100	branch: Created from refs/remotes/origin/rdf-formats
.git/logs/refs/stash:0000000000000000000000000000000000000000 441e3b49afa7006854086aa93e5d42cac39bf2f1 Dina Sukhobok <dina.suhobok@gmail.com> 1479986119 +0100	WIP on master: e79d064 Merge branch 'rdf-formats'
.git/logs/refs/stash:441e3b49afa7006854086aa93e5d42cac39bf2f1 69856fdb59c24470fc28d8f964695567ff8ec971 Dina Sukhobok <dina.suhobok@gmail.com> 1479996010 +0100	WIP on input-formatter: 383e637 TEST-VER-0.0.1 working version to support shape, *SV, xls
Binary file .git/objects/0d/b40c74e57e3c797d24abe689dcb2b2fb710f78 matches
Binary file .git/objects/1e/d2a7032f3a6431c6394499e3376d1bfd8d3614 matches
Binary file .git/objects/24/72fcaaee09c101f13e73f87f3b32e5dc4973e5 matches
Binary file .git/objects/33/4d1a1a73f611d7a69fdac8adcab21f31b9460b matches
Binary file .git/objects/34/1ea60fe36cdabaa05f2e52bad255161542f8cd matches
Binary file .git/objects/44/1e3b49afa7006854086aa93e5d42cac39bf2f1 matches
Binary file .git/objects/4e/659074503a459bdec2f6c82905b8b397fe6013 matches
Binary file .git/objects/65/2c83950e98d729cb279ce56f339c567561c053 matches
Binary file .git/objects/72/4085869bfa4a19ad7139ef8a792ceb49e0cba3 matches
Binary file .git/objects/79/4df224609bc6610342e9d0193bbfcdfa7c056f matches
Binary file .git/objects/ae/50154f8662819da22b4ea580789ea8aa190e14 matches
Binary file .git/objects/af/b4e898bde535e439481d4805896b5d1da23e76 matches
Binary file .git/objects/ba/14dd43a2ca086e527812d5c00b4537ea5e3c9a matches
Binary file .git/objects/da/981c0972ec8d871f2e52cdee12b1f627a675fd matches
Binary file .git/objects/e6/4d5dc03bd7c0c9028107cd6ed1221a3d5034ea matches
.git/objects/e7/9d064c1c91b2aedec7592056abeb3e7f89f8eb:xAjÃ0E»ö)´Ë¢4ŒÆ’Æ‚²è¶«ž`FÅ&±Uùþ5…^ Ë÷y|x©®ëÒÆøÒ›ªUPt)³0ƒ/¨…3zoƒõË”òðÍM·n’ NÈr.qJ*$9°B±±üùÅA"§žtL)£cÑ0Åœ‹…BÓÀ{Ÿk3ËÆæk¿ÏUêÝ¼çÏÏý—®·•—Ç9Õõb¬£ÉEoÍ+X€áX®®ÿ>µÝÔHã-ÍæÔry+µ­ÜŸ§á_-
Binary file .git/objects/fe/744b41f79fbfcf1009fef9817bf340de363ea9 matches
Binary file .git/objects/fe/a07c85e3c6b70ac65923a76714602635f79534 matches
Binary file .git/objects/pack/pack-a1b3e09f9a2ff5d66490d943e37c7226e43ee721.idx matches
Binary file .git/objects/pack/pack-a1b3e09f9a2ff5d66490d943e37c7226e43ee721.pack matches
.git/packed-refs:# pack-refs with: peeled fully-peeled 
.git/packed-refs:d62fa8e24012ca998982f17de93dba757617f268 refs/remotes/origin/experimental-js
.git/packed-refs:383e637772e9459e8dd1db6b15b6ce5830be874c refs/remotes/origin/input-formatter
.git/packed-refs:0a31a9d38674f42df414edc5b7bf4de33dd60d11 refs/remotes/origin/scalable-graftwerk
.git/packed-refs:f905452a4c2b6b6b873f8f5c8b92cbc1769e0856 refs/remotes/origin/spark-test
.git/packed-refs:8eafbc2b4a95059af5d5534ddff633a7c99c6cfc refs/remotes/origin/upgraded-to-grafter0.7
.gitignore:/.lein-*
.gitignore:/.nrepl-port
.gitignore:!/maven_repository/ww-geo-coords/ww-geo-coords/1.0/ww-geo-coords-1.0.jar
Binary file .project.clj.swp matches
Binary file doc/graft.png matches
Binary file doc/grafter-architecture-stack-diagram.png matches
Binary file doc/Grafter-Dapaas-Components.png matches
Binary file doc/Grafter-Split-Transform-Load.png matches
doc/graftwerk-rationale-and-design.org:#+SETUPFILE: ~/org/vendor/org-html-themes/setup/theme-readtheorg.setup
doc/graftwerk-rationale-and-design.org:# #+SETUPFILE: ~/org/vendor/org-html-themes/setup/theme-bigblow.setup
doc/graftwerk-rationale-and-design.org:through a familiar spreadsheet-like interface.
doc/graftwerk-rationale-and-design.org:User interfaces to enable non-developer programming have been a holy
doc/graftwerk-rationale-and-design.org:simultaneously too complicated for non-developers to use and too
doc/graftwerk-rationale-and-design.org:Spreadsheets (a restricted form of data-flow programming), musical
doc/graftwerk-rationale-and-design.org:- Executing Grafter transformations, applying them to the source
doc/graftwerk-rationale-and-design.org:- Applying Grafter transformations to a preview of the data,
doc/graftwerk-rationale-and-design.org:[[file:Grafter-Dapaas-Components.png]]
doc/graftwerk-rationale-and-design.org:- It has been built from the beginning to support a clean separation
doc/graftwerk-rationale-and-design.org:- Transformations are implemented as pure functions on immutable data,
doc/graftwerk-rationale-and-design.org:- It has been designed in such a way to help support a interactive
doc/graftwerk-rationale-and-design.org:- It supports large (industry scale) data transformations efficiently.
doc/graftwerk-rationale-and-design.org:- It supports an easy way to convert tabular data into Linked Data,
doc/graftwerk-rationale-and-design.org:- It has an efficient streaming implementation of a normalising melt
doc/graftwerk-rationale-and-design.org:- It provides API's for serialising Linked Data in almost all of its
doc/graftwerk-rationale-and-design.org:- It provides integration with triple stores via standard interfaces.
doc/graftwerk-rationale-and-design.org:- It has a highly modular design.
doc/graftwerk-rationale-and-design.org:[[file:grafter-architecture-stack-diagram.png]]
doc/graftwerk-rationale-and-design.org:- The cleaning and transformation of tabular data.
doc/graftwerk-rationale-and-design.org:- The conversion and loading of that data into Linked Data (RDF).
doc/graftwerk-rationale-and-design.org:like =derive-column=.  Additionally more complex and important
doc/graftwerk-rationale-and-design.org:=fill-when= and =melt=.
doc/graftwerk-rationale-and-design.org:(-> (read-dataset data-file)
doc/graftwerk-rationale-and-design.org:    (make-dataset [:area :name :period "measure" "lcl" "ucl"])
doc/graftwerk-rationale-and-design.org:    (drop-rows 1)
doc/graftwerk-rationale-and-design.org:    (derive-column :area-uri [:area] statistical-geography)
doc/graftwerk-rationale-and-design.org:    (derive-column :alc-hosp-uri [:variable :period :area] alc-hosp-id))
doc/graftwerk-rationale-and-design.org:[[file:pipe-composition.png]]
doc/graftwerk-rationale-and-design.org:(graph-fn [{:keys [alc-hosp-uri area-uri name period variable value]}]
doc/graftwerk-rationale-and-design.org:            (graph (base-graph "health/alcohol-hospital-admission")
doc/graftwerk-rationale-and-design.org:                   [alc-hosp-uri
doc/graftwerk-rationale-and-design.org:                    [rdf:a "http://purl.org/linked-data/cube#Observation"]
doc/graftwerk-rationale-and-design.org:                     [(alc-hosp variable) (parseValue value)]
doc/graftwerk-rationale-and-design.org:                     [qb:dataSet "http://linked.glasgow.gov.uk/data/health/alcohol-hospital-admission/"]
doc/graftwerk-rationale-and-design.org:                     [scot:refPeriod (year-prefix period)]
doc/graftwerk-rationale-and-design.org:                     [scot:RefArea area-uri]]))
doc/graftwerk-rationale-and-design.org:[[file:Graftwerk-Request.png]]
doc/graftwerk-rationale-and-design.org:[[file:Graftwerk-Response.png]]
Binary file doc/Graftwerk-Request.png matches
Binary file doc/Graftwerk-Response.png matches
Binary file doc/Graftwerk-Transform.png matches
Binary file doc/pipe-composition.png matches
Binary file doc/pipe.png matches
Dockerfile:CMD java -jar -Djava.security.policy=/usr/local/var/.java.policy /usr/local/var/graftwerk.jar
graftwerk.log:16-Nov-16 12:04:17 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-16 12:04:18 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-16 12:32:28 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-16 12:32:28 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-16 12:49:22 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-16 12:49:22 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-17 08:48:11 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-17 08:48:11 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-17 09:02:43 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "_datagraft_session=bzQwSlBFK25sdVg1L3hxbEZvTzh0WWpXOVdoMFhGVnp2VTd4ZzAwZk56QldEOEZDR1ZjekNyLzhwbXU0TGxza29acW9EMGJweWZLbzR6SFBkMHhFYVdMV0RyZWQycnh1RWtiSHp4QmJkdjEzT1p0bzZQOVhuYUxTNm9Ca0NJYUp1dW1YTEZ0dXlsZXFKb0tNbXNEWGZRPT0tLXF1RVNEdjNGNUlUNlhaTWJLb1F3SEE9PQ%3D%3D--6848a6df5ab5fdcb9ea62914740e120b026eb05a; JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@38dd6b3d>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-17 09:02:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "_datagraft_session=bzQwSlBFK25sdVg1L3hxbEZvTzh0WWpXOVdoMFhGVnp2VTd4ZzAwZk56QldEOEZDR1ZjekNyLzhwbXU0TGxza29acW9EMGJweWZLbzR6SFBkMHhFYVdMV0RyZWQycnh1RWtiSHp4QmJkdjEzT1p0bzZQOVhuYUxTNm9Ca0NJYUp1dW1YTEZ0dXlsZXFKb0tNbXNEWGZRPT0tLXF1RVNEdjNGNUlUNlhaTWJLb1F3SEE9PQ%3D%3D--6848a6df5ab5fdcb9ea62914740e120b026eb05a; JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@38dd6b3d>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-17 09:02:43 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "_datagraft_session=bzQwSlBFK25sdVg1L3hxbEZvTzh0WWpXOVdoMFhGVnp2VTd4ZzAwZk56QldEOEZDR1ZjekNyLzhwbXU0TGxza29acW9EMGJweWZLbzR6SFBkMHhFYVdMV0RyZWQycnh1RWtiSHp4QmJkdjEzT1p0bzZQOVhuYUxTNm9Ca0NJYUp1dW1YTEZ0dXlsZXFKb0tNbXNEWGZRPT0tLXF1RVNEdjNGNUlUNlhaTWJLb1F3SEE9PQ%3D%3D--6848a6df5ab5fdcb9ea62914740e120b026eb05a; JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@38dd6b3d>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-17 09:02:43 SINTEFPC7430 INFO [graftwerk.middleware] - 302   :get   /   {"Content-Type" "application/octet-stream", "Location" "https://github.com/Swirrl/graftwerk#running-pipes-and-grafts-on-the-whole-dataset"}
graftwerk.log:16-Nov-17 09:02:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  image/webp
graftwerk.log:16-Nov-17 09:02:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 selected  image/webp
graftwerk.log:16-Nov-17 09:02:43 SINTEFPC7430 INFO [graftwerk.middleware] - 302   :get   /   {"Content-Type" "application/octet-stream", "Location" "https://github.com/Swirrl/graftwerk#running-pipes-and-grafts-on-the-whole-dataset"}
graftwerk.log:16-Nov-17 11:53:15 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-17 11:53:15 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-17 11:57:17 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-17 11:57:17 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-17 12:29:59 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z; _datagraft_session=UzdVc0U1UVNYTXVRdVl4TmxKcUNaNWkvK012TWdvbDcrUXU3TzZmV2doeHBPcmY3dnVxUU8wMi8wYzBSWTJBMUJvT0k2VUdJNXJIWmlvNDd0MkN3Y3Q3UzkrdkdSL0IvejBwVkdOa3BSRlU9LS1hcHp0M2p0WkZRK0ZJMTVWM2ZCVVBBPT0%3D--41bfe2a050efdab3a4eed85565d2f87ddaab7b49; oauthSession=S4_viRgH1bTwn3iDCIKYRw.3XVZT03mQXifUED4Dvi79MW8hmlJ5CZL69LlHJQzXOl4THHZvK7n1Wis3LQxuB2HwNWIm82KauAPyW2gLlOPHg.1479381972737.7200000.VhTYOfeJlVmH5o2ODrRoHIkNFVfc_Ida5fi5AvlWN6Y", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@739b3961>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-17 12:29:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z; _datagraft_session=UzdVc0U1UVNYTXVRdVl4TmxKcUNaNWkvK012TWdvbDcrUXU3TzZmV2doeHBPcmY3dnVxUU8wMi8wYzBSWTJBMUJvT0k2VUdJNXJIWmlvNDd0MkN3Y3Q3UzkrdkdSL0IvejBwVkdOa3BSRlU9LS1hcHp0M2p0WkZRK0ZJMTVWM2ZCVVBBPT0%3D--41bfe2a050efdab3a4eed85565d2f87ddaab7b49; oauthSession=S4_viRgH1bTwn3iDCIKYRw.3XVZT03mQXifUED4Dvi79MW8hmlJ5CZL69LlHJQzXOl4THHZvK7n1Wis3LQxuB2HwNWIm82KauAPyW2gLlOPHg.1479381972737.7200000.VhTYOfeJlVmH5o2ODrRoHIkNFVfc_Ida5fi5AvlWN6Y", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@739b3961>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-17 12:29:59 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z; _datagraft_session=UzdVc0U1UVNYTXVRdVl4TmxKcUNaNWkvK012TWdvbDcrUXU3TzZmV2doeHBPcmY3dnVxUU8wMi8wYzBSWTJBMUJvT0k2VUdJNXJIWmlvNDd0MkN3Y3Q3UzkrdkdSL0IvejBwVkdOa3BSRlU9LS1hcHp0M2p0WkZRK0ZJMTVWM2ZCVVBBPT0%3D--41bfe2a050efdab3a4eed85565d2f87ddaab7b49; oauthSession=S4_viRgH1bTwn3iDCIKYRw.3XVZT03mQXifUED4Dvi79MW8hmlJ5CZL69LlHJQzXOl4THHZvK7n1Wis3LQxuB2HwNWIm82KauAPyW2gLlOPHg.1479381972737.7200000.VhTYOfeJlVmH5o2ODrRoHIkNFVfc_Ida5fi5AvlWN6Y", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@739b3961>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-17 12:29:59 SINTEFPC7430 INFO [graftwerk.middleware] - 302   :get   /   {"Content-Type" "application/octet-stream", "Location" "https://github.com/Swirrl/graftwerk#running-pipes-and-grafts-on-the-whole-dataset"}
graftwerk.log:16-Nov-17 12:29:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  image/webp
graftwerk.log:16-Nov-17 12:29:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 selected  image/webp
graftwerk.log:16-Nov-17 12:29:59 SINTEFPC7430 INFO [graftwerk.middleware] - 302   :get   /   {"Content-Type" "application/octet-stream", "Location" "https://github.com/Swirrl/graftwerk#running-pipes-and-grafts-on-the-whole-dataset"}
graftwerk.log:16-Nov-18 11:07:55 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-18 11:07:55 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-18 12:59:08 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-18 12:59:08 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-23 13:40:48 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-23 13:40:48 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-23 14:01:16 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-23 14:01:16 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-23 14:42:05 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5858", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------014404640410068832979157", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5858, :content-type "multipart/form-data; boundary=--------------------------014404640410068832979157", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@36b0b974>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 14:42:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5858", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------014404640410068832979157", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5858, :content-type "multipart/form-data; boundary=--------------------------014404640410068832979157", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@36b0b974>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 14:42:05 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5858", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------014404640410068832979157", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5858, :content-type "multipart/form-data; boundary=--------------------------014404640410068832979157", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@36b0b974>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 14:42:05 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7536888212876744633.tmp", context #<AccessControlContext java.security.AccessControlContext@7e66320>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2d381ef>}
graftwerk.log:16-Nov-23 14:42:07 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7536888212876744633.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-23 14:42:07 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-23 14:42:07 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-23 14:42:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Nov-23 14:42:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Nov-23 14:42:07 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Nov-23 14:42:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-23 14:57:02 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-23 14:57:02 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z; oauthSession=nzB1wf--XTffZjy_HL3rtA.wXJp6t5TYvejTO3J9lyDrkvTfL9JoBr20Y699SFXpvkfsn3KsI-zVJ8RAsHKmWz1fIRO3Ap1_BurEu4ygK-lUvqPpVsR8y46zWkJtWoaI0lxKvkGeEuxBu1rwZzARIi7FdBUlcYDZD4OE5_nqYvQ867uktmnkbz5JHgR7XQ6fiIwLJxlDdJEfNcUV-NI4V7qdcK-ojSxHO8quNbh0p2cmvcuiaCGvqcv-wbBpy4jYtzb5XXWWa2oiqVk0yj4NH1H7yrZNZlx2-f5pem28ibBwd1UMKxI8lMS3nI-3rWSa-aYjvZBhKM_d2ziUDsEDU_jlmQ-YJ_P71DrmTfKYD4jVQu7Ubw6Lm-MVfGcq58Em0Vmt35mDW0Ugo4-uGYkdCDYt_89T2q36eiVZfdIenKirbMk9xu-LI6HwcHUbh8-FEqd5op9ROaWlpK-i8sR9l4If8dNVvAiyuSBLx1y5NP7xg.1479908355794.7200000.2jatjCU178tbwG2uvdabvs2WAGjNREvyh86x3MsKD0E; _datagraft_session=aDdFdDRGOUw1aWlMcXJYTFNsNXV6MWVtOFR5THJBdnNaK3V1Vk5RdGNSR3VJUGdnT2NPVmk3MndqczI4ekZJaEVDOXZqamh2MTEyY0U2a2RxdVVSRkxmMGdWWThsM2xNOExPVWJYMjE2K3dMbTNBVmVDVUdFTEMxQytVbzFPZ1Y2anA4QmlnbzBadkZYbERMemhHRkpnPT0tLTFyUEQ4UmNacDBXZVFtQlU3VFg3eWc9PQ%3D%3D--52664154e376e3716beacead2f222a3a95d13007", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@29f62645>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z; oauthSession=nzB1wf--XTffZjy_HL3rtA.wXJp6t5TYvejTO3J9lyDrkvTfL9JoBr20Y699SFXpvkfsn3KsI-zVJ8RAsHKmWz1fIRO3Ap1_BurEu4ygK-lUvqPpVsR8y46zWkJtWoaI0lxKvkGeEuxBu1rwZzARIi7FdBUlcYDZD4OE5_nqYvQ867uktmnkbz5JHgR7XQ6fiIwLJxlDdJEfNcUV-NI4V7qdcK-ojSxHO8quNbh0p2cmvcuiaCGvqcv-wbBpy4jYtzb5XXWWa2oiqVk0yj4NH1H7yrZNZlx2-f5pem28ibBwd1UMKxI8lMS3nI-3rWSa-aYjvZBhKM_d2ziUDsEDU_jlmQ-YJ_P71DrmTfKYD4jVQu7Ubw6Lm-MVfGcq58Em0Vmt35mDW0Ugo4-uGYkdCDYt_89T2q36eiVZfdIenKirbMk9xu-LI6HwcHUbh8-FEqd5op9ROaWlpK-i8sR9l4If8dNVvAiyuSBLx1y5NP7xg.1479908355794.7200000.2jatjCU178tbwG2uvdabvs2WAGjNREvyh86x3MsKD0E; _datagraft_session=aDdFdDRGOUw1aWlMcXJYTFNsNXV6MWVtOFR5THJBdnNaK3V1Vk5RdGNSR3VJUGdnT2NPVmk3MndqczI4ekZJaEVDOXZqamh2MTEyY0U2a2RxdVVSRkxmMGdWWThsM2xNOExPVWJYMjE2K3dMbTNBVmVDVUdFTEMxQytVbzFPZ1Y2anA4QmlnbzBadkZYbERMemhHRkpnPT0tLTFyUEQ4UmNacDBXZVFtQlU3VFg3eWc9PQ%3D%3D--52664154e376e3716beacead2f222a3a95d13007", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@29f62645>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z; oauthSession=nzB1wf--XTffZjy_HL3rtA.wXJp6t5TYvejTO3J9lyDrkvTfL9JoBr20Y699SFXpvkfsn3KsI-zVJ8RAsHKmWz1fIRO3Ap1_BurEu4ygK-lUvqPpVsR8y46zWkJtWoaI0lxKvkGeEuxBu1rwZzARIi7FdBUlcYDZD4OE5_nqYvQ867uktmnkbz5JHgR7XQ6fiIwLJxlDdJEfNcUV-NI4V7qdcK-ojSxHO8quNbh0p2cmvcuiaCGvqcv-wbBpy4jYtzb5XXWWa2oiqVk0yj4NH1H7yrZNZlx2-f5pem28ibBwd1UMKxI8lMS3nI-3rWSa-aYjvZBhKM_d2ziUDsEDU_jlmQ-YJ_P71DrmTfKYD4jVQu7Ubw6Lm-MVfGcq58Em0Vmt35mDW0Ugo4-uGYkdCDYt_89T2q36eiVZfdIenKirbMk9xu-LI6HwcHUbh8-FEqd5op9ROaWlpK-i8sR9l4If8dNVvAiyuSBLx1y5NP7xg.1479908355794.7200000.2jatjCU178tbwG2uvdabvs2WAGjNREvyh86x3MsKD0E; _datagraft_session=aDdFdDRGOUw1aWlMcXJYTFNsNXV6MWVtOFR5THJBdnNaK3V1Vk5RdGNSR3VJUGdnT2NPVmk3MndqczI4ekZJaEVDOXZqamh2MTEyY0U2a2RxdVVSRkxmMGdWWThsM2xNOExPVWJYMjE2K3dMbTNBVmVDVUdFTEMxQytVbzFPZ1Y2anA4QmlnbzBadkZYbERMemhHRkpnPT0tLTFyUEQ4UmNacDBXZVFtQlU3VFg3eWc9PQ%3D%3D--52664154e376e3716beacead2f222a3a95d13007", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@29f62645>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware] - 302   :get   /   {"Content-Type" "application/octet-stream", "Location" "https://github.com/Swirrl/graftwerk#running-pipes-and-grafts-on-the-whole-dataset"}
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  image/webp
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 selected  image/webp
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware] - 302   :get   /   {"Content-Type" "application/octet-stream", "Location" "https://github.com/Swirrl/graftwerk#running-pipes-and-grafts-on-the-whole-dataset"}
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z; oauthSession=nzB1wf--XTffZjy_HL3rtA.wXJp6t5TYvejTO3J9lyDrkvTfL9JoBr20Y699SFXpvkfsn3KsI-zVJ8RAsHKmWz1fIRO3Ap1_BurEu4ygK-lUvqPpVsR8y46zWkJtWoaI0lxKvkGeEuxBu1rwZzARIi7FdBUlcYDZD4OE5_nqYvQ867uktmnkbz5JHgR7XQ6fiIwLJxlDdJEfNcUV-NI4V7qdcK-ojSxHO8quNbh0p2cmvcuiaCGvqcv-wbBpy4jYtzb5XXWWa2oiqVk0yj4NH1H7yrZNZlx2-f5pem28ibBwd1UMKxI8lMS3nI-3rWSa-aYjvZBhKM_d2ziUDsEDU_jlmQ-YJ_P71DrmTfKYD4jVQu7Ubw6Lm-MVfGcq58Em0Vmt35mDW0Ugo4-uGYkdCDYt_89T2q36eiVZfdIenKirbMk9xu-LI6HwcHUbh8-FEqd5op9ROaWlpK-i8sR9l4If8dNVvAiyuSBLx1y5NP7xg.1479908355794.7200000.2jatjCU178tbwG2uvdabvs2WAGjNREvyh86x3MsKD0E; _datagraft_session=aDdFdDRGOUw1aWlMcXJYTFNsNXV6MWVtOFR5THJBdnNaK3V1Vk5RdGNSR3VJUGdnT2NPVmk3MndqczI4ekZJaEVDOXZqamh2MTEyY0U2a2RxdVVSRkxmMGdWWThsM2xNOExPVWJYMjE2K3dMbTNBVmVDVUdFTEMxQytVbzFPZ1Y2anA4QmlnbzBadkZYbERMemhHRkpnPT0tLTFyUEQ4UmNacDBXZVFtQlU3VFg3eWc9PQ%3D%3D--52664154e376e3716beacead2f222a3a95d13007", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@303ccce1>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z; oauthSession=nzB1wf--XTffZjy_HL3rtA.wXJp6t5TYvejTO3J9lyDrkvTfL9JoBr20Y699SFXpvkfsn3KsI-zVJ8RAsHKmWz1fIRO3Ap1_BurEu4ygK-lUvqPpVsR8y46zWkJtWoaI0lxKvkGeEuxBu1rwZzARIi7FdBUlcYDZD4OE5_nqYvQ867uktmnkbz5JHgR7XQ6fiIwLJxlDdJEfNcUV-NI4V7qdcK-ojSxHO8quNbh0p2cmvcuiaCGvqcv-wbBpy4jYtzb5XXWWa2oiqVk0yj4NH1H7yrZNZlx2-f5pem28ibBwd1UMKxI8lMS3nI-3rWSa-aYjvZBhKM_d2ziUDsEDU_jlmQ-YJ_P71DrmTfKYD4jVQu7Ubw6Lm-MVfGcq58Em0Vmt35mDW0Ugo4-uGYkdCDYt_89T2q36eiVZfdIenKirbMk9xu-LI6HwcHUbh8-FEqd5op9ROaWlpK-i8sR9l4If8dNVvAiyuSBLx1y5NP7xg.1479908355794.7200000.2jatjCU178tbwG2uvdabvs2WAGjNREvyh86x3MsKD0E; _datagraft_session=aDdFdDRGOUw1aWlMcXJYTFNsNXV6MWVtOFR5THJBdnNaK3V1Vk5RdGNSR3VJUGdnT2NPVmk3MndqczI4ekZJaEVDOXZqamh2MTEyY0U2a2RxdVVSRkxmMGdWWThsM2xNOExPVWJYMjE2K3dMbTNBVmVDVUdFTEMxQytVbzFPZ1Y2anA4QmlnbzBadkZYbERMemhHRkpnPT0tLTFyUEQ4UmNacDBXZVFtQlU3VFg3eWc9PQ%3D%3D--52664154e376e3716beacead2f222a3a95d13007", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@303ccce1>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "0:0:0:0:0:0:0:1", :headers {"host" "localhost:3000", "cookie" "JSESSIONID=1rkz49ykv6g4g1i99gd7iuwr7z; oauthSession=nzB1wf--XTffZjy_HL3rtA.wXJp6t5TYvejTO3J9lyDrkvTfL9JoBr20Y699SFXpvkfsn3KsI-zVJ8RAsHKmWz1fIRO3Ap1_BurEu4ygK-lUvqPpVsR8y46zWkJtWoaI0lxKvkGeEuxBu1rwZzARIi7FdBUlcYDZD4OE5_nqYvQ867uktmnkbz5JHgR7XQ6fiIwLJxlDdJEfNcUV-NI4V7qdcK-ojSxHO8quNbh0p2cmvcuiaCGvqcv-wbBpy4jYtzb5XXWWa2oiqVk0yj4NH1H7yrZNZlx2-f5pem28ibBwd1UMKxI8lMS3nI-3rWSa-aYjvZBhKM_d2ziUDsEDU_jlmQ-YJ_P71DrmTfKYD4jVQu7Ubw6Lm-MVfGcq58Em0Vmt35mDW0Ugo4-uGYkdCDYt_89T2q36eiVZfdIenKirbMk9xu-LI6HwcHUbh8-FEqd5op9ROaWlpK-i8sR9l4If8dNVvAiyuSBLx1y5NP7xg.1479908355794.7200000.2jatjCU178tbwG2uvdabvs2WAGjNREvyh86x3MsKD0E; _datagraft_session=aDdFdDRGOUw1aWlMcXJYTFNsNXV6MWVtOFR5THJBdnNaK3V1Vk5RdGNSR3VJUGdnT2NPVmk3MndqczI4ekZJaEVDOXZqamh2MTEyY0U2a2RxdVVSRkxmMGdWWThsM2xNOExPVWJYMjE2K3dMbTNBVmVDVUdFTEMxQytVbzFPZ1Y2anA4QmlnbzBadkZYbERMemhHRkpnPT0tLTFyUEQ4UmNacDBXZVFtQlU3VFg3eWc9PQ%3D%3D--52664154e376e3716beacead2f222a3a95d13007", "accept-language" "en-US,en;q=0.8,ru;q=0.6,nb;q=0.4", "user-agent" "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36", "accept-encoding" "gzip, deflate, sdch, br", "connection" "keep-alive", "accept" "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8", "upgrade-insecure-requests" "1"}, :server-port 3000, :content-length nil, :content-type nil, :character-encoding nil, :uri "/", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@303ccce1>, :scheme :http, :request-method :get}
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware] - 302   :get   /   {"Content-Type" "application/octet-stream", "Location" "https://github.com/Swirrl/graftwerk#running-pipes-and-grafts-on-the-whole-dataset"}
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  image/webp
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 selected  image/webp
graftwerk.log:16-Nov-23 15:07:54 SINTEFPC7430 INFO [graftwerk.middleware] - 302   :get   /   {"Content-Type" "application/octet-stream", "Location" "https://github.com/Swirrl/graftwerk#running-pipes-and-grafts-on-the-whole-dataset"}
graftwerk.log:16-Nov-23 15:38:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------775298043771528610214924", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------775298043771528610214924", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@66a45ed7>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:38:35 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------775298043771528610214924", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------775298043771528610214924", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@66a45ed7>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:38:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------775298043771528610214924", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------775298043771528610214924", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@66a45ed7>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:38:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3454057685145548999.tmp", context #<AccessControlContext java.security.AccessControlContext@122877d6>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@32339fc4>}
graftwerk.log:16-Nov-23 15:38:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3454057685145548999.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-23 15:38:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-23 15:38:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-23 15:38:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-23 15:38:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-23 15:38:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-23 15:38:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-23 15:38:59 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------948026072984636122386247", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------948026072984636122386247", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6c5fa6b1>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:38:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------948026072984636122386247", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------948026072984636122386247", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6c5fa6b1>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:38:59 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------948026072984636122386247", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------948026072984636122386247", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6c5fa6b1>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:38:59 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6402071058248974971.tmp", context #<AccessControlContext java.security.AccessControlContext@7a71fec2>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4e34172c>}
graftwerk.log:16-Nov-23 15:39:00 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6402071058248974971.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-23 15:39:00 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-23 15:39:00 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Nov-23 15:39:00 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Nov-23 15:39:00 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-23 15:39:00 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Nov-23 15:39:00 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------259367989285692899368766", "connection" "close", "accept" "application/rdf+xml"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------259367989285692899368766", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@26a33c20>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------259367989285692899368766", "connection" "close", "accept" "application/rdf+xml"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------259367989285692899368766", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@26a33c20>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------259367989285692899368766", "connection" "close", "accept" "application/rdf+xml"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------259367989285692899368766", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@26a33c20>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7361175378953321937.tmp", context #<AccessControlContext java.security.AccessControlContext@50e0cc2d>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5409232f>}
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7361175378953321937.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/rdf+xml
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/rdf+xml selected  application/rdf+xml
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/rdf+xml"}
graftwerk.log:16-Nov-23 15:39:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------768839248565926706837114", "connection" "close", "accept" "text/turtle"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------768839248565926706837114", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5edb0940>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------768839248565926706837114", "connection" "close", "accept" "text/turtle"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------768839248565926706837114", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5edb0940>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------768839248565926706837114", "connection" "close", "accept" "text/turtle"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------768839248565926706837114", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5edb0940>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8316293232420097655.tmp", context #<AccessControlContext java.security.AccessControlContext@61fe2b56>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6a9fdf92>}
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8316293232420097655.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  text/turtle
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: text/turtle selected  text/turtle
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "text/turtle"}
graftwerk.log:16-Nov-23 15:39:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------689730800750510288409191", "connection" "close", "accept" "application/n-quads"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------689730800750510288409191", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5e732e25>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------689730800750510288409191", "connection" "close", "accept" "application/n-quads"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------689730800750510288409191", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5e732e25>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------689730800750510288409191", "connection" "close", "accept" "application/n-quads"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------689730800750510288409191", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5e732e25>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5230559747820546014.tmp", context #<AccessControlContext java.security.AccessControlContext@53c79b43>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7fec3d03>}
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5230559747820546014.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-quads
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-quads selected  application/n-quads
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-quads"}
graftwerk.log:16-Nov-23 15:39:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------684540107136275094483022", "connection" "close", "accept" "application/trix"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------684540107136275094483022", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@c185498>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------684540107136275094483022", "connection" "close", "accept" "application/trix"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------684540107136275094483022", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@c185498>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------684540107136275094483022", "connection" "close", "accept" "application/trix"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------684540107136275094483022", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@c185498>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8210303240410612675.tmp", context #<AccessControlContext java.security.AccessControlContext@2a20979f>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@e0bbdaa>}
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8210303240410612675.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/trix
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/trix selected  application/trix
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-23 15:40:09 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/trix"}
graftwerk.log:16-Nov-24 09:09:53 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-24 09:09:53 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-24 09:12:27 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------485355228711915098064832", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------485355228711915098064832", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@38577d02>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:12:27 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------485355228711915098064832", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------485355228711915098064832", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@38577d02>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:12:27 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------485355228711915098064832", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------485355228711915098064832", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@38577d02>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:12:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8751511577305885710.tmp", context #<AccessControlContext java.security.AccessControlContext@513f4398>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2aa2bb29>}
graftwerk.log:16-Nov-24 09:12:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8751511577305885710.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-24 09:12:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-24 09:12:29 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-24 09:12:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-24 09:12:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-24 09:12:29 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-24 09:12:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-24 09:12:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------063279467645330276452066", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------063279467645330276452066", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4b0d7521>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:12:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------063279467645330276452066", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------063279467645330276452066", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4b0d7521>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:12:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------063279467645330276452066", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------063279467645330276452066", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4b0d7521>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:12:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3574178700968546199.tmp", context #<AccessControlContext java.security.AccessControlContext@662bb25c>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@786e2ca7>}
graftwerk.log:16-Nov-24 09:12:59 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3574178700968546199.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-24 09:12:59 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-24 09:12:59 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-24 09:12:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Nov-24 09:12:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Nov-24 09:12:59 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Nov-24 09:12:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-24 09:14:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------229192516041654396386936", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------229192516041654396386936", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@46d0fcef>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:14:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------229192516041654396386936", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------229192516041654396386936", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@46d0fcef>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:14:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------229192516041654396386936", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------229192516041654396386936", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@46d0fcef>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:14:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6896662138447912467.tmp", context #<AccessControlContext java.security.AccessControlContext@649c66d5>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5c01fe4b>}
graftwerk.log:16-Nov-24 09:14:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6896662138447912467.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-24 09:14:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-24 09:14:38 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-24 09:14:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-24 09:14:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-24 09:14:38 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-24 09:14:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------019247875267936330420218", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------019247875267936330420218", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@b1acead>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------019247875267936330420218", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------019247875267936330420218", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@b1acead>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------019247875267936330420218", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------019247875267936330420218", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@b1acead>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5221125172649609969.tmp", context #<AccessControlContext java.security.AccessControlContext@392b0163>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@43013dd9>}
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5221125172649609969.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Nov-24 09:15:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------013157839036221420742984", "connection" "close", "accept" "application/trix"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------013157839036221420742984", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3abe765b>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------013157839036221420742984", "connection" "close", "accept" "application/trix"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------013157839036221420742984", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3abe765b>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------013157839036221420742984", "connection" "close", "accept" "application/trix"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------013157839036221420742984", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3abe765b>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2841617979371357072.tmp", context #<AccessControlContext java.security.AccessControlContext@3b1590f4>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@175a51df>}
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2841617979371357072.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/trix
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/trix selected  application/trix
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/trix"}
graftwerk.log:16-Nov-24 09:16:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------801796961553982812650137", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------801796961553982812650137", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1e4d43b2>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------801796961553982812650137", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------801796961553982812650137", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1e4d43b2>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------801796961553982812650137", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------801796961553982812650137", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1e4d43b2>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1179668986726168350.tmp", context #<AccessControlContext java.security.AccessControlContext@55f90b8f>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@59d7a64f>}
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1179668986726168350.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Nov-24 09:42:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-24 09:42:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------223606956979835627353054", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------223606956979835627353054", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@692c14e6>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:42:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------223606956979835627353054", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------223606956979835627353054", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@692c14e6>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:42:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------223606956979835627353054", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------223606956979835627353054", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@692c14e6>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:42:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5744832417983933580.tmp", context #<AccessControlContext java.security.AccessControlContext@48d1a64f>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7f2ba9b>}
graftwerk.log:16-Nov-24 09:42:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5744832417983933580.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-24 09:42:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-24 09:42:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Nov-24 09:42:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Nov-24 09:42:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-24 09:42:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Nov-24 09:42:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-24 09:42:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------659872387940686137672382", "connection" "close", "accept" "text/turtle"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------659872387940686137672382", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1684ee60>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:42:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------659872387940686137672382", "connection" "close", "accept" "text/turtle"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------659872387940686137672382", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1684ee60>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:42:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5857", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------659872387940686137672382", "connection" "close", "accept" "text/turtle"}, :server-port 3000, :content-length 5857, :content-type "multipart/form-data; boundary=--------------------------659872387940686137672382", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1684ee60>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 09:42:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4716297572377739691.tmp", context #<AccessControlContext java.security.AccessControlContext@13f1d8b7>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@eece47f>}
graftwerk.log:16-Nov-24 09:42:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft (clojure.core/with-meta (grafter.tabular/read-dataset "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4716297572377739691.tmp" :format :csv) {:grafter.tabular/data-source "file.xls"}))
graftwerk.log:16-Nov-24 09:42:48 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-24 09:42:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  text/turtle
graftwerk.log:16-Nov-24 09:42:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: text/turtle selected  text/turtle
graftwerk.log:16-Nov-24 09:42:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-24 09:42:48 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "text/turtle"}
graftwerk.log:16-Nov-24 09:42:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-24 10:09:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47881", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------209460841272433280873622", "connection" "close"}, :server-port 8083, :content-length 47881, :content-type "multipart/form-data; boundary=--------------------------209460841272433280873622", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f0133a5>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 10:09:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47881", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------209460841272433280873622", "connection" "close"}, :server-port 8083, :content-length 47881, :content-type "multipart/form-data; boundary=--------------------------209460841272433280873622", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f0133a5>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 10:09:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47881", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------209460841272433280873622", "connection" "close"}, :server-port 8083, :content-length 47881, :content-type "multipart/form-data; boundary=--------------------------209460841272433280873622", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f0133a5>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 10:09:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6771720977394475529.tmp", context #<AccessControlContext java.security.AccessControlContext@423f03dd>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@344e0940>}
graftwerk.log:16-Nov-24 10:09:48 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-24 10:09:48 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-24 10:10:03 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47881", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------336188310976272545302321", "connection" "close"}, :server-port 8083, :content-length 47881, :content-type "multipart/form-data; boundary=--------------------------336188310976272545302321", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@318cf150>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 10:10:03 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47881", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------336188310976272545302321", "connection" "close"}, :server-port 8083, :content-length 47881, :content-type "multipart/form-data; boundary=--------------------------336188310976272545302321", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@318cf150>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 10:10:03 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47881", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------336188310976272545302321", "connection" "close"}, :server-port 8083, :content-length 47881, :content-type "multipart/form-data; boundary=--------------------------336188310976272545302321", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@318cf150>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 10:10:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3015675638160979279.tmp", context #<AccessControlContext java.security.AccessControlContext@64e1077b>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4b666fca>}
graftwerk.log:16-Nov-24 10:10:04 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-24 10:10:04 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-24 14:39:36 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-24 14:39:36 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3002/
graftwerk.log:16-Nov-24 14:42:32 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-24 14:42:32 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-24 14:43:44 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47881", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------212004345257758296379928", "connection" "close"}, :server-port 8083, :content-length 47881, :content-type "multipart/form-data; boundary=--------------------------212004345257758296379928", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f61f29>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 14:43:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47881", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------212004345257758296379928", "connection" "close"}, :server-port 8083, :content-length 47881, :content-type "multipart/form-data; boundary=--------------------------212004345257758296379928", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f61f29>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 14:43:44 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47881", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------212004345257758296379928", "connection" "close"}, :server-port 8083, :content-length 47881, :content-type "multipart/form-data; boundary=--------------------------212004345257758296379928", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f61f29>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 14:43:44 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 106[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-24 14:43:44 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-24 14:44:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38894", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------153249568772002336844470", "connection" "close"}, :server-port 8083, :content-length 38894, :content-type "multipart/form-data; boundary=--------------------------153249568772002336844470", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@592dfb6>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 14:44:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38894", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------153249568772002336844470", "connection" "close"}, :server-port 8083, :content-length 38894, :content-type "multipart/form-data; boundary=--------------------------153249568772002336844470", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@592dfb6>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 14:44:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38894", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------153249568772002336844470", "connection" "close"}, :server-port 8083, :content-length 38894, :content-type "multipart/form-data; boundary=--------------------------153249568772002336844470", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@592dfb6>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-24 14:44:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Nov-24 14:44:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@48b051d>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@53e14fd2>}
graftwerk.log:16-Nov-24 14:44:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Nov-24 14:44:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-24 14:44:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-24 14:44:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-24 14:44:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-24 14:44:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-24 14:44:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 08:41:32 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-25 08:41:32 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-25 09:01:31 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------507736148068465842304264", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------507736148068465842304264", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7b9e6af3>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 09:01:31 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------507736148068465842304264", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------507736148068465842304264", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7b9e6af3>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 09:01:31 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5856", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------507736148068465842304264", "connection" "close"}, :server-port 8083, :content-length 5856, :content-type "multipart/form-data; boundary=--------------------------507736148068465842304264", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7b9e6af3>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 09:01:31 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6867743669116938519.tmp
graftwerk.log:16-Nov-25 09:01:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6867743669116938519.tmp", context #<AccessControlContext java.security.AccessControlContext@4a5709d2>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1da0f768>}
graftwerk.log:16-Nov-25 09:01:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6867743669116938519.tmp")
graftwerk.log:16-Nov-25 09:01:34 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-25 09:01:34 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 10:57:48 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5798", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------215602539879800162597105", "connection" "close"}, :server-port 8083, :content-length 5798, :content-type "multipart/form-data; boundary=--------------------------215602539879800162597105", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@470759c9>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 10:57:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5798", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------215602539879800162597105", "connection" "close"}, :server-port 8083, :content-length 5798, :content-type "multipart/form-data; boundary=--------------------------215602539879800162597105", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@470759c9>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 10:57:48 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5798", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------215602539879800162597105", "connection" "close"}, :server-port 8083, :content-length 5798, :content-type "multipart/form-data; boundary=--------------------------215602539879800162597105", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@470759c9>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 10:57:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1108820097497801241.tmp
graftwerk.log:16-Nov-25 10:57:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1108820097497801241.tmp", context #<AccessControlContext java.security.AccessControlContext@4292babf>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@40608ac0>}
graftwerk.log:16-Nov-25 10:57:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1108820097497801241.tmp")
graftwerk.log:16-Nov-25 10:57:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 10:57:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 10:57:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 10:57:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 10:57:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 10:57:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5538", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------544032953908720502535785", "connection" "close"}, :server-port 8083, :content-length 5538, :content-type "multipart/form-data; boundary=--------------------------544032953908720502535785", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2484e784>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5538", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------544032953908720502535785", "connection" "close"}, :server-port 8083, :content-length 5538, :content-type "multipart/form-data; boundary=--------------------------544032953908720502535785", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2484e784>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5538", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------544032953908720502535785", "connection" "close"}, :server-port 8083, :content-length 5538, :content-type "multipart/form-data; boundary=--------------------------544032953908720502535785", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2484e784>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5708952091274511813.tmp
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5708952091274511813.tmp", context #<AccessControlContext java.security.AccessControlContext@1cbc92a4>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@f8bda96>}
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5708952091274511813.tmp")
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 11:07:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5798", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------698590881199776350988819", "connection" "close"}, :server-port 8083, :content-length 5798, :content-type "multipart/form-data; boundary=--------------------------698590881199776350988819", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@134d4173>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5798", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------698590881199776350988819", "connection" "close"}, :server-port 8083, :content-length 5798, :content-type "multipart/form-data; boundary=--------------------------698590881199776350988819", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@134d4173>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5798", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------698590881199776350988819", "connection" "close"}, :server-port 8083, :content-length 5798, :content-type "multipart/form-data; boundary=--------------------------698590881199776350988819", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@134d4173>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3517943635478314374.tmp
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3517943635478314374.tmp", context #<AccessControlContext java.security.AccessControlContext@2df39406>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@208cae18>}
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3517943635478314374.tmp")
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 11:07:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 11:12:00 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5751", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------488999799521334564831731", "connection" "close"}, :server-port 8083, :content-length 5751, :content-type "multipart/form-data; boundary=--------------------------488999799521334564831731", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74b5b436>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:12:00 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5751", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------488999799521334564831731", "connection" "close"}, :server-port 8083, :content-length 5751, :content-type "multipart/form-data; boundary=--------------------------488999799521334564831731", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74b5b436>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:12:00 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5751", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------488999799521334564831731", "connection" "close"}, :server-port 8083, :content-length 5751, :content-type "multipart/form-data; boundary=--------------------------488999799521334564831731", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74b5b436>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:12:00 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-25 11:12:00 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 11:12:00 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38894", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------622896853085307349598183", "connection" "close"}, :server-port 8083, :content-length 38894, :content-type "multipart/form-data; boundary=--------------------------622896853085307349598183", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@229789a5>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:12:00 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38894", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------622896853085307349598183", "connection" "close"}, :server-port 8083, :content-length 38894, :content-type "multipart/form-data; boundary=--------------------------622896853085307349598183", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@229789a5>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:12:00 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38894", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------622896853085307349598183", "connection" "close"}, :server-port 8083, :content-length 38894, :content-type "multipart/form-data; boundary=--------------------------622896853085307349598183", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@229789a5>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:12:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Nov-25 11:12:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@1a2c04b6>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1d2cd903>}
graftwerk.log:16-Nov-25 11:12:04 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Nov-25 11:12:04 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 11:12:04 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 11:12:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 11:12:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 11:12:04 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 11:12:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38894", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------944522998933201049271476", "connection" "close"}, :server-port 8083, :content-length 38894, :content-type "multipart/form-data; boundary=--------------------------944522998933201049271476", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2cba21fc>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38894", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------944522998933201049271476", "connection" "close"}, :server-port 8083, :content-length 38894, :content-type "multipart/form-data; boundary=--------------------------944522998933201049271476", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2cba21fc>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38894", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------944522998933201049271476", "connection" "close"}, :server-port 8083, :content-length 38894, :content-type "multipart/form-data; boundary=--------------------------944522998933201049271476", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2cba21fc>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID TVIST]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal TVIST "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@4fbdb58d>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@59e3dd63>}
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 11:50:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 11:50:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------614078033176423558445719", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------614078033176423558445719", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@25affb2c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:50:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------614078033176423558445719", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------614078033176423558445719", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@25affb2c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:50:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------614078033176423558445719", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------614078033176423558445719", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@25affb2c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:50:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8008180629996880814.tmp
graftwerk.log:16-Nov-25 11:50:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8008180629996880814.tmp", context #<AccessControlContext java.security.AccessControlContext@52f8afdd>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7646dce1>}
graftwerk.log:16-Nov-25 11:50:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8008180629996880814.tmp")
graftwerk.log:16-Nov-25 11:50:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 11:50:38 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 11:50:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 11:50:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 11:50:38 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 11:50:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 11:53:19 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5488", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------800316675099944243508735", "connection" "close"}, :server-port 8083, :content-length 5488, :content-type "multipart/form-data; boundary=--------------------------800316675099944243508735", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@14111ef8>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:53:19 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5488", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------800316675099944243508735", "connection" "close"}, :server-port 8083, :content-length 5488, :content-type "multipart/form-data; boundary=--------------------------800316675099944243508735", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@14111ef8>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:53:19 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5488", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------800316675099944243508735", "connection" "close"}, :server-port 8083, :content-length 5488, :content-type "multipart/form-data; boundary=--------------------------800316675099944243508735", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@14111ef8>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 11:53:19 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2669606986493982321.tmp
graftwerk.log:16-Nov-25 11:53:19 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2669606986493982321.tmp", context #<AccessControlContext java.security.AccessControlContext@3d6e8924>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@42080621>}
graftwerk.log:16-Nov-25 11:53:19 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2669606986493982321.tmp")
graftwerk.log:16-Nov-25 11:53:19 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-25 11:53:19 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 12:27:09 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------757280034657203106088458", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------757280034657203106088458", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3ec1b9fb>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------757280034657203106088458", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------757280034657203106088458", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3ec1b9fb>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------757280034657203106088458", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------757280034657203106088458", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3ec1b9fb>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@34154108>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6d7e3809>}
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 12:27:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 12:57:09 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------354508888764731617664294", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------354508888764731617664294", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1a528552>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 12:57:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------354508888764731617664294", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------354508888764731617664294", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1a528552>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 12:57:09 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------354508888764731617664294", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------354508888764731617664294", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1a528552>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 12:57:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Nov-25 12:57:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@2b75b4a1>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4a065e68>}
graftwerk.log:16-Nov-25 12:57:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Nov-25 12:57:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 12:57:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 12:57:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 12:57:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 12:57:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 12:57:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------389483955668802929975807", "connection" "close"}, :server-port 8083, :content-length 38644, :content-type "multipart/form-data; boundary=--------------------------389483955668802929975807", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@44632757>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------389483955668802929975807", "connection" "close"}, :server-port 8083, :content-length 38644, :content-type "multipart/form-data; boundary=--------------------------389483955668802929975807", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@44632757>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------389483955668802929975807", "connection" "close"}, :server-port 8083, :content-length 38644, :content-type "multipart/form-data; boundary=--------------------------389483955668802929975807", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@44632757>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5128493497961364379.tmp
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5128493497961364379.tmp", context #<AccessControlContext java.security.AccessControlContext@29292317>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7017dd73>}
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5128493497961364379.tmp")
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 12:57:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------446913762909136582110544", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------446913762909136582110544", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@35f9027e>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------446913762909136582110544", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------446913762909136582110544", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@35f9027e>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------446913762909136582110544", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------446913762909136582110544", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@35f9027e>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@85df682>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@62f76e78>}
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 13:26:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 13:45:57 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5564", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------942789624288869073613291", "connection" "close"}, :server-port 8083, :content-length 5564, :content-type "multipart/form-data; boundary=--------------------------942789624288869073613291", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6e43f945>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:45:57 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5564", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------942789624288869073613291", "connection" "close"}, :server-port 8083, :content-length 5564, :content-type "multipart/form-data; boundary=--------------------------942789624288869073613291", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6e43f945>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:45:57 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5564", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------942789624288869073613291", "connection" "close"}, :server-port 8083, :content-length 5564, :content-type "multipart/form-data; boundary=--------------------------942789624288869073613291", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6e43f945>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:45:57 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1100057595168040392.tmp
graftwerk.log:16-Nov-25 13:45:57 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1100057595168040392.tmp", context #<AccessControlContext java.security.AccessControlContext@263310da>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@212fca71>}
graftwerk.log:16-Nov-25 13:45:57 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1100057595168040392.tmp")
graftwerk.log:16-Nov-25 13:45:57 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-25 13:45:57 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------072677826668484295562136", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------072677826668484295562136", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@50784ed9>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------072677826668484295562136", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------072677826668484295562136", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@50784ed9>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------072677826668484295562136", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------072677826668484295562136", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@50784ed9>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4918962587600263200.tmp
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4918962587600263200.tmp", context #<AccessControlContext java.security.AccessControlContext@45c1dc75>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@557edd>}
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4918962587600263200.tmp")
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 13:46:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-25 13:48:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5611", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------965680831078444219781821", "connection" "close"}, :server-port 8083, :content-length 5611, :content-type "multipart/form-data; boundary=--------------------------965680831078444219781821", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@61633b52>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:48:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5611", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------965680831078444219781821", "connection" "close"}, :server-port 8083, :content-length 5611, :content-type "multipart/form-data; boundary=--------------------------965680831078444219781821", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@61633b52>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:48:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5611", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------965680831078444219781821", "connection" "close"}, :server-port 8083, :content-length 5611, :content-type "multipart/form-data; boundary=--------------------------965680831078444219781821", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@61633b52>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:48:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-634245960569126139.tmp
graftwerk.log:16-Nov-25 13:48:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-634245960569126139.tmp", context #<AccessControlContext java.security.AccessControlContext@31f8b70>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@19cec9a0>}
graftwerk.log:16-Nov-25 13:48:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-634245960569126139.tmp")
graftwerk.log:16-Nov-25 13:48:23 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-25 13:48:23 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 13:49:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5611", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------081747348580788999558103", "connection" "close"}, :server-port 8083, :content-length 5611, :content-type "multipart/form-data; boundary=--------------------------081747348580788999558103", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@605bc960>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:49:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5611", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------081747348580788999558103", "connection" "close"}, :server-port 8083, :content-length 5611, :content-type "multipart/form-data; boundary=--------------------------081747348580788999558103", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@605bc960>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:49:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5611", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------081747348580788999558103", "connection" "close"}, :server-port 8083, :content-length 5611, :content-type "multipart/form-data; boundary=--------------------------081747348580788999558103", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@605bc960>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:49:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4457108825086024313.tmp
graftwerk.log:16-Nov-25 13:49:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4457108825086024313.tmp", context #<AccessControlContext java.security.AccessControlContext@2b714515>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@54799a49>}
graftwerk.log:16-Nov-25 13:49:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4457108825086024313.tmp")
graftwerk.log:16-Nov-25 13:49:55 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-25 13:49:55 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 13:51:14 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5611", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------648685167423619265572832", "connection" "close"}, :server-port 8083, :content-length 5611, :content-type "multipart/form-data; boundary=--------------------------648685167423619265572832", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5c0af0a1>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:51:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5611", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------648685167423619265572832", "connection" "close"}, :server-port 8083, :content-length 5611, :content-type "multipart/form-data; boundary=--------------------------648685167423619265572832", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5c0af0a1>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:51:14 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5611", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------648685167423619265572832", "connection" "close"}, :server-port 8083, :content-length 5611, :content-type "multipart/form-data; boundary=--------------------------648685167423619265572832", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5c0af0a1>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 13:51:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2818959126806976151.tmp
graftwerk.log:16-Nov-25 13:51:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2818959126806976151.tmp", context #<AccessControlContext java.security.AccessControlContext@6fef9a12>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@58fcaf46>}
graftwerk.log:16-Nov-25 13:51:15 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2818959126806976151.tmp")
graftwerk.log:16-Nov-25 13:51:15 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Nov-25 13:51:15 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------489675711521611793635633", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------489675711521611793635633", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4fd34da3>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------489675711521611793635633", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------489675711521611793635633", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4fd34da3>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------489675711521611793635633", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------489675711521611793635633", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4fd34da3>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8615260238105099121.tmp
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8615260238105099121.tmp", context #<AccessControlContext java.security.AccessControlContext@349aad3c>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5d3ba2b5>}
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8615260238105099121.tmp")
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-25 14:50:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 08:53:07 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-29 08:53:07 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-29 10:08:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------425014540126414900193611", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------425014540126414900193611", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3bdc850c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 10:08:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------425014540126414900193611", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------425014540126414900193611", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3bdc850c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 10:08:43 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------425014540126414900193611", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------425014540126414900193611", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3bdc850c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 10:08:43 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5169324698545117725.tmp
graftwerk.log:16-Nov-29 10:08:43 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5169324698545117725.tmp", context #<AccessControlContext java.security.AccessControlContext@225837d6>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@62d4c201>}
graftwerk.log:16-Nov-29 10:08:45 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5169324698545117725.tmp")
graftwerk.log:16-Nov-29 10:08:45 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 10:08:45 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 10:08:45 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 10:08:45 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 10:08:45 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 10:08:45 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------651616981640006226015189", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------651616981640006226015189", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@56041c7c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------651616981640006226015189", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------651616981640006226015189", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@56041c7c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------651616981640006226015189", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------651616981640006226015189", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@56041c7c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2967467949239850901.tmp
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2967467949239850901.tmp", context #<AccessControlContext java.security.AccessControlContext@6a5274d2>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5ca5e86e>}
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2967467949239850901.tmp")
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 10:22:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 11:18:05 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------348041607570960958298995", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------348041607570960958298995", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6403a956>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:18:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------348041607570960958298995", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------348041607570960958298995", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6403a956>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:18:05 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------348041607570960958298995", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------348041607570960958298995", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6403a956>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:18:05 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2922116281692805813.tmp
graftwerk.log:16-Nov-29 11:18:05 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2922116281692805813.tmp", context #<AccessControlContext java.security.AccessControlContext@9229f7>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6ff90ce1>}
graftwerk.log:16-Nov-29 11:18:06 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2922116281692805813.tmp")
graftwerk.log:16-Nov-29 11:18:06 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 11:18:06 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 11:18:06 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 11:18:06 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 11:18:06 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 11:18:06 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "8727", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------801622241656003828945936", "connection" "close"}, :server-port 8083, :content-length 8727, :content-type "multipart/form-data; boundary=--------------------------801622241656003828945936", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@62de2f5a>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "8727", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------801622241656003828945936", "connection" "close"}, :server-port 8083, :content-length 8727, :content-type "multipart/form-data; boundary=--------------------------801622241656003828945936", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@62de2f5a>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "8727", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------801622241656003828945936", "connection" "close"}, :server-port 8083, :content-length 8727, :content-type "multipart/form-data; boundary=--------------------------801622241656003828945936", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@62de2f5a>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2219383697343375856.tmp
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2219383697343375856.tmp", context #<AccessControlContext java.security.AccessControlContext@57016cbe>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4ec7bd10>}
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2219383697343375856.tmp")
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 11:37:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "8727", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------343865400583089489958132", "connection" "close"}, :server-port 8083, :content-length 8727, :content-type "multipart/form-data; boundary=--------------------------343865400583089489958132", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6350fe26>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "8727", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------343865400583089489958132", "connection" "close"}, :server-port 8083, :content-length 8727, :content-type "multipart/form-data; boundary=--------------------------343865400583089489958132", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6350fe26>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "8727", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------343865400583089489958132", "connection" "close"}, :server-port 8083, :content-length 8727, :content-type "multipart/form-data; boundary=--------------------------343865400583089489958132", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6350fe26>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3642375677084295489.tmp
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3642375677084295489.tmp", context #<AccessControlContext java.security.AccessControlContext@40071c64>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6b498718>}
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3642375677084295489.tmp")
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 11:38:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 11:43:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "8727", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------390067269188819108164825", "connection" "close"}, :server-port 8083, :content-length 8727, :content-type "multipart/form-data; boundary=--------------------------390067269188819108164825", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5bfd1566>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:43:35 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "8727", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------390067269188819108164825", "connection" "close"}, :server-port 8083, :content-length 8727, :content-type "multipart/form-data; boundary=--------------------------390067269188819108164825", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5bfd1566>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:43:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "8727", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------390067269188819108164825", "connection" "close"}, :server-port 8083, :content-length 8727, :content-type "multipart/form-data; boundary=--------------------------390067269188819108164825", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5bfd1566>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 11:43:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3159639879549037715.tmp
graftwerk.log:16-Nov-29 11:43:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3159639879549037715.tmp", context #<AccessControlContext java.security.AccessControlContext@13a935ed>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@15e03f3c>}
graftwerk.log:16-Nov-29 11:43:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3159639879549037715.tmp")
graftwerk.log:16-Nov-29 11:43:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 11:43:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 11:43:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 11:43:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 11:43:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 11:43:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5501", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------618375932588346686642822", "connection" "close"}, :server-port 8083, :content-length 5501, :content-type "multipart/form-data; boundary=--------------------------618375932588346686642822", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4f00a613>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5501", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------618375932588346686642822", "connection" "close"}, :server-port 8083, :content-length 5501, :content-type "multipart/form-data; boundary=--------------------------618375932588346686642822", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4f00a613>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5501", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------618375932588346686642822", "connection" "close"}, :server-port 8083, :content-length 5501, :content-type "multipart/form-data; boundary=--------------------------618375932588346686642822", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4f00a613>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7773658800051300208.tmp
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7773658800051300208.tmp", context #<AccessControlContext java.security.AccessControlContext@7d1530c0>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5d2e030f>}
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7773658800051300208.tmp")
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 13:58:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5501", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------887478187494491256582956", "connection" "close"}, :server-port 8083, :content-length 5501, :content-type "multipart/form-data; boundary=--------------------------887478187494491256582956", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4f336037>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5501", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------887478187494491256582956", "connection" "close"}, :server-port 8083, :content-length 5501, :content-type "multipart/form-data; boundary=--------------------------887478187494491256582956", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4f336037>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5501", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------887478187494491256582956", "connection" "close"}, :server-port 8083, :content-length 5501, :content-type "multipart/form-data; boundary=--------------------------887478187494491256582956", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4f336037>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4079383038513491751.tmp
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4079383038513491751.tmp", context #<AccessControlContext java.security.AccessControlContext@73139ac9>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@30bfb2ab>}
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4079383038513491751.tmp")
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 14:02:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5501", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------843179443480071626701165", "connection" "close"}, :server-port 8083, :content-length 5501, :content-type "multipart/form-data; boundary=--------------------------843179443480071626701165", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6afb13c3>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5501", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------843179443480071626701165", "connection" "close"}, :server-port 8083, :content-length 5501, :content-type "multipart/form-data; boundary=--------------------------843179443480071626701165", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6afb13c3>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5501", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------843179443480071626701165", "connection" "close"}, :server-port 8083, :content-length 5501, :content-type "multipart/form-data; boundary=--------------------------843179443480071626701165", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6afb13c3>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2949115944095205628.tmp
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2949115944095205628.tmp", context #<AccessControlContext java.security.AccessControlContext@13068e7d>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1387c3ce>}
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2949115944095205628.tmp")
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 14:02:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 15:16:07 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------381102332455707728918665", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------381102332455707728918665", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2ae9b686>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:16:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------381102332455707728918665", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------381102332455707728918665", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2ae9b686>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:16:07 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38633", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------381102332455707728918665", "connection" "close"}, :server-port 8083, :content-length 38633, :content-type "multipart/form-data; boundary=--------------------------381102332455707728918665", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2ae9b686>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:16:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Nov-29 15:16:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@4e4946cf>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@701b652b>}
graftwerk.log:16-Nov-29 15:16:11 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Nov-29 15:16:11 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 15:16:11 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 15:16:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 15:16:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 15:16:11 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 15:16:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "12362", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------226185446895969802217049", "connection" "close"}, :server-port 8083, :content-length 12362, :content-type "multipart/form-data; boundary=--------------------------226185446895969802217049", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@205b6915>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "12362", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------226185446895969802217049", "connection" "close"}, :server-port 8083, :content-length 12362, :content-type "multipart/form-data; boundary=--------------------------226185446895969802217049", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@205b6915>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "12362", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------226185446895969802217049", "connection" "close"}, :server-port 8083, :content-length 12362, :content-type "multipart/form-data; boundary=--------------------------226185446895969802217049", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@205b6915>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7599480055521032351.tmp
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7599480055521032351.tmp", context #<AccessControlContext java.security.AccessControlContext@3ad73ae2>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@3bc3a1c7>}
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7599480055521032351.tmp")
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 15:18:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-29 15:19:04 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38609", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------365668572281704718457147", "connection" "close"}, :server-port 8083, :content-length 38609, :content-type "multipart/form-data; boundary=--------------------------365668572281704718457147", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4305a339>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:19:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38609", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------365668572281704718457147", "connection" "close"}, :server-port 8083, :content-length 38609, :content-type "multipart/form-data; boundary=--------------------------365668572281704718457147", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4305a339>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:19:04 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38609", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------365668572281704718457147", "connection" "close"}, :server-port 8083, :content-length 38609, :content-type "multipart/form-data; boundary=--------------------------365668572281704718457147", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4305a339>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:19:05 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "12327", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------142916118117636587849284", "connection" "close"}, :server-port 8083, :content-length 12327, :content-type "multipart/form-data; boundary=--------------------------142916118117636587849284", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@63ef7dbc>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:19:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "12327", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------142916118117636587849284", "connection" "close"}, :server-port 8083, :content-length 12327, :content-type "multipart/form-data; boundary=--------------------------142916118117636587849284", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@63ef7dbc>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:19:05 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "12327", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------142916118117636587849284", "connection" "close"}, :server-port 8083, :content-length 12327, :content-type "multipart/form-data; boundary=--------------------------142916118117636587849284", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@63ef7dbc>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-29 15:19:05 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Nov-29 15:19:05 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-29 15:19:04 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Nov-29 15:19:05 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 09:00:21 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Nov-30 09:00:21 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Nov-30 09:06:12 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------342759727555102435120846", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------342759727555102435120846", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@227be488>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------342759727555102435120846", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------342759727555102435120846", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@227be488>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:12 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------342759727555102435120846", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------342759727555102435120846", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@227be488>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:12 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5084594581401900701.tmp
graftwerk.log:16-Nov-30 09:06:13 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5084594581401900701.tmp", context #<AccessControlContext java.security.AccessControlContext@c7185da>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6fa0d686>}
graftwerk.log:16-Nov-30 09:06:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5084594581401900701.tmp")
graftwerk.log:16-Nov-30 09:06:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 09:06:14 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:06:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 09:06:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 09:06:14 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 09:06:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 09:06:19 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------018990646735836295015554", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------018990646735836295015554", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@15bd77ee>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:19 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------018990646735836295015554", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------018990646735836295015554", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@15bd77ee>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:19 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------018990646735836295015554", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------018990646735836295015554", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@15bd77ee>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:19 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8987756280997156529.tmp
graftwerk.log:16-Nov-30 09:06:19 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8987756280997156529.tmp", context #<AccessControlContext java.security.AccessControlContext@229a4396>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5e236da1>}
graftwerk.log:16-Nov-30 09:06:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8987756280997156529.tmp")
graftwerk.log:16-Nov-30 09:06:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 09:06:20 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:06:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 09:06:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 09:06:20 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 09:06:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------874015936839557695779877", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------874015936839557695779877", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f9a0d33>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------874015936839557695779877", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------874015936839557695779877", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f9a0d33>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------874015936839557695779877", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------874015936839557695779877", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f9a0d33>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8699547544244009232.tmp
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8699547544244009232.tmp", context #<AccessControlContext java.security.AccessControlContext@60c51ff0>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1718104c>}
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8699547544244009232.tmp")
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 09:06:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 09:06:34 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------231863081978000427869876", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------231863081978000427869876", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7e1fce00>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------231863081978000427869876", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------231863081978000427869876", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7e1fce00>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:34 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------231863081978000427869876", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------231863081978000427869876", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7e1fce00>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8129328898910147869.tmp
graftwerk.log:16-Nov-30 09:06:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8129328898910147869.tmp", context #<AccessControlContext java.security.AccessControlContext@462a88d7>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@17865d0d>}
graftwerk.log:16-Nov-30 09:06:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8129328898910147869.tmp")
graftwerk.log:16-Nov-30 09:06:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 09:06:35 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:06:35 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 09:06:35 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 09:06:35 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 09:06:35 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------428170497763263990511057", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------428170497763263990511057", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22e35a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------428170497763263990511057", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------428170497763263990511057", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22e35a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------428170497763263990511057", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------428170497763263990511057", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22e35a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8589891773450369731.tmp
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8589891773450369731.tmp", context #<AccessControlContext java.security.AccessControlContext@1b8b8c88>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@30155819>}
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8589891773450369731.tmp")
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 09:06:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 09:07:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------168883835175355540969231", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------168883835175355540969231", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@545c4ced>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:07:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------168883835175355540969231", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------168883835175355540969231", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@545c4ced>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:07:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------168883835175355540969231", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------168883835175355540969231", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@545c4ced>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:07:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7189495391733636424.tmp
graftwerk.log:16-Nov-30 09:07:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID OBJTYPE]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal OBJTYPE "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7189495391733636424.tmp", context #<AccessControlContext java.security.AccessControlContext@73082b67>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7c200fc8>}
graftwerk.log:16-Nov-30 09:07:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7189495391733636424.tmp")
graftwerk.log:16-Nov-30 09:07:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 09:07:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:07:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Nov-30 09:07:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Nov-30 09:07:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Nov-30 09:07:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 09:15:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------456475255328492872582509", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------456475255328492872582509", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@586b46a4>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:15:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------456475255328492872582509", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------456475255328492872582509", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@586b46a4>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:15:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------456475255328492872582509", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------456475255328492872582509", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@586b46a4>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:15:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5843654154786906193.tmp
graftwerk.log:16-Nov-30 09:15:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID OBJTYPE]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal OBJTYPE "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5843654154786906193.tmp", context #<AccessControlContext java.security.AccessControlContext@27310be>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@25afc38c>}
graftwerk.log:16-Nov-30 09:15:59 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5843654154786906193.tmp")
graftwerk.log:16-Nov-30 09:15:59 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 09:15:59 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:15:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 09:15:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 09:15:59 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 09:15:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------485807065724904396270948", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------485807065724904396270948", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d54b522>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------485807065724904396270948", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------485807065724904396270948", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d54b522>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------485807065724904396270948", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------485807065724904396270948", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d54b522>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8414654619858007635.tmp
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID OBJTYPE]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal OBJTYPE "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8414654619858007635.tmp", context #<AccessControlContext java.security.AccessControlContext@67971818>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1eee4158>}
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8414654619858007635.tmp")
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 09:17:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------157352273669548213130357", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------157352273669548213130357", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2ff3f4ef>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------157352273669548213130357", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------157352273669548213130357", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2ff3f4ef>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------157352273669548213130357", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------157352273669548213130357", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2ff3f4ef>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1759914266188904243.tmp
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID OBJTYPE]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal OBJTYPE "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1759914266188904243.tmp", context #<AccessControlContext java.security.AccessControlContext@308e55d9>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4d8fb259>}
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1759914266188904243.tmp")
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Nov-30 09:17:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5909", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------613370265637116026752605", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5909, :content-type "multipart/form-data; boundary=--------------------------613370265637116026752605", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6e514f59>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5909", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------613370265637116026752605", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5909, :content-type "multipart/form-data; boundary=--------------------------613370265637116026752605", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6e514f59>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5909", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------613370265637116026752605", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5909, :content-type "multipart/form-data; boundary=--------------------------613370265637116026752605", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6e514f59>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3865038782896341447.tmp
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID OBJTYPE]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal OBJTYPE "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3865038782896341447.tmp", context #<AccessControlContext java.security.AccessControlContext@73cad64a>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@522e0586>}
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3865038782896341447.tmp")
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Nov-30 09:38:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5502", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------819772391782128484239919", "connection" "close"}, :server-port 8083, :content-length 5502, :content-type "multipart/form-data; boundary=--------------------------819772391782128484239919", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@336b131e>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5502", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------819772391782128484239919", "connection" "close"}, :server-port 8083, :content-length 5502, :content-type "multipart/form-data; boundary=--------------------------819772391782128484239919", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@336b131e>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5502", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------819772391782128484239919", "connection" "close"}, :server-port 8083, :content-length 5502, :content-type "multipart/form-data; boundary=--------------------------819772391782128484239919", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@336b131e>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4900950969207871455.tmp
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4900950969207871455.tmp", context #<AccessControlContext java.security.AccessControlContext@1649f87b>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2494d34c>}
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4900950969207871455.tmp")
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 11:03:40 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5538", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------019327904280752584450299", "connection" "close"}, :server-port 8083, :content-length 5538, :content-type "multipart/form-data; boundary=--------------------------019327904280752584450299", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@56ca3cac>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5538", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------019327904280752584450299", "connection" "close"}, :server-port 8083, :content-length 5538, :content-type "multipart/form-data; boundary=--------------------------019327904280752584450299", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@56ca3cac>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5538", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------019327904280752584450299", "connection" "close"}, :server-port 8083, :content-length 5538, :content-type "multipart/form-data; boundary=--------------------------019327904280752584450299", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@56ca3cac>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5937700619439166980.tmp
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5937700619439166980.tmp", context #<AccessControlContext java.security.AccessControlContext@20a695f3>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@3685230f>}
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5937700619439166980.tmp")
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 11:16:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5538", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------788723109182051243589678", "connection" "close"}, :server-port 8083, :content-length 5538, :content-type "multipart/form-data; boundary=--------------------------788723109182051243589678", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3ad9f22c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5538", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------788723109182051243589678", "connection" "close"}, :server-port 8083, :content-length 5538, :content-type "multipart/form-data; boundary=--------------------------788723109182051243589678", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3ad9f22c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5538", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------788723109182051243589678", "connection" "close"}, :server-port 8083, :content-length 5538, :content-type "multipart/form-data; boundary=--------------------------788723109182051243589678", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3ad9f22c>, :scheme :http, :request-method :post}
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2189209116521224372.tmp
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2189209116521224372.tmp", context #<AccessControlContext java.security.AccessControlContext@78f80aae>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@200a4d36>}
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2189209116521224372.tmp")
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Nov-30 12:28:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-01 10:11:26 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-01 10:11:26 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-01 10:59:38 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-01 10:59:38 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-01 16:18:13 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------250423715162937330716166", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------250423715162937330716166", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f61f29>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-01 16:18:13 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------250423715162937330716166", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------250423715162937330716166", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f61f29>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-01 16:18:13 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------250423715162937330716166", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------250423715162937330716166", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f61f29>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-01 16:18:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8569103011176333064.tmp
graftwerk.log:16-Dec-01 16:18:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID OBJTYPE]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal OBJTYPE "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8569103011176333064.tmp", context #<AccessControlContext java.security.AccessControlContext@bff6b89>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@65706593>}
graftwerk.log:16-Dec-01 16:18:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8569103011176333064.tmp")
graftwerk.log:16-Dec-01 16:18:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-01 16:18:16 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-01 16:18:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-01 16:18:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-01 16:18:16 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-01 16:18:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------937926677462061443324055", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------937926677462061443324055", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@52f9c1aa>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------937926677462061443324055", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------937926677462061443324055", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@52f9c1aa>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------937926677462061443324055", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------937926677462061443324055", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@52f9c1aa>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8016982077673125528.tmp
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID OBJTYPE]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal OBJTYPE "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8016982077673125528.tmp", context #<AccessControlContext java.security.AccessControlContext@7a506dc5>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@57016cbe>}
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8016982077673125528.tmp")
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-01 16:18:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 08:39:27 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-02 08:39:27 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-02 09:57:41 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5488", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------993333218055123091753969", "connection" "close"}, :server-port 8083, :content-length 5488, :content-type "multipart/form-data; boundary=--------------------------993333218055123091753969", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ee50d45>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 09:57:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5488", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------993333218055123091753969", "connection" "close"}, :server-port 8083, :content-length 5488, :content-type "multipart/form-data; boundary=--------------------------993333218055123091753969", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ee50d45>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 09:57:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5488", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------993333218055123091753969", "connection" "close"}, :server-port 8083, :content-length 5488, :content-type "multipart/form-data; boundary=--------------------------993333218055123091753969", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ee50d45>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 09:57:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1894748043217392115.tmp
graftwerk.log:16-Dec-02 09:57:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1894748043217392115.tmp", context #<AccessControlContext java.security.AccessControlContext@55ae0b9e>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@515e5057>}
graftwerk.log:16-Dec-02 09:57:44 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1894748043217392115.tmp")
graftwerk.log:16-Dec-02 09:57:44 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-02 09:57:44 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------611844263715309248703635", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------611844263715309248703635", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ca821d5>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------611844263715309248703635", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------611844263715309248703635", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ca821d5>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------611844263715309248703635", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------611844263715309248703635", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ca821d5>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5895140210861911526.tmp
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5895140210861911526.tmp", context #<AccessControlContext java.security.AccessControlContext@36e10ea0>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@57ad2334>}
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5895140210861911526.tmp")
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 10:00:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 10:00:43 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------992386226547728300743767", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------992386226547728300743767", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1c35d746>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 10:00:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------992386226547728300743767", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------992386226547728300743767", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1c35d746>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 10:00:43 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------992386226547728300743767", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------992386226547728300743767", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1c35d746>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 10:00:43 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4660688094975837095.tmp
graftwerk.log:16-Dec-02 10:00:43 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4660688094975837095.tmp", context #<AccessControlContext java.security.AccessControlContext@5cdb82cd>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@677dc8d8>}
graftwerk.log:16-Dec-02 10:00:44 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4660688094975837095.tmp")
graftwerk.log:16-Dec-02 10:00:44 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 10:00:44 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 10:00:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 10:00:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 10:00:44 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 10:00:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------156928876782510755743272", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------156928876782510755743272", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@770f35a2>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------156928876782510755743272", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------156928876782510755743272", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@770f35a2>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------156928876782510755743272", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------156928876782510755743272", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@770f35a2>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6621000645287746493.tmp
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6621000645287746493.tmp", context #<AccessControlContext java.security.AccessControlContext@4655054b>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4f4aee02>}
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6621000645287746493.tmp")
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 11:13:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------494742438825425514650496", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------494742438825425514650496", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@33953f83>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------494742438825425514650496", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------494742438825425514650496", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@33953f83>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------494742438825425514650496", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------494742438825425514650496", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@33953f83>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8581131275941117530.tmp
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8581131275941117530.tmp", context #<AccessControlContext java.security.AccessControlContext@1bf37e12>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6b364fc5>}
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8581131275941117530.tmp")
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 11:13:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:13:54 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5732", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------400847598125756564523213", "connection" "close"}, :server-port 8083, :content-length 5732, :content-type "multipart/form-data; boundary=--------------------------400847598125756564523213", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3dacfadb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:13:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5732", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------400847598125756564523213", "connection" "close"}, :server-port 8083, :content-length 5732, :content-type "multipart/form-data; boundary=--------------------------400847598125756564523213", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3dacfadb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:13:54 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5732", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------400847598125756564523213", "connection" "close"}, :server-port 8083, :content-length 5732, :content-type "multipart/form-data; boundary=--------------------------400847598125756564523213", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3dacfadb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:13:54 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-631574964634618940.tmp
graftwerk.log:16-Dec-02 11:13:54 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}] (graph "http://www.example.no/#/"))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-631574964634618940.tmp", context #<AccessControlContext java.security.AccessControlContext@6ee09264>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1649f87b>}
graftwerk.log:16-Dec-02 11:13:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-631574964634618940.tmp")
graftwerk.log:16-Dec-02 11:13:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 11:13:55 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:13:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 11:13:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 11:13:55 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 11:13:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:14:09 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5807", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------022717328132384049138509", "connection" "close"}, :server-port 8083, :content-length 5807, :content-type "multipart/form-data; boundary=--------------------------022717328132384049138509", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@23b62aa9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5807", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------022717328132384049138509", "connection" "close"}, :server-port 8083, :content-length 5807, :content-type "multipart/form-data; boundary=--------------------------022717328132384049138509", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@23b62aa9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5807", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------022717328132384049138509", "connection" "close"}, :server-port 8083, :content-length 5807, :content-type "multipart/form-data; boundary=--------------------------022717328132384049138509", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@23b62aa9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5187631174535975633.tmp
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE]}] (graph "http://www.example.no/#/" (graph0 OBJTYPE)))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5187631174535975633.tmp", context #<AccessControlContext java.security.AccessControlContext@3c966284>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@460b63d0>}
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5187631174535975633.tmp")
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 11:14:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5843", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------270502678172551030793652", "connection" "close"}, :server-port 8083, :content-length 5843, :content-type "multipart/form-data; boundary=--------------------------270502678172551030793652", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22e35a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5843", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------270502678172551030793652", "connection" "close"}, :server-port 8083, :content-length 5843, :content-type "multipart/form-data; boundary=--------------------------270502678172551030793652", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22e35a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5843", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------270502678172551030793652", "connection" "close"}, :server-port 8083, :content-length 5843, :content-type "multipart/form-data; boundary=--------------------------270502678172551030793652", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22e35a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2771914567557834611.tmp
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE)]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2771914567557834611.tmp", context #<AccessControlContext java.security.AccessControlContext@2ecf41e7>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@3d54b522>}
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2771914567557834611.tmp")
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 11:14:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------338384445512423655588651", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------338384445512423655588651", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f9a0d33>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------338384445512423655588651", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------338384445512423655588651", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f9a0d33>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------338384445512423655588651", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------338384445512423655588651", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f9a0d33>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7350969710122546581.tmp
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7350969710122546581.tmp", context #<AccessControlContext java.security.AccessControlContext@60c51ff0>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1718104c>}
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7350969710122546581.tmp")
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 11:14:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:14:36 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------311113193295568959042565", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------311113193295568959042565", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1ad48b22>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------311113193295568959042565", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------311113193295568959042565", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1ad48b22>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:36 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------311113193295568959042565", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------311113193295568959042565", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1ad48b22>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:14:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-566476721669479134.tmp
graftwerk.log:16-Dec-02 11:14:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-566476721669479134.tmp", context #<AccessControlContext java.security.AccessControlContext@72e8d2c5>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@10d2d58e>}
graftwerk.log:16-Dec-02 11:14:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-566476721669479134.tmp")
graftwerk.log:16-Dec-02 11:14:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 11:14:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:14:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 11:14:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 11:14:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 11:14:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------513082475530707131271747", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------513082475530707131271747", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74b5b436>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------513082475530707131271747", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------513082475530707131271747", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74b5b436>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------513082475530707131271747", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------513082475530707131271747", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74b5b436>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8891909175523606215.tmp
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8891909175523606215.tmp", context #<AccessControlContext java.security.AccessControlContext@5f1916c2>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1846dade>}
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8891909175523606215.tmp")
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 11:19:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:20:33 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------615232706497324411435910", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------615232706497324411435910", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6e89e755>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:20:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------615232706497324411435910", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------615232706497324411435910", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6e89e755>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:20:33 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------615232706497324411435910", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------615232706497324411435910", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6e89e755>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:20:33 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6234507833345119987.tmp
graftwerk.log:16-Dec-02 11:20:33 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6234507833345119987.tmp", context #<AccessControlContext java.security.AccessControlContext@22959db>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2d8bc333>}
graftwerk.log:16-Dec-02 11:20:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6234507833345119987.tmp")
graftwerk.log:16-Dec-02 11:20:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 11:20:34 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:20:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 11:20:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 11:20:34 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 11:20:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 11:20:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------939687130731877816773941", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------939687130731877816773941", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@34a77e92>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:20:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------939687130731877816773941", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------939687130731877816773941", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@34a77e92>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:20:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------939687130731877816773941", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------939687130731877816773941", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@34a77e92>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 11:20:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1910297778865548972.tmp
graftwerk.log:16-Dec-02 11:20:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1910297778865548972.tmp", context #<AccessControlContext java.security.AccessControlContext@661ad549>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@70fb6530>}
graftwerk.log:16-Dec-02 11:20:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1910297778865548972.tmp")
graftwerk.log:16-Dec-02 11:20:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 11:20:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-02 11:20:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-02 11:20:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-02 11:20:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-02 11:20:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-02 13:25:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------278509581957680358494336", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------278509581957680358494336", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5bea169d>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:25:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------278509581957680358494336", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------278509581957680358494336", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5bea169d>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:25:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------278509581957680358494336", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------278509581957680358494336", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5bea169d>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:25:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4541679713578829342.tmp
graftwerk.log:16-Dec-02 13:25:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4541679713578829342.tmp", context #<AccessControlContext java.security.AccessControlContext@4ecb8ca6>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@175c59cb>}
graftwerk.log:16-Dec-02 13:25:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4541679713578829342.tmp")
graftwerk.log:16-Dec-02 13:25:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 13:25:29 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:25:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 13:25:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 13:25:29 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 13:25:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 13:33:25 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------648058032157233285673800", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------648058032157233285673800", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2228b368>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:33:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------648058032157233285673800", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------648058032157233285673800", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2228b368>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:33:25 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------648058032157233285673800", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------648058032157233285673800", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2228b368>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:33:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4595540448976800107.tmp
graftwerk.log:16-Dec-02 13:33:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4595540448976800107.tmp", context #<AccessControlContext java.security.AccessControlContext@3b28c3e4>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@29d939d9>}
graftwerk.log:16-Dec-02 13:33:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4595540448976800107.tmp")
graftwerk.log:16-Dec-02 13:33:26 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:33:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-02 13:33:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-02 13:33:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-02 13:33:26 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-02 13:33:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------848353822970715759076941", "connection" "close", "accept" "application/octet-stream"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------848353822970715759076941", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6b835651>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------848353822970715759076941", "connection" "close", "accept" "application/octet-stream"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------848353822970715759076941", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6b835651>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------848353822970715759076941", "connection" "close", "accept" "application/octet-stream"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------848353822970715759076941", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6b835651>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8869118072695434504.tmp
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8869118072695434504.tmp", context #<AccessControlContext java.security.AccessControlContext@63e9112a>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@14980aae>}
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8869118072695434504.tmp")
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/octet-stream
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/octet-stream selected  application/octet-stream
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-02 13:34:28 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unexpected exception whilst streaming RDF
graftwerk.log:                                        [33mclojure.core/binding-conveyor-fn/[1;33mfn[m  [32m   core.clj: 1910[m
graftwerk.log:                                         [33mring.util.io/piped-input-stream/[1;33mfn[m  [32m     io.clj:   28[m
graftwerk.log:[33mgraftwerk.middleware.dataset/wrap-write-dataset/write-dataset-middleware/[1;33mfn[m  [32mdataset.clj:  149[m
graftwerk.log:                                              [33mgrafter.rdf.io/[1;33mrdf-serializer[m  [32m     io.clj:  382[m
graftwerk.log:16-Dec-02 13:35:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------273951813596322847417911", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------273951813596322847417911", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2547e662>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:35:35 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------273951813596322847417911", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------273951813596322847417911", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2547e662>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:35:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------273951813596322847417911", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------273951813596322847417911", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2547e662>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:35:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6819059363750180715.tmp
graftwerk.log:16-Dec-02 13:35:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6819059363750180715.tmp", context #<AccessControlContext java.security.AccessControlContext@6a078181>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6f58198c>}
graftwerk.log:16-Dec-02 13:35:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6819059363750180715.tmp")
graftwerk.log:16-Dec-02 13:35:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:35:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-02 13:35:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-02 13:35:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-02 13:35:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-02 13:35:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------593499145202649025634646", "connection" "close", "accept" "application/rdf+xml"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------593499145202649025634646", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3f9fee7e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------593499145202649025634646", "connection" "close", "accept" "application/rdf+xml"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------593499145202649025634646", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3f9fee7e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------593499145202649025634646", "connection" "close", "accept" "application/rdf+xml"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------593499145202649025634646", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3f9fee7e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-361315077301171870.tmp
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-361315077301171870.tmp", context #<AccessControlContext java.security.AccessControlContext@35ba6cd8>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@74432c8a>}
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-361315077301171870.tmp")
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/rdf+xml
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/rdf+xml selected  application/rdf+xml
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/rdf+xml"}
graftwerk.log:16-Dec-02 13:38:06 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------140204894880345303426290", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------140204894880345303426290", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@53d809d5>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------140204894880345303426290", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------140204894880345303426290", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@53d809d5>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------140204894880345303426290", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------140204894880345303426290", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@53d809d5>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6035646221401417564.tmp
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6035646221401417564.tmp", context #<AccessControlContext java.security.AccessControlContext@1e89ca8a>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5a199143>}
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------322905769698308185206747", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------322905769698308185206747", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@51116c42>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------322905769698308185206747", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------322905769698308185206747", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@51116c42>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------322905769698308185206747", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------322905769698308185206747", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@51116c42>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3919810228410817889.tmp
graftwerk.log:16-Dec-02 13:38:57 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3919810228410817889.tmp", context #<AccessControlContext java.security.AccessControlContext@760bfbc2>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5db8bec4>}
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6035646221401417564.tmp")
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3919810228410817889.tmp")
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 13:38:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------721693418762464967196570", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------721693418762464967196570", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3658c36f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------721693418762464967196570", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------721693418762464967196570", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3658c36f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------721693418762464967196570", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------721693418762464967196570", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3658c36f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-834746556786229705.tmp
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-834746556786229705.tmp", context #<AccessControlContext java.security.AccessControlContext@595faa9d>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@16b94eed>}
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-834746556786229705.tmp")
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 13:39:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 13:39:50 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------477341848912167378673063", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------477341848912167378673063", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@44d458b7>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:39:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------477341848912167378673063", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------477341848912167378673063", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@44d458b7>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:39:50 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------477341848912167378673063", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------477341848912167378673063", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@44d458b7>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:39:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5429371897266465482.tmp
graftwerk.log:16-Dec-02 13:39:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5429371897266465482.tmp", context #<AccessControlContext java.security.AccessControlContext@3611c22>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@240cc649>}
graftwerk.log:16-Dec-02 13:39:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5429371897266465482.tmp")
graftwerk.log:16-Dec-02 13:39:51 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:39:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-02 13:39:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-02 13:39:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-02 13:39:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-02 13:39:51 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-02 13:40:07 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------212862526617854279331314", "connection" "close", "accept" "application/rdf+xml"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------212862526617854279331314", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@338c185a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:40:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------212862526617854279331314", "connection" "close", "accept" "application/rdf+xml"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------212862526617854279331314", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@338c185a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:40:07 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------212862526617854279331314", "connection" "close", "accept" "application/rdf+xml"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------212862526617854279331314", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@338c185a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:40:07 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5202671350683044720.tmp
graftwerk.log:16-Dec-02 13:40:07 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5202671350683044720.tmp", context #<AccessControlContext java.security.AccessControlContext@301999ad>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4172aa8f>}
graftwerk.log:16-Dec-02 13:40:08 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5202671350683044720.tmp")
graftwerk.log:16-Dec-02 13:40:08 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:40:08 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/rdf+xml
graftwerk.log:16-Dec-02 13:40:08 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/rdf+xml selected  application/rdf+xml
graftwerk.log:16-Dec-02 13:40:08 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-02 13:40:08 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/rdf+xml"}
graftwerk.log:16-Dec-02 13:40:08 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-02 13:43:54 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46540", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------422364065882805161278500", "connection" "close"}, :server-port 8083, :content-length 46540, :content-type "multipart/form-data; boundary=--------------------------422364065882805161278500", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@437b84c8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:43:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46540", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------422364065882805161278500", "connection" "close"}, :server-port 8083, :content-length 46540, :content-type "multipart/form-data; boundary=--------------------------422364065882805161278500", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@437b84c8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:43:54 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46540", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------422364065882805161278500", "connection" "close"}, :server-port 8083, :content-length 46540, :content-type "multipart/form-data; boundary=--------------------------422364065882805161278500", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@437b84c8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:43:54 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-889857029096427316.tmp
graftwerk.log:16-Dec-02 13:43:54 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-889857029096427316.tmp", context #<AccessControlContext java.security.AccessControlContext@4d8fb259>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@652c9d9>}
graftwerk.log:16-Dec-02 13:43:54 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-889857029096427316.tmp")
graftwerk.log:16-Dec-02 13:43:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 13:43:55 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:43:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 13:43:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 13:43:55 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 13:43:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 13:44:32 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "46540", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------207056533035332901528269", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 46540, :content-type "multipart/form-data; boundary=--------------------------207056533035332901528269", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@112a4399>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:44:32 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "46540", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------207056533035332901528269", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 46540, :content-type "multipart/form-data; boundary=--------------------------207056533035332901528269", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@112a4399>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:44:32 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "46540", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------207056533035332901528269", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 46540, :content-type "multipart/form-data; boundary=--------------------------207056533035332901528269", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@112a4399>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:44:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2114052417669913015.tmp
graftwerk.log:16-Dec-02 13:44:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2114052417669913015.tmp", context #<AccessControlContext java.security.AccessControlContext@6e0a913f>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4af0a826>}
graftwerk.log:16-Dec-02 13:44:33 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2114052417669913015.tmp")
graftwerk.log:16-Dec-02 13:44:33 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 13:44:33 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:44:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 13:44:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 13:44:33 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 13:44:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "43468", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------634800465835089362131479", "connection" "close"}, :server-port 8083, :content-length 43468, :content-type "multipart/form-data; boundary=--------------------------634800465835089362131479", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@692cf470>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "43468", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------634800465835089362131479", "connection" "close"}, :server-port 8083, :content-length 43468, :content-type "multipart/form-data; boundary=--------------------------634800465835089362131479", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@692cf470>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "43468", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------634800465835089362131479", "connection" "close"}, :server-port 8083, :content-length 43468, :content-type "multipart/form-data; boundary=--------------------------634800465835089362131479", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@692cf470>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1206420313596205008.tmp
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1206420313596205008.tmp", context #<AccessControlContext java.security.AccessControlContext@70eb4c98>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4d021237>}
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1206420313596205008.tmp")
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 13:47:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46540", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------076584039500395879645278", "connection" "close"}, :server-port 8083, :content-length 46540, :content-type "multipart/form-data; boundary=--------------------------076584039500395879645278", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@17067390>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46540", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------076584039500395879645278", "connection" "close"}, :server-port 8083, :content-length 46540, :content-type "multipart/form-data; boundary=--------------------------076584039500395879645278", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@17067390>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46540", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------076584039500395879645278", "connection" "close"}, :server-port 8083, :content-length 46540, :content-type "multipart/form-data; boundary=--------------------------076584039500395879645278", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@17067390>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3832193490502350401.tmp
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3832193490502350401.tmp", context #<AccessControlContext java.security.AccessControlContext@4aa773c0>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@11448fbf>}
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3832193490502350401.tmp")
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 13:54:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 13:57:41 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------779882339311974162584684", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------779882339311974162584684", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1e1a4c95>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:57:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------779882339311974162584684", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------779882339311974162584684", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1e1a4c95>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:57:41 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------779882339311974162584684", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------779882339311974162584684", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1e1a4c95>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 13:57:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7301935774612033937.tmp
graftwerk.log:16-Dec-02 13:57:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7301935774612033937.tmp", context #<AccessControlContext java.security.AccessControlContext@767e2375>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@77f783f0>}
graftwerk.log:16-Dec-02 13:57:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7301935774612033937.tmp")
graftwerk.log:16-Dec-02 13:57:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 13:57:42 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 13:57:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 13:57:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 13:57:42 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 13:57:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 14:06:36 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------502285516567505378870131", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------502285516567505378870131", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6dc33ebc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:06:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------502285516567505378870131", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------502285516567505378870131", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6dc33ebc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:06:36 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------502285516567505378870131", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------502285516567505378870131", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6dc33ebc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:06:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-794938296928098723.tmp
graftwerk.log:16-Dec-02 14:06:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-794938296928098723.tmp", context #<AccessControlContext java.security.AccessControlContext@59d974c1>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7b42bfc7>}
graftwerk.log:16-Dec-02 14:06:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-794938296928098723.tmp")
graftwerk.log:16-Dec-02 14:06:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 14:06:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 14:06:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 14:06:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 14:06:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:06:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 14:29:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------480482387334714191872713", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------480482387334714191872713", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3be6341f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:29:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------480482387334714191872713", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------480482387334714191872713", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3be6341f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:29:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------480482387334714191872713", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------480482387334714191872713", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3be6341f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:29:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8538189832824646059.tmp
graftwerk.log:16-Dec-02 14:29:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8538189832824646059.tmp", context #<AccessControlContext java.security.AccessControlContext@61364157>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@71d92e31>}
graftwerk.log:16-Dec-02 14:29:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8538189832824646059.tmp")
graftwerk.log:16-Dec-02 14:29:50 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-02 14:29:50 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/graft   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:30:01 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------093595980032411744411768", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------093595980032411744411768", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7b7f9ea8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:30:01 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------093595980032411744411768", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------093595980032411744411768", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7b7f9ea8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:30:01 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------093595980032411744411768", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------093595980032411744411768", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7b7f9ea8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:30:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8613626974406264835.tmp
graftwerk.log:16-Dec-02 14:30:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8613626974406264835.tmp", context #<AccessControlContext java.security.AccessControlContext@6d065a3>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@311760dc>}
graftwerk.log:16-Dec-02 14:30:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8613626974406264835.tmp")
graftwerk.log:16-Dec-02 14:30:01 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-02 14:30:01 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/graft   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:30:17 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------507259572411649600043634", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------507259572411649600043634", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@622a5da8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:30:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------507259572411649600043634", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------507259572411649600043634", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@622a5da8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:30:17 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------507259572411649600043634", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------507259572411649600043634", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@622a5da8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:30:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1939534567154645872.tmp
graftwerk.log:16-Dec-02 14:30:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1939534567154645872.tmp", context #<AccessControlContext java.security.AccessControlContext@44365c85>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4d515504>}
graftwerk.log:16-Dec-02 14:30:18 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1939534567154645872.tmp")
graftwerk.log:16-Dec-02 14:30:18 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-02 14:30:18 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/graft   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:31:04 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------731188134899863611192222", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------731188134899863611192222", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d85f45c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------731188134899863611192222", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------731188134899863611192222", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d85f45c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:04 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------731188134899863611192222", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------731188134899863611192222", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d85f45c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:04 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4473333083434171618.tmp
graftwerk.log:16-Dec-02 14:31:04 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4473333083434171618.tmp", context #<AccessControlContext java.security.AccessControlContext@2b1960c2>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6b86d891>}
graftwerk.log:16-Dec-02 14:31:05 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4473333083434171618.tmp")
graftwerk.log:16-Dec-02 14:31:05 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 14:31:05 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 14:31:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 14:31:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 14:31:05 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:31:05 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 14:31:08 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------955793144696220028483326", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------955793144696220028483326", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@229bb8b3>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:08 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------955793144696220028483326", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------955793144696220028483326", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@229bb8b3>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:08 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------955793144696220028483326", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------955793144696220028483326", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@229bb8b3>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:08 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1872398723756954928.tmp
graftwerk.log:16-Dec-02 14:31:08 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1872398723756954928.tmp", context #<AccessControlContext java.security.AccessControlContext@f1b127e>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@60f3c41>}
graftwerk.log:16-Dec-02 14:31:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1872398723756954928.tmp")
graftwerk.log:16-Dec-02 14:31:09 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-02 14:31:09 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/graft   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:31:23 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------211460022749571186423891", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------211460022749571186423891", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@29b78328>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------211460022749571186423891", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------211460022749571186423891", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@29b78328>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:23 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------211460022749571186423891", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------211460022749571186423891", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@29b78328>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6949265075421016488.tmp
graftwerk.log:16-Dec-02 14:31:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6949265075421016488.tmp", context #<AccessControlContext java.security.AccessControlContext@355981bc>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7d96d809>}
graftwerk.log:16-Dec-02 14:31:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6949265075421016488.tmp")
graftwerk.log:16-Dec-02 14:31:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 14:31:24 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 14:31:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 14:31:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 14:31:24 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 14:31:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------321854715099407814359867", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------321854715099407814359867", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@134586af>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------321854715099407814359867", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------321854715099407814359867", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@134586af>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------321854715099407814359867", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------321854715099407814359867", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@134586af>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8053870187444363382.tmp
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8053870187444363382.tmp", context #<AccessControlContext java.security.AccessControlContext@51618d34>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1773a4e0>}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------761394556984291095675516", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------761394556984291095675516", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@35679daf>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------761394556984291095675516", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------761394556984291095675516", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@35679daf>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------761394556984291095675516", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------761394556984291095675516", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@35679daf>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6699368893033893332.tmp
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6699368893033893332.tmp", context #<AccessControlContext java.security.AccessControlContext@1470c83f>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@49f6ab92>}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8053870187444363382.tmp")
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:31:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 14:31:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6699368893033893332.tmp")
graftwerk.log:16-Dec-02 14:31:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 14:31:48 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 14:31:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 14:31:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 14:31:48 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 14:31:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 14:49:20 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------296960063290323718217542", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------296960063290323718217542", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6482dd28>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:49:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------296960063290323718217542", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------296960063290323718217542", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6482dd28>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:49:20 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------296960063290323718217542", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------296960063290323718217542", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6482dd28>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:49:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3023796267094530383.tmp
graftwerk.log:16-Dec-02 14:49:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3023796267094530383.tmp", context #<AccessControlContext java.security.AccessControlContext@3a81e89c>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@27fab28d>}
graftwerk.log:16-Dec-02 14:49:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3023796267094530383.tmp")
graftwerk.log:16-Dec-02 14:49:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 14:49:21 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 14:49:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 14:49:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 14:49:21 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:49:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 14:49:23 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------009560550552272560846106", "connection" "close", "accept" "application/octet-stream"}, :server-port 8083, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------009560550552272560846106", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1c6bf8e0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:49:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------009560550552272560846106", "connection" "close", "accept" "application/octet-stream"}, :server-port 8083, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------009560550552272560846106", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1c6bf8e0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:49:23 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------009560550552272560846106", "connection" "close", "accept" "application/octet-stream"}, :server-port 8083, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------009560550552272560846106", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1c6bf8e0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:49:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4563293638603961134.tmp
graftwerk.log:16-Dec-02 14:49:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4563293638603961134.tmp", context #<AccessControlContext java.security.AccessControlContext@22013c4>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@10624e60>}
graftwerk.log:16-Dec-02 14:49:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4563293638603961134.tmp")
graftwerk.log:16-Dec-02 14:49:23 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-02 14:49:24 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/graft   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:50:26 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-02 14:50:26 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-02 14:51:04 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------537339676686865342806389", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------537339676686865342806389", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4aa79f87>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:51:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------537339676686865342806389", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------537339676686865342806389", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4aa79f87>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:51:04 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------537339676686865342806389", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------537339676686865342806389", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4aa79f87>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:51:05 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5480560633361256717.tmp
graftwerk.log:16-Dec-02 14:51:05 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5480560633361256717.tmp", context #<AccessControlContext java.security.AccessControlContext@352806db>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1acb05da>}
graftwerk.log:16-Dec-02 14:51:06 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5480560633361256717.tmp")
graftwerk.log:16-Dec-02 14:51:07 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 14:51:07 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 14:51:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 14:51:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 14:51:07 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 14:51:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 14:53:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------154748488598853177272664", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------154748488598853177272664", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2cba21fc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:53:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------154748488598853177272664", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------154748488598853177272664", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2cba21fc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:53:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------154748488598853177272664", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------154748488598853177272664", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2cba21fc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:53:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8057683398915154868.tmp
graftwerk.log:16-Dec-02 14:53:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8057683398915154868.tmp", context #<AccessControlContext java.security.AccessControlContext@36ac5a82>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4fbdb58d>}
graftwerk.log:16-Dec-02 14:53:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8057683398915154868.tmp")
graftwerk.log:16-Dec-02 14:53:29 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-02 14:53:29 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/graft   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:53:53 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47072", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------817566612820695711913333", "connection" "close"}, :server-port 8083, :content-length 47072, :content-type "multipart/form-data; boundary=--------------------------817566612820695711913333", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@134d4173>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:53:53 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47072", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------817566612820695711913333", "connection" "close"}, :server-port 8083, :content-length 47072, :content-type "multipart/form-data; boundary=--------------------------817566612820695711913333", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@134d4173>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:53:53 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47072", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------817566612820695711913333", "connection" "close"}, :server-port 8083, :content-length 47072, :content-type "multipart/form-data; boundary=--------------------------817566612820695711913333", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@134d4173>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:53:53 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3900591345774173794.tmp
graftwerk.log:16-Dec-02 14:53:53 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3900591345774173794.tmp", context #<AccessControlContext java.security.AccessControlContext@2df39406>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@208cae18>}
graftwerk.log:16-Dec-02 14:53:53 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3900591345774173794.tmp")
graftwerk.log:16-Dec-02 14:53:54 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 14:53:54 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 14:53:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-02 14:53:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-02 14:53:54 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-02 14:53:54 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 14:53:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------299624518389100701638137", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------299624518389100701638137", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74669dba>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:53:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------299624518389100701638137", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------299624518389100701638137", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74669dba>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:53:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------299624518389100701638137", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------299624518389100701638137", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74669dba>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 14:53:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1695012666728553523.tmp
graftwerk.log:16-Dec-02 14:53:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1695012666728553523.tmp", context #<AccessControlContext java.security.AccessControlContext@3e27e9dd>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@24d4b0bd>}
graftwerk.log:16-Dec-02 14:53:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1695012666728553523.tmp")
graftwerk.log:16-Dec-02 14:53:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 14:53:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 14:53:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 14:53:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 14:53:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 14:53:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------238238389676999479111277", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------238238389676999479111277", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1b7a8b29>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------238238389676999479111277", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------238238389676999479111277", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1b7a8b29>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------238238389676999479111277", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------238238389676999479111277", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1b7a8b29>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7329310506974236121.tmp
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7329310506974236121.tmp", context #<AccessControlContext java.security.AccessControlContext@5e236da1>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@19f69cd3>}
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7329310506974236121.tmp")
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-02 15:02:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------937411056721127794378833", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------937411056721127794378833", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4cb499e4>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------937411056721127794378833", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------937411056721127794378833", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4cb499e4>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------937411056721127794378833", "connection" "close", "accept" "application/csv"}, :server-port 3000, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------937411056721127794378833", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4cb499e4>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6195526163341015461.tmp
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6195526163341015461.tmp", context #<AccessControlContext java.security.AccessControlContext@5eee4e73>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@233dd777>}
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6195526163341015461.tmp")
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/csv
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/csv selected  application/csv
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/csv"}
graftwerk.log:16-Dec-02 15:02:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-02 15:02:53 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5882", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------649214893058227985315188", "connection" "close"}, :server-port 8083, :content-length 5882, :content-type "multipart/form-data; boundary=--------------------------649214893058227985315188", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4108bf83>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 15:02:53 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5882", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------649214893058227985315188", "connection" "close"}, :server-port 8083, :content-length 5882, :content-type "multipart/form-data; boundary=--------------------------649214893058227985315188", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4108bf83>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 15:02:53 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5882", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------649214893058227985315188", "connection" "close"}, :server-port 8083, :content-length 5882, :content-type "multipart/form-data; boundary=--------------------------649214893058227985315188", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4108bf83>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-02 15:02:53 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-287089114640346974.tmp
graftwerk.log:16-Dec-02 15:02:53 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-287089114640346974.tmp", context #<AccessControlContext java.security.AccessControlContext@6aef1055>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@545c0bb1>}
graftwerk.log:16-Dec-02 15:02:53 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-287089114640346974.tmp")
graftwerk.log:16-Dec-02 15:02:53 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-02 15:02:53 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 08:32:17 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-05 08:32:17 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-05 08:45:08 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------389814099450120380632800", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------389814099450120380632800", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7a5ea74c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:45:08 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------389814099450120380632800", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------389814099450120380632800", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7a5ea74c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:45:08 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------389814099450120380632800", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------389814099450120380632800", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7a5ea74c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:45:08 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2626483971185730410.tmp
graftwerk.log:16-Dec-05 08:45:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2626483971185730410.tmp", context #<AccessControlContext java.security.AccessControlContext@7e78426f>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@25bd11d5>}
graftwerk.log:16-Dec-05 08:45:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2626483971185730410.tmp")
graftwerk.log:16-Dec-05 08:45:11 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 08:45:11 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 08:45:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 08:45:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 08:45:11 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 08:45:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------754309722918456017124585", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------754309722918456017124585", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@64a0c903>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------754309722918456017124585", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------754309722918456017124585", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@64a0c903>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------754309722918456017124585", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------754309722918456017124585", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@64a0c903>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-923129776860655628.tmp
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-923129776860655628.tmp", context #<AccessControlContext java.security.AccessControlContext@66495314>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@16e84b4e>}
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-923129776860655628.tmp")
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 08:45:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47072", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------232017353978642429123622", "connection" "close"}, :server-port 8083, :content-length 47072, :content-type "multipart/form-data; boundary=--------------------------232017353978642429123622", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22e35a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47072", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------232017353978642429123622", "connection" "close"}, :server-port 8083, :content-length 47072, :content-type "multipart/form-data; boundary=--------------------------232017353978642429123622", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22e35a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47072", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------232017353978642429123622", "connection" "close"}, :server-port 8083, :content-length 47072, :content-type "multipart/form-data; boundary=--------------------------232017353978642429123622", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22e35a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4910002559537647345.tmp
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4910002559537647345.tmp", context #<AccessControlContext java.security.AccessControlContext@1b8b8c88>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@30155819>}
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4910002559537647345.tmp")
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 08:46:34 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------652844342929616894929195", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------652844342929616894929195", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d54b522>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------652844342929616894929195", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------652844342929616894929195", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d54b522>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------652844342929616894929195", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------652844342929616894929195", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d54b522>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8994817200659559735.tmp
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8994817200659559735.tmp", context #<AccessControlContext java.security.AccessControlContext@6d92a3d7>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@746c4371>}
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8994817200659559735.tmp")
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 08:46:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------820137667648742470338558", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------820137667648742470338558", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1eee4158>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------820137667648742470338558", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------820137667648742470338558", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1eee4158>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------820137667648742470338558", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------820137667648742470338558", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1eee4158>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7550704686798044488.tmp
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7550704686798044488.tmp", context #<AccessControlContext java.security.AccessControlContext@5a94fd0c>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@49f04cd5>}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------520961686475539489965112", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------520961686475539489965112", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7e1fce00>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------520961686475539489965112", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------520961686475539489965112", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7e1fce00>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------520961686475539489965112", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------520961686475539489965112", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7e1fce00>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6701183452363831470.tmp
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6701183452363831470.tmp", context #<AccessControlContext java.security.AccessControlContext@462a88d7>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@17865d0d>}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7550704686798044488.tmp")
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6701183452363831470.tmp")
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-05 08:47:37 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 08:48:40 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------563661640729003761840607", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------563661640729003761840607", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7aa17d46>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:48:40 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------563661640729003761840607", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------563661640729003761840607", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7aa17d46>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:48:40 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------563661640729003761840607", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------563661640729003761840607", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7aa17d46>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 08:48:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8506409775322125910.tmp
graftwerk.log:16-Dec-05 08:48:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8506409775322125910.tmp", context #<AccessControlContext java.security.AccessControlContext@24d4b0bd>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7100fa62>}
graftwerk.log:16-Dec-05 08:48:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8506409775322125910.tmp")
graftwerk.log:16-Dec-05 08:48:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 08:48:41 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 08:48:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 08:48:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 08:48:41 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 08:48:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:11:21 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5882", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------737591814056805002609732", "connection" "close"}, :server-port 8083, :content-length 5882, :content-type "multipart/form-data; boundary=--------------------------737591814056805002609732", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@336b131e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:11:21 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5882", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------737591814056805002609732", "connection" "close"}, :server-port 8083, :content-length 5882, :content-type "multipart/form-data; boundary=--------------------------737591814056805002609732", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@336b131e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:11:21 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5882", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------737591814056805002609732", "connection" "close"}, :server-port 8083, :content-length 5882, :content-type "multipart/form-data; boundary=--------------------------737591814056805002609732", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@336b131e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:11:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4200115951679827592.tmp
graftwerk.log:16-Dec-05 09:11:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4200115951679827592.tmp", context #<AccessControlContext java.security.AccessControlContext@5f4f31f4>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@3556fbcb>}
graftwerk.log:16-Dec-05 09:11:21 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------425030404701258995592943", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------425030404701258995592943", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7a725508>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:12:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------363844835985694370637622", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------363844835985694370637622", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5aae8b00>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:13:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------440747836002412821180546", "connection" "close", "accept" "application/octet-stream"}, :server-port 8083, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------440747836002412821180546", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@70f04bca>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------363844835985694370637622", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------363844835985694370637622", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5aae8b00>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------440747836002412821180546", "connection" "close", "accept" "application/octet-stream"}, :server-port 8083, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------440747836002412821180546", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@70f04bca>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------363844835985694370637622", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------363844835985694370637622", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5aae8b00>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------440747836002412821180546", "connection" "close", "accept" "application/octet-stream"}, :server-port 8083, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------440747836002412821180546", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@70f04bca>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------425030404701258995592943", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------425030404701258995592943", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7a725508>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------425030404701258995592943", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------425030404701258995592943", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7a725508>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7550468868973801876.tmp
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4269785936696351360.tmp
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-687608084542734166.tmp
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4269785936696351360.tmp", context #<AccessControlContext java.security.AccessControlContext@5f72a4>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@40f74ae>}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7550468868973801876.tmp", context #<AccessControlContext java.security.AccessControlContext@4ee3b4ad>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4886846f>}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-687608084542734166.tmp", context #<AccessControlContext java.security.AccessControlContext@dd9ae0>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5f1916c2>}
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4200115951679827592.tmp")
graftwerk.log:16-Dec-05 09:13:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7550468868973801876.tmp")
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4269785936696351360.tmp")
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-687608084542734166.tmp")
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-05 09:13:49 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/graft   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:15:54 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-05 09:15:54 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-05 09:31:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------087622622826414433418756", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------087622622826414433418756", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@163fbcb6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:31:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------087622622826414433418756", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------087622622826414433418756", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@163fbcb6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:31:47 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------087622622826414433418756", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------087622622826414433418756", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@163fbcb6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:31:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3596682155311955706.tmp
graftwerk.log:16-Dec-05 09:31:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3596682155311955706.tmp", context #<AccessControlContext java.security.AccessControlContext@3cc7ccbf>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@49d55a78>}
graftwerk.log:16-Dec-05 09:31:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3596682155311955706.tmp")
graftwerk.log:16-Dec-05 09:31:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:31:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:31:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:31:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:31:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:31:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:33:19 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------445184651913289199358216", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------445184651913289199358216", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@567e30f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:33:19 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------445184651913289199358216", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------445184651913289199358216", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@567e30f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:33:19 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------445184651913289199358216", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------445184651913289199358216", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@567e30f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:33:19 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5257935767292870092.tmp
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5257935767292870092.tmp", context #<AccessControlContext java.security.AccessControlContext@a3d75ba>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6fd0244f>}
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------071844049511130938753849", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------071844049511130938753849", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@24aa3b93>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------071844049511130938753849", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------071844049511130938753849", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@24aa3b93>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------071844049511130938753849", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------071844049511130938753849", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@24aa3b93>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3178217108208416202.tmp
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3178217108208416202.tmp", context #<AccessControlContext java.security.AccessControlContext@414c8cf9>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@426dd48a>}
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3178217108208416202.tmp")
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:33:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:33:59 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "14735", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------747011827889717723695234", "connection" "close"}, :server-port 8083, :content-length 14735, :content-type "multipart/form-data; boundary=--------------------------747011827889717723695234", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@53f2ab00>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:33:59 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "14735", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------747011827889717723695234", "connection" "close"}, :server-port 8083, :content-length 14735, :content-type "multipart/form-data; boundary=--------------------------747011827889717723695234", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@53f2ab00>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:33:59 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "14735", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------747011827889717723695234", "connection" "close"}, :server-port 8083, :content-length 14735, :content-type "multipart/form-data; boundary=--------------------------747011827889717723695234", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@53f2ab00>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:33:59 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-05 09:33:59 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:35:45 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11614", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------544841511371864766126828", "connection" "close"}, :server-port 8083, :content-length 11614, :content-type "multipart/form-data; boundary=--------------------------544841511371864766126828", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7c2eab4c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:35:45 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11614", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------544841511371864766126828", "connection" "close"}, :server-port 8083, :content-length 11614, :content-type "multipart/form-data; boundary=--------------------------544841511371864766126828", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7c2eab4c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:35:45 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11614", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------544841511371864766126828", "connection" "close"}, :server-port 8083, :content-length 11614, :content-type "multipart/form-data; boundary=--------------------------544841511371864766126828", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7c2eab4c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:35:45 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-05 09:35:46 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:37:12 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38998", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------881376675614653749739665", "connection" "close"}, :server-port 8083, :content-length 38998, :content-type "multipart/form-data; boundary=--------------------------881376675614653749739665", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@43d8e51b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38998", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------881376675614653749739665", "connection" "close"}, :server-port 8083, :content-length 38998, :content-type "multipart/form-data; boundary=--------------------------881376675614653749739665", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@43d8e51b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:12 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "38998", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------881376675614653749739665", "connection" "close"}, :server-port 8083, :content-length 38998, :content-type "multipart/form-data; boundary=--------------------------881376675614653749739665", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@43d8e51b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:15 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Dec-05 09:37:15 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@6c4b8d5c>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4350ddd8>}
graftwerk.log:16-Dec-05 09:37:15 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Dec-05 09:37:15 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:37:15 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:37:15 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:37:15 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:37:15 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:37:15 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:37:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "39002", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------185470830827126550004253", "connection" "close"}, :server-port 8083, :content-length 39002, :content-type "multipart/form-data; boundary=--------------------------185470830827126550004253", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1dc0ca66>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "39002", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------185470830827126550004253", "connection" "close"}, :server-port 8083, :content-length 39002, :content-type "multipart/form-data; boundary=--------------------------185470830827126550004253", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1dc0ca66>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "39002", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------185470830827126550004253", "connection" "close"}, :server-port 8083, :content-length 39002, :content-type "multipart/form-data; boundary=--------------------------185470830827126550004253", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1dc0ca66>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Dec-05 09:37:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [SITE_CODE FNR]}] (graph "http://www.example.no/#/" [(graph0 SITE_CODE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@376bbe02>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4e5a366a>}
graftwerk.log:16-Dec-05 09:37:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Dec-05 09:37:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:37:40 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:37:40 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:37:40 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:37:40 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:37:40 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "39014", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------083292577286908154346656", "connection" "close"}, :server-port 8083, :content-length 39014, :content-type "multipart/form-data; boundary=--------------------------083292577286908154346656", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@55cd64c0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "39014", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------083292577286908154346656", "connection" "close"}, :server-port 8083, :content-length 39014, :content-type "multipart/form-data; boundary=--------------------------083292577286908154346656", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@55cd64c0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "39014", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------083292577286908154346656", "connection" "close"}, :server-port 8083, :content-length 39014, :content-type "multipart/form-data; boundary=--------------------------083292577286908154346656", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@55cd64c0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [SITE_CODE SITE_NAME]}] (graph "http://www.example.no/#/" [(graph0 SITE_CODE) [graph0:prop (datatypes/convert-literal SITE_NAME "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@2f93168b>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4ee4d01c>}
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:37:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "39014", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------841332741434567133403661", "connection" "close"}, :server-port 8083, :content-length 39014, :content-type "multipart/form-data; boundary=--------------------------841332741434567133403661", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2a430cbc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "39014", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------841332741434567133403661", "connection" "close"}, :server-port 8083, :content-length 39014, :content-type "multipart/form-data; boundary=--------------------------841332741434567133403661", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2a430cbc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "39014", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------841332741434567133403661", "connection" "close"}, :server-port 8083, :content-length 39014, :content-type "multipart/form-data; boundary=--------------------------841332741434567133403661", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2a430cbc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [SITE_CODE SITE_NAME]}] (graph "http://www.example.no/#/" [(graph0 SITE_CODE) [graph0:prop (datatypes/convert-literal SITE_NAME "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@198e9d10>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@3ec1b9fb>}
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "39015", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------669188757606912922329439", "connection" "close", "accept" "application/octet-stream"}, :server-port 3000, :content-length 39015, :content-type "multipart/form-data; boundary=--------------------------669188757606912922329439", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2e9c92b6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "39015", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------669188757606912922329439", "connection" "close", "accept" "application/octet-stream"}, :server-port 3000, :content-length 39015, :content-type "multipart/form-data; boundary=--------------------------669188757606912922329439", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2e9c92b6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "39015", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------669188757606912922329439", "connection" "close", "accept" "application/octet-stream"}, :server-port 3000, :content-length 39015, :content-type "multipart/form-data; boundary=--------------------------669188757606912922329439", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2e9c92b6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Dec-05 09:37:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [SITE_CODE SITE_NAME]}] (graph "http://www.example.no/#/" [(graph0 SITE_CODE) [graph0:prop (datatypes/convert-literal SITE_NAME "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@7c7814d8>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7ffb219f>}
graftwerk.log:16-Dec-05 09:37:52 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Dec-05 09:37:52 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:37:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/octet-stream
graftwerk.log:16-Dec-05 09:37:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/octet-stream selected  application/octet-stream
graftwerk.log:16-Dec-05 09:37:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-05 09:37:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-05 09:37:52 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:37:52 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unexpected exception whilst streaming RDF
graftwerk.log:                                        [33mclojure.core/binding-conveyor-fn/[1;33mfn[m  [32m   core.clj: 1910[m
graftwerk.log:                                         [33mring.util.io/piped-input-stream/[1;33mfn[m  [32m     io.clj:   28[m
graftwerk.log:[33mgraftwerk.middleware.dataset/wrap-write-dataset/write-dataset-middleware/[1;33mfn[m  [32mdataset.clj:  149[m
graftwerk.log:                                              [33mgrafter.rdf.io/[1;33mrdf-serializer[m  [32m     io.clj:  382[m
graftwerk.log:16-Dec-05 09:38:01 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "39015", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------141740877116366045963795", "connection" "close", "accept" "application/octet-stream"}, :server-port 3000, :content-length 39015, :content-type "multipart/form-data; boundary=--------------------------141740877116366045963795", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1b1ab77>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:38:01 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "39015", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------141740877116366045963795", "connection" "close", "accept" "application/octet-stream"}, :server-port 3000, :content-length 39015, :content-type "multipart/form-data; boundary=--------------------------141740877116366045963795", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1b1ab77>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:38:01 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "39015", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------141740877116366045963795", "connection" "close", "accept" "application/octet-stream"}, :server-port 3000, :content-length 39015, :content-type "multipart/form-data; boundary=--------------------------141740877116366045963795", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1b1ab77>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:38:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Dec-05 09:38:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [SITE_CODE SITE_NAME]}] (graph "http://www.example.no/#/" [(graph0 SITE_CODE) [graph0:prop (datatypes/convert-literal SITE_NAME "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@f60126>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@63323437>}
graftwerk.log:16-Dec-05 09:38:02 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Dec-05 09:38:02 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:38:02 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/octet-stream
graftwerk.log:16-Dec-05 09:38:02 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/octet-stream selected  application/octet-stream
graftwerk.log:16-Dec-05 09:38:02 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-05 09:38:02 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:38:02 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-05 09:38:02 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unexpected exception whilst streaming RDF
graftwerk.log:                                        [33mclojure.core/binding-conveyor-fn/[1;33mfn[m  [32m   core.clj: 1910[m
graftwerk.log:                                         [33mring.util.io/piped-input-stream/[1;33mfn[m  [32m     io.clj:   28[m
graftwerk.log:[33mgraftwerk.middleware.dataset/wrap-write-dataset/write-dataset-middleware/[1;33mfn[m  [32mdataset.clj:  149[m
graftwerk.log:                                              [33mgrafter.rdf.io/[1;33mrdf-serializer[m  [32m     io.clj:  382[m
graftwerk.log:16-Dec-05 09:39:01 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "39015", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------254348413687649440071874", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 39015, :content-type "multipart/form-data; boundary=--------------------------254348413687649440071874", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@59907a3e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:39:01 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "39015", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------254348413687649440071874", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 39015, :content-type "multipart/form-data; boundary=--------------------------254348413687649440071874", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@59907a3e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:39:01 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "39015", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------254348413687649440071874", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 39015, :content-type "multipart/form-data; boundary=--------------------------254348413687649440071874", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@59907a3e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:39:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\view_1_07_taej_protectedsites_SPAs.csv
graftwerk.log:16-Dec-05 09:39:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [SITE_CODE SITE_NAME]}] (graph "http://www.example.no/#/" [(graph0 SITE_CODE) [graph0:prop (datatypes/convert-literal SITE_NAME "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-shape-csv data-file) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv", context #<AccessControlContext java.security.AccessControlContext@fb666b8>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7fefa4ef>}
graftwerk.log:16-Dec-05 09:39:02 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\view_1_07_taej_protectedsites_SPAs.csv")
graftwerk.log:16-Dec-05 09:39:02 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:39:02 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-05 09:39:02 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-05 09:39:02 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-05 09:39:02 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-05 09:39:02 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5918", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------066455530311839207402457", "connection" "close"}, :server-port 8083, :content-length 5918, :content-type "multipart/form-data; boundary=--------------------------066455530311839207402457", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@46902535>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5918", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------066455530311839207402457", "connection" "close"}, :server-port 8083, :content-length 5918, :content-type "multipart/form-data; boundary=--------------------------066455530311839207402457", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@46902535>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5918", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------066455530311839207402457", "connection" "close"}, :server-port 8083, :content-length 5918, :content-type "multipart/form-data; boundary=--------------------------066455530311839207402457", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@46902535>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8844727141158277247.tmp
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [SITE_CODE SITE_NAME]}] (graph "http://www.example.no/#/" [(graph0 SITE_CODE) [graph0:prop (datatypes/convert-literal SITE_NAME "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8844727141158277247.tmp", context #<AccessControlContext java.security.AccessControlContext@7eef40f8>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@34154108>}
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8844727141158277247.tmp")
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:39:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:40:03 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5914", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------682358890326951224208109", "connection" "close"}, :server-port 8083, :content-length 5914, :content-type "multipart/form-data; boundary=--------------------------682358890326951224208109", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@8b39b80>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:03 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5914", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------682358890326951224208109", "connection" "close"}, :server-port 8083, :content-length 5914, :content-type "multipart/form-data; boundary=--------------------------682358890326951224208109", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@8b39b80>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:03 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5914", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------682358890326951224208109", "connection" "close"}, :server-port 8083, :content-length 5914, :content-type "multipart/form-data; boundary=--------------------------682358890326951224208109", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@8b39b80>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5350251726372807541.tmp
graftwerk.log:16-Dec-05 09:40:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE SITE_NAME]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal SITE_NAME "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5350251726372807541.tmp", context #<AccessControlContext java.security.AccessControlContext@3e57d368>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4dc3a4d9>}
graftwerk.log:16-Dec-05 09:40:04 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5350251726372807541.tmp")
graftwerk.log:16-Dec-05 09:40:04 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:40:04 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:40:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:40:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:40:04 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:40:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------265817153983152801379124", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------265817153983152801379124", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2fadb275>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------265817153983152801379124", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------265817153983152801379124", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2fadb275>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------265817153983152801379124", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------265817153983152801379124", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2fadb275>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5349540873244309561.tmp
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5349540873244309561.tmp", context #<AccessControlContext java.security.AccessControlContext@24cdd2de>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7a548a69>}
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5349540873244309561.tmp")
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:40:09 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:40:11 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------332976064484361420021767", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------332976064484361420021767", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@50d5eaa>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:11 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------332976064484361420021767", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------332976064484361420021767", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@50d5eaa>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:11 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------332976064484361420021767", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------332976064484361420021767", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@50d5eaa>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:11 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1460371802817839457.tmp
graftwerk.log:16-Dec-05 09:40:11 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1460371802817839457.tmp", context #<AccessControlContext java.security.AccessControlContext@1f0b9bf8>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@69827080>}
graftwerk.log:16-Dec-05 09:40:12 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1460371802817839457.tmp")
graftwerk.log:16-Dec-05 09:40:12 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:40:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-05 09:40:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-05 09:40:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-05 09:40:12 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-05 09:40:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------311597139242167647937186", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------311597139242167647937186", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2d6c91fe>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------311597139242167647937186", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------311597139242167647937186", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2d6c91fe>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------311597139242167647937186", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------311597139242167647937186", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2d6c91fe>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8046895852400744928.tmp
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8046895852400744928.tmp", context #<AccessControlContext java.security.AccessControlContext@1dc1a126>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@272b8be7>}
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8046895852400744928.tmp")
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:40:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:40:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------152115748454842522193143", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------152115748454842522193143", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2127c531>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------152115748454842522193143", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------152115748454842522193143", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2127c531>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "47053", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------152115748454842522193143", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 47053, :content-type "multipart/form-data; boundary=--------------------------152115748454842522193143", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2127c531>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:40:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7859934104969992106.tmp
graftwerk.log:16-Dec-05 09:40:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7859934104969992106.tmp", context #<AccessControlContext java.security.AccessControlContext@53f7a385>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4d6dcefa>}
graftwerk.log:16-Dec-05 09:40:59 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7859934104969992106.tmp")
graftwerk.log:16-Dec-05 09:40:59 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:  18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj: 121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:  25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj: 113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:  19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:  94[m
graftwerk.log:                                                    [33mprone.middleware/[1;33mget-application-name[m  [32m             middleware.clj:  25[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  45[m
graftwerk.log:                                                                  [33mclojure.edn/[1;33mread-string[m  [32m                    edn.clj:  46[m
graftwerk.log:16-Dec-05 09:40:59 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/graft   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------213225090256153765016109", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------213225090256153765016109", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6af5de1a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------213225090256153765016109", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------213225090256153765016109", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6af5de1a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "47052", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------213225090256153765016109", "connection" "close"}, :server-port 8083, :content-length 47052, :content-type "multipart/form-data; boundary=--------------------------213225090256153765016109", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6af5de1a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2933854911893845087.tmp
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2933854911893845087.tmp", context #<AccessControlContext java.security.AccessControlContext@4d9d02b6>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@485037eb>}
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2933854911893845087.tmp")
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:42:10 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------404375601203788381926062", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------404375601203788381926062", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@13b7fcc4>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------404375601203788381926062", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------404375601203788381926062", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@13b7fcc4>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------404375601203788381926062", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------404375601203788381926062", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@13b7fcc4>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6385311069559273880.tmp
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6385311069559273880.tmp", context #<AccessControlContext java.security.AccessControlContext@a684f68>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2edfa574>}
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6385311069559273880.tmp")
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:42:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:44:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------011705986010174303730763", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------011705986010174303730763", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@668b67cb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:44:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------011705986010174303730763", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------011705986010174303730763", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@668b67cb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:44:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------011705986010174303730763", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------011705986010174303730763", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@668b67cb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:44:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5120109876839641553.tmp
graftwerk.log:16-Dec-05 09:44:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5120109876839641553.tmp", context #<AccessControlContext java.security.AccessControlContext@2bcc369f>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@40538fec>}
graftwerk.log:16-Dec-05 09:44:43 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5120109876839641553.tmp")
graftwerk.log:16-Dec-05 09:44:43 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:44:43 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:44:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:44:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:44:43 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:44:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------499269721095494091509043", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------499269721095494091509043", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@17e80b0a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------499269721095494091509043", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------499269721095494091509043", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@17e80b0a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------499269721095494091509043", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------499269721095494091509043", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@17e80b0a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1650878472111992388.tmp
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1650878472111992388.tmp", context #<AccessControlContext java.security.AccessControlContext@3de365db>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2c824e6>}
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1650878472111992388.tmp")
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:45:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46688", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------006900330935192866919011", "connection" "close"}, :server-port 8083, :content-length 46688, :content-type "multipart/form-data; boundary=--------------------------006900330935192866919011", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@61633b52>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46688", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------006900330935192866919011", "connection" "close"}, :server-port 8083, :content-length 46688, :content-type "multipart/form-data; boundary=--------------------------006900330935192866919011", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@61633b52>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46688", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------006900330935192866919011", "connection" "close"}, :server-port 8083, :content-length 46688, :content-type "multipart/form-data; boundary=--------------------------006900330935192866919011", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@61633b52>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2863807123063003595.tmp
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2863807123063003595.tmp", context #<AccessControlContext java.security.AccessControlContext@31f8b70>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@19cec9a0>}
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2863807123063003595.tmp")
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:51:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:51:31 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46795", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------898658501254286770090972", "connection" "close"}, :server-port 8083, :content-length 46795, :content-type "multipart/form-data; boundary=--------------------------898658501254286770090972", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3e071ff9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:51:31 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46795", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------898658501254286770090972", "connection" "close"}, :server-port 8083, :content-length 46795, :content-type "multipart/form-data; boundary=--------------------------898658501254286770090972", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3e071ff9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:51:31 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46795", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------898658501254286770090972", "connection" "close"}, :server-port 8083, :content-length 46795, :content-type "multipart/form-data; boundary=--------------------------898658501254286770090972", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3e071ff9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:51:31 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5120942246487395416.tmp
graftwerk.log:16-Dec-05 09:51:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5120942246487395416.tmp", context #<AccessControlContext java.security.AccessControlContext@1ad7f834>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@9ceb589>}
graftwerk.log:16-Dec-05 09:51:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5120942246487395416.tmp")
graftwerk.log:16-Dec-05 09:51:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:51:32 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:51:32 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:51:32 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:51:32 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:51:32 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46795", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------751328910112766450647082", "connection" "close"}, :server-port 8083, :content-length 46795, :content-type "multipart/form-data; boundary=--------------------------751328910112766450647082", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@489f3f5b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46795", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------751328910112766450647082", "connection" "close"}, :server-port 8083, :content-length 46795, :content-type "multipart/form-data; boundary=--------------------------751328910112766450647082", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@489f3f5b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46795", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------751328910112766450647082", "connection" "close"}, :server-port 8083, :content-length 46795, :content-type "multipart/form-data; boundary=--------------------------751328910112766450647082", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@489f3f5b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5155912467615822688.tmp
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5155912467615822688.tmp", context #<AccessControlContext java.security.AccessControlContext@526adc90>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2aba1dda>}
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5155912467615822688.tmp")
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:52:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46795", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------293180453042792777773072", "connection" "close"}, :server-port 8083, :content-length 46795, :content-type "multipart/form-data; boundary=--------------------------293180453042792777773072", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@51a619fc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46795", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------293180453042792777773072", "connection" "close"}, :server-port 8083, :content-length 46795, :content-type "multipart/form-data; boundary=--------------------------293180453042792777773072", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@51a619fc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46795", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------293180453042792777773072", "connection" "close"}, :server-port 8083, :content-length 46795, :content-type "multipart/form-data; boundary=--------------------------293180453042792777773072", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@51a619fc>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8267388058639070739.tmp
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9]{1,13}.[0-9]+") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (defn fill-when [col] (grafter.sequences/fill-when col)) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8267388058639070739.tmp", context #<AccessControlContext java.security.AccessControlContext@4bd81af0>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@310511e4>}
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8267388058639070739.tmp")
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 09:58:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 10:30:48 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------198635818590653659289991", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------198635818590653659289991", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2fa8f142>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 10:30:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------198635818590653659289991", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------198635818590653659289991", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2fa8f142>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 10:30:48 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------198635818590653659289991", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------198635818590653659289991", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2fa8f142>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 10:30:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3286626596894601215.tmp
graftwerk.log:16-Dec-05 10:30:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3286626596894601215.tmp", context #<AccessControlContext java.security.AccessControlContext@f45de21>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@532b4e05>}
graftwerk.log:16-Dec-05 10:30:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3286626596894601215.tmp")
graftwerk.log:16-Dec-05 10:30:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 10:30:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 10:30:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 10:30:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 10:30:49 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 10:30:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 10:33:27 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------244117712654757747547179", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------244117712654757747547179", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6a6c58da>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 10:33:27 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------244117712654757747547179", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------244117712654757747547179", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6a6c58da>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 10:33:27 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------244117712654757747547179", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------244117712654757747547179", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6a6c58da>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 10:33:27 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8431532445819045866.tmp
graftwerk.log:16-Dec-05 10:33:27 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8431532445819045866.tmp", context #<AccessControlContext java.security.AccessControlContext@6a5da05f>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@61b20242>}
graftwerk.log:16-Dec-05 10:33:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8431532445819045866.tmp")
graftwerk.log:16-Dec-05 10:33:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 10:33:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 10:33:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 10:33:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 10:33:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 10:33:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------539558234506639503663012", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------539558234506639503663012", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@44ae4f9b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------539558234506639503663012", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------539558234506639503663012", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@44ae4f9b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------539558234506639503663012", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------539558234506639503663012", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@44ae4f9b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-427809352791796875.tmp
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-427809352791796875.tmp", context #<AccessControlContext java.security.AccessControlContext@7ab7b84d>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5e073c9>}
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-427809352791796875.tmp")
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 11:07:58 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------225388418935598168488233", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------225388418935598168488233", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3f3d532f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------225388418935598168488233", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------225388418935598168488233", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3f3d532f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------225388418935598168488233", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------225388418935598168488233", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3f3d532f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6154857457331379795.tmp
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6154857457331379795.tmp", context #<AccessControlContext java.security.AccessControlContext@57a88f61>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@3fbd39b8>}
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------679000654506675964545214", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------679000654506675964545214", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4e0c1a1f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------679000654506675964545214", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------679000654506675964545214", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4e0c1a1f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------679000654506675964545214", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------679000654506675964545214", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4e0c1a1f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1117609961487376026.tmp
graftwerk.log:16-Dec-05 11:08:16 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1117609961487376026.tmp", context #<AccessControlContext java.security.AccessControlContext@64b78342>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@691ae0ec>}
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6154857457331379795.tmp")
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1117609961487376026.tmp")
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 11:08:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------347651035151611713595282", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------347651035151611713595282", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@585c6c3f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------347651035151611713595282", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------347651035151611713595282", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@585c6c3f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------347651035151611713595282", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------347651035151611713595282", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@585c6c3f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1660499178862821607.tmp
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1660499178862821607.tmp", context #<AccessControlContext java.security.AccessControlContext@58cc1493>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6abdba1e>}
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------684668628039114107854307", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------684668628039114107854307", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7dc63c70>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------684668628039114107854307", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------684668628039114107854307", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7dc63c70>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------684668628039114107854307", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------684668628039114107854307", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7dc63c70>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4701656328211281225.tmp
graftwerk.log:16-Dec-05 11:09:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4701656328211281225.tmp", context #<AccessControlContext java.security.AccessControlContext@7ad02edd>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7f8282fe>}
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1660499178862821607.tmp")
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4701656328211281225.tmp")
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 11:09:23 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 11:15:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------267299600026504380992705", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------267299600026504380992705", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3452a0eb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:15:49 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------267299600026504380992705", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------267299600026504380992705", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3452a0eb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:15:49 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------267299600026504380992705", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------267299600026504380992705", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3452a0eb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:15:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1524521445958278021.tmp
graftwerk.log:16-Dec-05 11:15:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1524521445958278021.tmp", context #<AccessControlContext java.security.AccessControlContext@283b0ef0>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1440c960>}
graftwerk.log:16-Dec-05 11:15:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1524521445958278021.tmp")
graftwerk.log:16-Dec-05 11:15:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 11:15:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 11:15:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 11:15:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 11:15:50 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 11:15:50 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 11:16:00 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------961978414455141708044293", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------961978414455141708044293", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@749498a2>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:16:00 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------961978414455141708044293", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------961978414455141708044293", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@749498a2>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:16:00 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------961978414455141708044293", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------961978414455141708044293", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@749498a2>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:16:00 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2041581973454663309.tmp
graftwerk.log:16-Dec-05 11:16:00 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2041581973454663309.tmp", context #<AccessControlContext java.security.AccessControlContext@4c83f140>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@3fe87b8c>}
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------833980930668316840183668", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------833980930668316840183668", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7d9a6e2c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------833980930668316840183668", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------833980930668316840183668", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7d9a6e2c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------833980930668316840183668", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------833980930668316840183668", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7d9a6e2c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4937537001661130260.tmp
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ";"))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4937537001661130260.tmp", context #<AccessControlContext java.security.AccessControlContext@4d7fcb8e>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@5fce2756>}
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2041581973454663309.tmp")
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4937537001661130260.tmp")
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 11:16:01 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 11:17:14 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------378483260035836595006787", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------378483260035836595006787", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5989f91c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------378483260035836595006787", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------378483260035836595006787", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5989f91c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:14 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------378483260035836595006787", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------378483260035836595006787", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5989f91c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-138754933211320095.tmp
graftwerk.log:16-Dec-05 11:17:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-138754933211320095.tmp", context #<AccessControlContext java.security.AccessControlContext@20098d25>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@46849a>}
graftwerk.log:16-Dec-05 11:17:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-138754933211320095.tmp")
graftwerk.log:16-Dec-05 11:17:15 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 11:17:15 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 11:17:15 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 11:17:15 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 11:17:15 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 11:17:15 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 11:17:19 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------278191207933608100769134", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------278191207933608100769134", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@577a611e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:19 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------278191207933608100769134", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------278191207933608100769134", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@577a611e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:19 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------278191207933608100769134", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------278191207933608100769134", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@577a611e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:19 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8570442529149769484.tmp
graftwerk.log:16-Dec-05 11:17:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8570442529149769484.tmp", context #<AccessControlContext java.security.AccessControlContext@3943a34c>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@14066cae>}
graftwerk.log:16-Dec-05 11:17:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8570442529149769484.tmp")
graftwerk.log:16-Dec-05 11:17:20 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 11:17:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-05 11:17:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-05 11:17:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-05 11:17:20 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-05 11:17:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-05 11:17:32 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------463802041733834353095306", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------463802041733834353095306", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@42a9066>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:32 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------463802041733834353095306", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------463802041733834353095306", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@42a9066>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:32 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------463802041733834353095306", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------463802041733834353095306", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@42a9066>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-76251539814884619.tmp
graftwerk.log:16-Dec-05 11:17:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-76251539814884619.tmp", context #<AccessControlContext java.security.AccessControlContext@3ea2522>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@57f15b67>}
graftwerk.log:16-Dec-05 11:17:33 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-76251539814884619.tmp")
graftwerk.log:16-Dec-05 11:17:33 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 11:17:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-05 11:17:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-05 11:17:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-05 11:17:33 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-05 11:17:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------754529233745457494726587", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------754529233745457494726587", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@598d3ee9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------754529233745457494726587", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------754529233745457494726587", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@598d3ee9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------754529233745457494726587", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------754529233745457494726587", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@598d3ee9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6569935354943371980.tmp
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6569935354943371980.tmp", context #<AccessControlContext java.security.AccessControlContext@1dcdf3a>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7e85dd55>}
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6569935354943371980.tmp")
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-05 11:17:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-05 13:08:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------101094889308869336117700", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------101094889308869336117700", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4c6e7292>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 13:08:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------101094889308869336117700", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------101094889308869336117700", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4c6e7292>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 13:08:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------101094889308869336117700", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------101094889308869336117700", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4c6e7292>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 13:08:27 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-9119659990001536023.tmp
graftwerk.log:16-Dec-05 13:08:27 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-9119659990001536023.tmp", context #<AccessControlContext java.security.AccessControlContext@516053a8>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@731b427b>}
graftwerk.log:16-Dec-05 13:08:27 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-9119659990001536023.tmp")
graftwerk.log:16-Dec-05 13:08:27 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 13:08:27 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 13:08:27 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 13:08:27 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 13:08:27 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 13:08:27 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 15:31:17 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "146624", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------503284508411432547502481", "connection" "close"}, :server-port 8083, :content-length 146624, :content-type "multipart/form-data; boundary=--------------------------503284508411432547502481", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@58fb3884>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:31:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "146624", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------503284508411432547502481", "connection" "close"}, :server-port 8083, :content-length 146624, :content-type "multipart/form-data; boundary=--------------------------503284508411432547502481", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@58fb3884>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:31:17 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "146624", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------503284508411432547502481", "connection" "close"}, :server-port 8083, :content-length 146624, :content-type "multipart/form-data; boundary=--------------------------503284508411432547502481", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@58fb3884>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:31:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5575838337433212786.tmp
graftwerk.log:16-Dec-05 15:31:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5575838337433212786.tmp", context #<AccessControlContext java.security.AccessControlContext@3115dd64>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4f4f148e>}
graftwerk.log:16-Dec-05 15:31:18 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5575838337433212786.tmp")
graftwerk.log:16-Dec-05 15:31:18 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 15:31:18 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 15:31:18 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 15:31:18 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 15:31:18 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 15:31:18 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 15:31:25 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "146731", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------419138409514056504775557", "connection" "close"}, :server-port 8083, :content-length 146731, :content-type "multipart/form-data; boundary=--------------------------419138409514056504775557", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@50241944>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:31:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "146731", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------419138409514056504775557", "connection" "close"}, :server-port 8083, :content-length 146731, :content-type "multipart/form-data; boundary=--------------------------419138409514056504775557", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@50241944>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:31:25 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "146731", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------419138409514056504775557", "connection" "close"}, :server-port 8083, :content-length 146731, :content-type "multipart/form-data; boundary=--------------------------419138409514056504775557", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@50241944>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:31:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6567197386495002738.tmp
graftwerk.log:16-Dec-05 15:31:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6567197386495002738.tmp", context #<AccessControlContext java.security.AccessControlContext@6e52dd08>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@185c9f79>}
graftwerk.log:16-Dec-05 15:31:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6567197386495002738.tmp")
graftwerk.log:16-Dec-05 15:31:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 15:31:26 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 15:31:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 15:31:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 15:31:26 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 15:31:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 15:32:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "146731", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------472868782164102544666175", "connection" "close"}, :server-port 8083, :content-length 146731, :content-type "multipart/form-data; boundary=--------------------------472868782164102544666175", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@437b0ea6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:32:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "146731", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------472868782164102544666175", "connection" "close"}, :server-port 8083, :content-length 146731, :content-type "multipart/form-data; boundary=--------------------------472868782164102544666175", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@437b0ea6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:32:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "146731", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------472868782164102544666175", "connection" "close"}, :server-port 8083, :content-length 146731, :content-type "multipart/form-data; boundary=--------------------------472868782164102544666175", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@437b0ea6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:32:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2903271801598981698.tmp
graftwerk.log:16-Dec-05 15:32:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2903271801598981698.tmp", context #<AccessControlContext java.security.AccessControlContext@381d99fb>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@60e926e7>}
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "146972", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------496912645844005311877131", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 146972, :content-type "multipart/form-data; boundary=--------------------------496912645844005311877131", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6fef9a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "146972", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------496912645844005311877131", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 146972, :content-type "multipart/form-data; boundary=--------------------------496912645844005311877131", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6fef9a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "146972", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------496912645844005311877131", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 146972, :content-type "multipart/form-data; boundary=--------------------------496912645844005311877131", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6fef9a12>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2652170786164274099.tmp
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def dul (prefixer "http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#")) (def dul:defines (dul "defines")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [rr building]}] (graph "http://www.example.no/#/" [rr [dul:defines building]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2652170786164274099.tmp", context #<AccessControlContext java.security.AccessControlContext@2f425cf8>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@19e567b3>}
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2903271801598981698.tmp")
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2652170786164274099.tmp")
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-05 15:32:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-06 10:40:54 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-06 10:40:54 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-06 10:44:09 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-06 10:44:09 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-06 11:26:54 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-06 11:26:54 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-06 11:30:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "100670", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------162449284961762036155649", "connection" "close"}, :server-port 8083, :content-length 100670, :content-type "multipart/form-data; boundary=--------------------------162449284961762036155649", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5ad319a5>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 11:30:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "100670", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------162449284961762036155649", "connection" "close"}, :server-port 8083, :content-length 100670, :content-type "multipart/form-data; boundary=--------------------------162449284961762036155649", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5ad319a5>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 11:30:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "100670", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------162449284961762036155649", "connection" "close"}, :server-port 8083, :content-length 100670, :content-type "multipart/form-data; boundary=--------------------------162449284961762036155649", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5ad319a5>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 11:30:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4202512223614893070.tmp
graftwerk.log:16-Dec-06 11:30:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def dul (prefixer "http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#")) (def dul:defines (dul "defines")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [rr building]}] (graph "http://www.example.no/#/" [rr [dul:defines building]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4202512223614893070.tmp", context #<AccessControlContext java.security.AccessControlContext@478af129>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6d55cd0>}
graftwerk.log:16-Dec-06 11:30:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4202512223614893070.tmp")
graftwerk.log:16-Dec-06 11:30:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 11:30:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 11:30:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 11:30:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 11:30:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 11:30:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 11:30:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "100671", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------050600436650495979386552", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 100671, :content-type "multipart/form-data; boundary=--------------------------050600436650495979386552", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7319fcb0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 11:30:35 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "100671", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------050600436650495979386552", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 100671, :content-type "multipart/form-data; boundary=--------------------------050600436650495979386552", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7319fcb0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 11:30:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "100671", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------050600436650495979386552", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 100671, :content-type "multipart/form-data; boundary=--------------------------050600436650495979386552", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7319fcb0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 11:30:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1536007519200363642.tmp
graftwerk.log:16-Dec-06 11:30:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def dul (prefixer "http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#")) (def dul:defines (dul "defines")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [rr building]}] (graph "http://www.example.no/#/" [rr [dul:defines building]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1536007519200363642.tmp", context #<AccessControlContext java.security.AccessControlContext@e45a6ab>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1a3acc37>}
graftwerk.log:16-Dec-06 11:30:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1536007519200363642.tmp")
graftwerk.log:16-Dec-06 11:30:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 11:30:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-06 11:30:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-06 11:30:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-06 11:30:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-06 11:30:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------843855176679442905528198", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------843855176679442905528198", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1e7c5f2c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------843855176679442905528198", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------843855176679442905528198", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1e7c5f2c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------843855176679442905528198", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------843855176679442905528198", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1e7c5f2c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1880035284992462340.tmp
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1880035284992462340.tmp", context #<AccessControlContext java.security.AccessControlContext@499f86be>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1082625f>}
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1880035284992462340.tmp")
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 11:55:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 12:19:51 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------967201621020959272937710", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------967201621020959272937710", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@490230bb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 12:19:51 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------967201621020959272937710", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------967201621020959272937710", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@490230bb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 12:19:51 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------967201621020959272937710", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------967201621020959272937710", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@490230bb>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 12:19:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1839146964420724918.tmp
graftwerk.log:16-Dec-06 12:19:51 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1839146964420724918.tmp", context #<AccessControlContext java.security.AccessControlContext@4d2ffb0f>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4f80d9bc>}
graftwerk.log:16-Dec-06 12:19:52 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1839146964420724918.tmp")
graftwerk.log:16-Dec-06 12:19:52 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 12:19:52 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 12:19:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 12:19:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 12:19:52 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 12:19:52 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------677019105983224108637394", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------677019105983224108637394", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5dab2144>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------677019105983224108637394", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------677019105983224108637394", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5dab2144>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5902", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------677019105983224108637394", "connection" "close"}, :server-port 8083, :content-length 5902, :content-type "multipart/form-data; boundary=--------------------------677019105983224108637394", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5dab2144>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1913504989124402366.tmp
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1913504989124402366.tmp", context #<AccessControlContext java.security.AccessControlContext@1e1535a>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6523b64d>}
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1913504989124402366.tmp")
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 13:16:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------312316482853613940792547", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------312316482853613940792547", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2c24a03e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------312316482853613940792547", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------312316482853613940792547", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2c24a03e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "127.0.0.1", :headers {"host" "localhost:3000", "content-length" "5903", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------312316482853613940792547", "connection" "close", "accept" "application/n-triples"}, :server-port 3000, :content-length 5903, :content-type "multipart/form-data; boundary=--------------------------312316482853613940792547", :character-encoding nil, :uri "/evaluate/graft", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2c24a03e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8685150313035995220.tmp
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [OBJTYPE FNR]}] (graph "http://www.example.no/#/" [(graph0 OBJTYPE) [graph0:prop (datatypes/convert-literal FNR "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8685150313035995220.tmp", context #<AccessControlContext java.security.AccessControlContext@30155819>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2ecf41e7>}
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-graft "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8685150313035995220.tmp")
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/n-triples
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/n-triples selected  application/n-triples
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - About to stream RDF
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/graft   {"Content-Type" "application/n-triples"}
graftwerk.log:16-Dec-06 15:05:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Serialising RDF
graftwerk.log:16-Dec-06 15:14:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------661277354417016720160323", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------661277354417016720160323", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@299b2c9e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:35 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------661277354417016720160323", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------661277354417016720160323", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@299b2c9e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:35 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5537", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------661277354417016720160323", "connection" "close"}, :server-port 8083, :content-length 5537, :content-type "multipart/form-data; boundary=--------------------------661277354417016720160323", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@299b2c9e>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4990121825426262448.tmp
graftwerk.log:16-Dec-06 15:14:35 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4990121825426262448.tmp", context #<AccessControlContext java.security.AccessControlContext@63198deb>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2b2a9d98>}
graftwerk.log:16-Dec-06 15:14:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4990121825426262448.tmp")
graftwerk.log:16-Dec-06 15:14:36 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 15:14:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:14:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 15:14:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 15:14:36 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 15:14:36 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 15:14:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5552", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------887257972576778245838307", "connection" "close"}, :server-port 8083, :content-length 5552, :content-type "multipart/form-data; boundary=--------------------------887257972576778245838307", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7b6fd1b3>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:42 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5552", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------887257972576778245838307", "connection" "close"}, :server-port 8083, :content-length 5552, :content-type "multipart/form-data; boundary=--------------------------887257972576778245838307", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7b6fd1b3>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:42 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5552", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------887257972576778245838307", "connection" "close"}, :server-port 8083, :content-length 5552, :content-type "multipart/form-data; boundary=--------------------------887257972576778245838307", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7b6fd1b3>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1877841364976332705.tmp
graftwerk.log:16-Dec-06 15:14:42 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (make-dataset))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1877841364976332705.tmp", context #<AccessControlContext java.security.AccessControlContext@6bcfee10>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@6b16748e>}
graftwerk.log:16-Dec-06 15:14:43 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1877841364976332705.tmp")
graftwerk.log:16-Dec-06 15:14:43 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 15:14:43 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:14:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 15:14:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 15:14:43 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 15:14:43 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 15:14:44 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5552", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------429549782932777062590384", "connection" "close"}, :server-port 8083, :content-length 5552, :content-type "multipart/form-data; boundary=--------------------------429549782932777062590384", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7cc350d4>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5552", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------429549782932777062590384", "connection" "close"}, :server-port 8083, :content-length 5552, :content-type "multipart/form-data; boundary=--------------------------429549782932777062590384", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7cc350d4>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:44 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5552", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------429549782932777062590384", "connection" "close"}, :server-port 8083, :content-length 5552, :content-type "multipart/form-data; boundary=--------------------------429549782932777062590384", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7cc350d4>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:44 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5561885935291709416.tmp
graftwerk.log:16-Dec-06 15:14:44 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (make-dataset))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5561885935291709416.tmp", context #<AccessControlContext java.security.AccessControlContext@3b70cc3a>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2374ed33>}
graftwerk.log:16-Dec-06 15:14:45 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5561885935291709416.tmp")
graftwerk.log:16-Dec-06 15:14:45 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 15:14:45 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:14:45 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 15:14:45 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 15:14:45 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 15:14:45 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 15:14:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------439911828471612855769672", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------439911828471612855769672", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d54b522>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:46 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------439911828471612855769672", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------439911828471612855769672", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d54b522>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:46 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------439911828471612855769672", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------439911828471612855769672", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d54b522>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:14:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7109005234123191118.tmp
graftwerk.log:16-Dec-06 15:14:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7109005234123191118.tmp", context #<AccessControlContext java.security.AccessControlContext@6d92a3d7>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@746c4371>}
graftwerk.log:16-Dec-06 15:14:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7109005234123191118.tmp")
graftwerk.log:16-Dec-06 15:14:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 15:14:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:14:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 15:14:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 15:14:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 15:14:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 15:18:27 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------085377329302046712621606", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------085377329302046712621606", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ac95f22>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:18:27 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------085377329302046712621606", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------085377329302046712621606", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ac95f22>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:18:27 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5644", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------085377329302046712621606", "connection" "close"}, :server-port 8083, :content-length 5644, :content-type "multipart/form-data; boundary=--------------------------085377329302046712621606", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ac95f22>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:18:27 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7658776528376701835.tmp
graftwerk.log:16-Dec-06 15:18:27 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7658776528376701835.tmp", context #<AccessControlContext java.security.AccessControlContext@283283ba>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1dc94777>}
graftwerk.log:16-Dec-06 15:18:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7658776528376701835.tmp")
graftwerk.log:16-Dec-06 15:18:28 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 15:18:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:18:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 15:18:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 15:18:28 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 15:18:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 15:18:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5732", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------687212593668183839430266", "connection" "close"}, :server-port 8083, :content-length 5732, :content-type "multipart/form-data; boundary=--------------------------687212593668183839430266", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7c09dbfe>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:18:29 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5732", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------687212593668183839430266", "connection" "close"}, :server-port 8083, :content-length 5732, :content-type "multipart/form-data; boundary=--------------------------687212593668183839430266", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7c09dbfe>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:18:29 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5732", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------687212593668183839430266", "connection" "close"}, :server-port 8083, :content-length 5732, :content-type "multipart/form-data; boundary=--------------------------687212593668183839430266", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7c09dbfe>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:18:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1095570535787435213.tmp
graftwerk.log:16-Dec-06 15:18:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}] (graph "http://www.example.no/#/"))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1095570535787435213.tmp", context #<AccessControlContext java.security.AccessControlContext@379e5ab8>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@65833b39>}
graftwerk.log:16-Dec-06 15:18:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1095570535787435213.tmp")
graftwerk.log:16-Dec-06 15:18:30 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 15:18:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:18:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 15:18:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 15:18:30 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 15:18:30 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5805", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------699418756076238886901069", "connection" "close"}, :server-port 8083, :content-length 5805, :content-type "multipart/form-data; boundary=--------------------------699418756076238886901069", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@e0dfe71>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5805", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------699418756076238886901069", "connection" "close"}, :server-port 8083, :content-length 5805, :content-type "multipart/form-data; boundary=--------------------------699418756076238886901069", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@e0dfe71>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5805", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------699418756076238886901069", "connection" "close"}, :server-port 8083, :content-length 5805, :content-type "multipart/form-data; boundary=--------------------------699418756076238886901069", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@e0dfe71>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4938648651342147911.tmp
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID]}] (graph "http://www.example.no/#/" (graph0 TEIGID)))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4938648651342147911.tmp", context #<AccessControlContext java.security.AccessControlContext@193667a4>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@457422b3>}
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4938648651342147911.tmp")
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 15:19:03 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 15:25:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5841", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------569481432175398958135809", "connection" "close"}, :server-port 8083, :content-length 5841, :content-type "multipart/form-data; boundary=--------------------------569481432175398958135809", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4836c78b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:25:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5841", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------569481432175398958135809", "connection" "close"}, :server-port 8083, :content-length 5841, :content-type "multipart/form-data; boundary=--------------------------569481432175398958135809", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4836c78b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:25:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5841", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------569481432175398958135809", "connection" "close"}, :server-port 8083, :content-length 5841, :content-type "multipart/form-data; boundary=--------------------------569481432175398958135809", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@4836c78b>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:25:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6926043222900841606.tmp
graftwerk.log:16-Dec-06 15:25:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID]}] (graph "http://www.example.no/#/" [(graph0 TEIGID)]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6926043222900841606.tmp", context #<AccessControlContext java.security.AccessControlContext@72085a03>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@3c9bc13e>}
graftwerk.log:16-Dec-06 15:25:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6926043222900841606.tmp")
graftwerk.log:16-Dec-06 15:25:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 15:25:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:25:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 15:25:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 15:25:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 15:25:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------849998012259013636317832", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------849998012259013636317832", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7161a745>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------849998012259013636317832", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------849998012259013636317832", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7161a745>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "5908", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------849998012259013636317832", "connection" "close"}, :server-port 8083, :content-length 5908, :content-type "multipart/form-data; boundary=--------------------------849998012259013636317832", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@7161a745>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5323500976684263148.tmp
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def graph0 (prefixer "http://www.example.no/#/")) (def graph0 (prefixer "http://www.example.no/#/")) (def graph0:prop (graph0 "prop")) (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys [TEIGID OBJTYPE]}] (graph "http://www.example.no/#/" [(graph0 TEIGID) [graph0:prop (datatypes/convert-literal OBJTYPE "string")]]))) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :csv :separator (first (char-array ","))) (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5323500976684263148.tmp", context #<AccessControlContext java.security.AccessControlContext@7caadfc5>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2cae3e52>}
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5323500976684263148.tmp")
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-06 15:25:55 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 08:42:41 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 08:42:41 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 08:45:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------264621943452780479252561", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------264621943452780479252561", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1aa7ea4a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:45:28 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------264621943452780479252561", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------264621943452780479252561", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1aa7ea4a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:45:28 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------264621943452780479252561", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------264621943452780479252561", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1aa7ea4a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:45:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5554231091263816823.tmp
graftwerk.log:16-Dec-07 08:45:29 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5554231091263816823.tmp", context #<AccessControlContext java.security.AccessControlContext@c67bf5b>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@664d281a>}
graftwerk.log:16-Dec-07 08:45:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5554231091263816823.tmp")
graftwerk.log:16-Dec-07 08:45:33 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 08:45:33 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 08:45:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 08:45:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 08:45:33 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 08:45:33 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------422600639455137887614813", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------422600639455137887614813", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74669dba>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------422600639455137887614813", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------422600639455137887614813", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74669dba>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------422600639455137887614813", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------422600639455137887614813", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@74669dba>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5989279343385364802.tmp
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5989279343385364802.tmp", context #<AccessControlContext java.security.AccessControlContext@3e27e9dd>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@24d4b0bd>}
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5989279343385364802.tmp")
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 08:45:56 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "26324", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------735811946586203853808107", "connection" "close"}, :server-port 8083, :content-length 26324, :content-type "multipart/form-data; boundary=--------------------------735811946586203853808107", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@274df0aa>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "26324", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------735811946586203853808107", "connection" "close"}, :server-port 8083, :content-length 26324, :content-type "multipart/form-data; boundary=--------------------------735811946586203853808107", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@274df0aa>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "26324", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------735811946586203853808107", "connection" "close"}, :server-port 8083, :content-length 26324, :content-type "multipart/form-data; boundary=--------------------------735811946586203853808107", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@274df0aa>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7930400860717749500.tmp
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1")))), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7930400860717749500.tmp", context #<AccessControlContext java.security.AccessControlContext@4731d1f2>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@c2ed927>}
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7930400860717749500.tmp")
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 08:46:22 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 08:46:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------985774810130494805268694", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------985774810130494805268694", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f9a0d33>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:46:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------985774810130494805268694", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------985774810130494805268694", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f9a0d33>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:46:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------985774810130494805268694", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------985774810130494805268694", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@f9a0d33>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:46:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2983664470041885371.tmp
graftwerk.log:16-Dec-07 08:46:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2983664470041885371.tmp", context #<AccessControlContext java.security.AccessControlContext@60c51ff0>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1718104c>}
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "26324", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------417636654850555780642480", "connection" "close"}, :server-port 8083, :content-length 26324, :content-type "multipart/form-data; boundary=--------------------------417636654850555780642480", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d731dd2>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "26324", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------417636654850555780642480", "connection" "close"}, :server-port 8083, :content-length 26324, :content-type "multipart/form-data; boundary=--------------------------417636654850555780642480", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d731dd2>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "26324", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------417636654850555780642480", "connection" "close"}, :server-port 8083, :content-length 26324, :content-type "multipart/form-data; boundary=--------------------------417636654850555780642480", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3d731dd2>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2983664470041885371.tmp")
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-913420181316621104.tmp
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1")))), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-913420181316621104.tmp", context #<AccessControlContext java.security.AccessControlContext@13062679>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@3c787732>}
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-913420181316621104.tmp")
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 08:46:39 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------958083755470351164174221", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------958083755470351164174221", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f1f5c3d>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------958083755470351164174221", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------958083755470351164174221", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f1f5c3d>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "28767", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------958083755470351164174221", "connection" "close"}, :server-port 8083, :content-length 28767, :content-type "multipart/form-data; boundary=--------------------------958083755470351164174221", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f1f5c3d>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2430163230847035388.tmp
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2430163230847035388.tmp", context #<AccessControlContext java.security.AccessControlContext@43dc3589>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@1e977373>}
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2430163230847035388.tmp")
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 08:47:12 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 09:03:31 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------985503940917693474501429", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------985503940917693474501429", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@68c78681>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:03:31 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------985503940917693474501429", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------985503940917693474501429", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@68c78681>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:03:31 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------985503940917693474501429", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------985503940917693474501429", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@68c78681>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:03:31 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4497461990268364289.tmp
graftwerk.log:16-Dec-07 09:03:31 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4497461990268364289.tmp", context #<AccessControlContext java.security.AccessControlContext@61f331a2>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@162aea8f>}
graftwerk.log:16-Dec-07 09:03:32 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4497461990268364289.tmp")
graftwerk.log:16-Dec-07 09:03:33 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 09:03:33 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:06:18 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 09:06:18 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 09:12:04 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------907003269688857938580593", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------907003269688857938580593", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f61f29>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:12:04 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------907003269688857938580593", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------907003269688857938580593", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f61f29>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:12:04 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------907003269688857938580593", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------907003269688857938580593", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5f61f29>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:12:04 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1397621737413116088.tmp
graftwerk.log:16-Dec-07 09:12:04 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1397621737413116088.tmp", context #<AccessControlContext java.security.AccessControlContext@bff6b89>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@65706593>}
graftwerk.log:16-Dec-07 09:12:06 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1397621737413116088.tmp")
graftwerk.log:16-Dec-07 09:12:07 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 09:12:07 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:22:13 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11300", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------310915985681729877499587", "connection" "close"}, :server-port 8083, :content-length 11300, :content-type "multipart/form-data; boundary=--------------------------310915985681729877499587", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@65d680c6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:22:13 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11300", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------310915985681729877499587", "connection" "close"}, :server-port 8083, :content-length 11300, :content-type "multipart/form-data; boundary=--------------------------310915985681729877499587", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@65d680c6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:22:13 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11300", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------310915985681729877499587", "connection" "close"}, :server-port 8083, :content-length 11300, :content-type "multipart/form-data; boundary=--------------------------310915985681729877499587", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@65d680c6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:22:13 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1140966938301516377.tmp
graftwerk.log:16-Dec-07 09:22:13 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1140966938301516377.tmp", context #<AccessControlContext java.security.AccessControlContext@526a27ae>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@18d34d72>}
graftwerk.log:16-Dec-07 09:22:14 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------309298005845818307415419", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------309298005845818307415419", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@c672113>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:22:14 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------309298005845818307415419", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------309298005845818307415419", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@c672113>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:22:14 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------309298005845818307415419", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------309298005845818307415419", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@c672113>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:22:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8218489464640720096.tmp
graftwerk.log:16-Dec-07 09:22:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet2"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8218489464640720096.tmp", context #<AccessControlContext java.security.AccessControlContext@28e46564>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@4a22e499>}
graftwerk.log:16-Dec-07 09:22:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1140966938301516377.tmp")
graftwerk.log:16-Dec-07 09:22:14 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 09:22:14 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:22:14 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8218489464640720096.tmp")
graftwerk.log:16-Dec-07 09:22:15 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 09:22:15 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 09:22:15 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 09:22:15 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 09:22:15 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:22:15 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 09:34:18 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 09:34:18 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 09:40:20 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------923344263058453352705728", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------923344263058453352705728", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3bdc850c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:40:20 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------923344263058453352705728", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------923344263058453352705728", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3bdc850c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:40:20 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------923344263058453352705728", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------923344263058453352705728", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@3bdc850c>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:40:20 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8989848668383443259.tmp
graftwerk.log:16-Dec-07 09:40:21 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8989848668383443259.tmp", context #<AccessControlContext java.security.AccessControlContext@225837d6>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@62d4c201>}
graftwerk.log:16-Dec-07 09:40:22 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8989848668383443259.tmp")
graftwerk.log:16-Dec-07 09:40:23 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 09:40:23 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:43:34 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 09:43:34 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 09:48:52 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 09:48:52 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 09:49:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------579246062206088170633127", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------579246062206088170633127", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@abea7f0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:49:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------579246062206088170633127", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------579246062206088170633127", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@abea7f0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:49:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------579246062206088170633127", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------579246062206088170633127", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@abea7f0>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:49:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4816329444470501298.tmp
graftwerk.log:16-Dec-07 09:49:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4816329444470501298.tmp", context #<AccessControlContext java.security.AccessControlContext@38e9ee06>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7b539642>}
graftwerk.log:16-Dec-07 09:49:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4816329444470501298.tmp")
graftwerk.log:16-Dec-07 09:49:41 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 09:49:41 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:52:09 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 09:52:09 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 09:54:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11949", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------686234319853960135554361", "connection" "close"}, :server-port 8083, :content-length 11949, :content-type "multipart/form-data; boundary=--------------------------686234319853960135554361", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22a8b4a9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:54:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------482763947941670462459785", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------482763947941670462459785", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@53d0bd4a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:54:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11949", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------686234319853960135554361", "connection" "close"}, :server-port 8083, :content-length 11949, :content-type "multipart/form-data; boundary=--------------------------686234319853960135554361", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22a8b4a9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:54:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11949", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------686234319853960135554361", "connection" "close"}, :server-port 8083, :content-length 11949, :content-type "multipart/form-data; boundary=--------------------------686234319853960135554361", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@22a8b4a9>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:54:37 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------482763947941670462459785", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------482763947941670462459785", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@53d0bd4a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:54:37 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11301", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------482763947941670462459785", "connection" "close"}, :server-port 8083, :content-length 11301, :content-type "multipart/form-data; boundary=--------------------------482763947941670462459785", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@53d0bd4a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:54:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2362430053232945426.tmp
graftwerk.log:16-Dec-07 09:54:37 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-1152037454330352725.tmp
graftwerk.log:16-Dec-07 09:54:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet2"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2362430053232945426.tmp", context #<AccessControlContext java.security.AccessControlContext@638bb88>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7bbc2963>}
graftwerk.log:16-Dec-07 09:54:38 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet2"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1152037454330352725.tmp", context #<AccessControlContext java.security.AccessControlContext@79483837>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@2bdf92cd>}
graftwerk.log:16-Dec-07 09:56:06 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "12056", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------760876984659214953331828", "connection" "close"}, :server-port 8083, :content-length 12056, :content-type "multipart/form-data; boundary=--------------------------760876984659214953331828", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6721a900>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:58:07 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46794", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------786420569163589784870272", "connection" "close"}, :server-port 8083, :content-length 46794, :content-type "multipart/form-data; boundary=--------------------------786420569163589784870272", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@592dfb6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:58:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "12056", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------760876984659214953331828", "connection" "close"}, :server-port 8083, :content-length 12056, :content-type "multipart/form-data; boundary=--------------------------760876984659214953331828", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6721a900>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:58:44 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46794", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------786420569163589784870272", "connection" "close"}, :server-port 8083, :content-length 46794, :content-type "multipart/form-data; boundary=--------------------------786420569163589784870272", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@592dfb6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:58:45 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46794", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------786420569163589784870272", "connection" "close"}, :server-port 8083, :content-length 46794, :content-type "multipart/form-data; boundary=--------------------------786420569163589784870272", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@592dfb6>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:58:45 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "12056", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------760876984659214953331828", "connection" "close"}, :server-port 8083, :content-length 12056, :content-type "multipart/form-data; boundary=--------------------------760876984659214953331828", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6721a900>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 09:58:45 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6683991963219756817.tmp
graftwerk.log:16-Dec-07 09:58:45 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3551489373503953071.tmp
graftwerk.log:16-Dec-07 09:58:45 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6683991963219756817.tmp", context #<AccessControlContext java.security.AccessControlContext@7fdc3048>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@61d60603>}
graftwerk.log:16-Dec-07 09:58:45 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet2") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3551489373503953071.tmp", context #<AccessControlContext java.security.AccessControlContext@3294ad9a>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@23c216fc>}
graftwerk.log:16-Dec-07 09:58:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3551489373503953071.tmp")
graftwerk.log:16-Dec-07 09:58:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2362430053232945426.tmp")
graftwerk.log:16-Dec-07 09:58:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-1152037454330352725.tmp")
graftwerk.log:16-Dec-07 09:58:46 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6683991963219756817.tmp")
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:58:47 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:58:48 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 09:58:48 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 09:59:43 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 09:59:43 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 10:58:48 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11358", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------871685421152796774667489", "connection" "close"}, :server-port 8083, :content-length 11358, :content-type "multipart/form-data; boundary=--------------------------871685421152796774667489", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@ab3a145>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 10:58:48 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11358", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------871685421152796774667489", "connection" "close"}, :server-port 8083, :content-length 11358, :content-type "multipart/form-data; boundary=--------------------------871685421152796774667489", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@ab3a145>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 10:58:48 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11358", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------871685421152796774667489", "connection" "close"}, :server-port 8083, :content-length 11358, :content-type "multipart/form-data; boundary=--------------------------871685421152796774667489", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@ab3a145>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 10:58:48 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4894046468623225669.tmp
graftwerk.log:16-Dec-07 10:58:49 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4894046468623225669.tmp", context #<AccessControlContext java.security.AccessControlContext@55f301c6>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@57f17217>}
graftwerk.log:16-Dec-07 10:58:50 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4894046468623225669.tmp")
graftwerk.log:16-Dec-07 10:58:51 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 10:58:51 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 11:01:14 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 11:01:14 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 11:01:53 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 11:01:53 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 11:33:30 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 11:33:30 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 11:33:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11358", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------506990445176800370460513", "connection" "close"}, :server-port 8083, :content-length 11358, :content-type "multipart/form-data; boundary=--------------------------506990445176800370460513", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ef07040>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:33:38 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11358", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------506990445176800370460513", "connection" "close"}, :server-port 8083, :content-length 11358, :content-type "multipart/form-data; boundary=--------------------------506990445176800370460513", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ef07040>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:33:38 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11358", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------506990445176800370460513", "connection" "close"}, :server-port 8083, :content-length 11358, :content-type "multipart/form-data; boundary=--------------------------506990445176800370460513", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6ef07040>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:33:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-2315090236702577102.tmp
graftwerk.log:16-Dec-07 11:33:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2315090236702577102.tmp", context #<AccessControlContext java.security.AccessControlContext@450c637a>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@43d8d36d>}
graftwerk.log:16-Dec-07 11:33:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-2315090236702577102.tmp")
graftwerk.log:16-Dec-07 11:33:41 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 11:33:41 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11357", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------117163964320370667809319", "connection" "close"}, :server-port 8083, :content-length 11357, :content-type "multipart/form-data; boundary=--------------------------117163964320370667809319", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2a0deef>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11357", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------117163964320370667809319", "connection" "close"}, :server-port 8083, :content-length 11357, :content-type "multipart/form-data; boundary=--------------------------117163964320370667809319", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2a0deef>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11357", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------117163964320370667809319", "connection" "close"}, :server-port 8083, :content-length 11357, :content-type "multipart/form-data; boundary=--------------------------117163964320370667809319", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2a0deef>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-9174577720191549246.tmp
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-9174577720191549246.tmp", context #<AccessControlContext java.security.AccessControlContext@4a22e499>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7dc5dea3>}
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46794", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------464492032010692806434586", "connection" "close"}, :server-port 8083, :content-length 46794, :content-type "multipart/form-data; boundary=--------------------------464492032010692806434586", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@24aa3b93>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46794", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------464492032010692806434586", "connection" "close"}, :server-port 8083, :content-length 46794, :content-type "multipart/form-data; boundary=--------------------------464492032010692806434586", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@24aa3b93>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46794", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------464492032010692806434586", "connection" "close"}, :server-port 8083, :content-length 46794, :content-type "multipart/form-data; boundary=--------------------------464492032010692806434586", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@24aa3b93>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-8458880129512833457.tmp
graftwerk.log:16-Dec-07 11:34:39 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8458880129512833457.tmp", context #<AccessControlContext java.security.AccessControlContext@414c8cf9>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@426dd48a>}
graftwerk.log:16-Dec-07 11:34:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-9174577720191549246.tmp")
graftwerk.log:16-Dec-07 11:34:40 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 11:34:40 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 11:34:40 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-8458880129512833457.tmp")
graftwerk.log:16-Dec-07 11:34:41 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 11:34:41 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 11:34:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 11:34:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 11:34:41 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 11:34:41 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 11:37:00 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46794", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------181252235784839392873936", "connection" "close"}, :server-port 8083, :content-length 46794, :content-type "multipart/form-data; boundary=--------------------------181252235784839392873936", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1d8aad6a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:37:00 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46794", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------181252235784839392873936", "connection" "close"}, :server-port 8083, :content-length 46794, :content-type "multipart/form-data; boundary=--------------------------181252235784839392873936", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1d8aad6a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:37:00 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46794", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------181252235784839392873936", "connection" "close"}, :server-port 8083, :content-length 46794, :content-type "multipart/form-data; boundary=--------------------------181252235784839392873936", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@1d8aad6a>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:37:00 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-6293440209146648473.tmp
graftwerk.log:16-Dec-07 11:37:00 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1") (-> (make-dataset move-first-row-to-header) (rename-columns (comp keyword new-tabular/string-as-keyword))))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6293440209146648473.tmp", context #<AccessControlContext java.security.AccessControlContext@208cae18>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7f80325a>}
graftwerk.log:16-Dec-07 11:37:13 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------706671896143758830114511", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------706671896143758830114511", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2899c90f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:47:24 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------706671896143758830114511", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------706671896143758830114511", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2899c90f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:47:24 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------706671896143758830114511", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------706671896143758830114511", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@2899c90f>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:47:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-3981589151960920334.tmp
graftwerk.log:16-Dec-07 11:47:24 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3981589151960920334.tmp", context #<AccessControlContext java.security.AccessControlContext@4292babf>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@40608ac0>}
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-6293440209146648473.tmp")
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-3981589151960920334.tmp")
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 11:47:25 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 11:48:18 SINTEFPC7430 INFO [graftwerk.handler] - 
graftwerk.log:-=[ graftwerk started successfully using the development profile ]=-
graftwerk.log:16-Dec-07 11:48:18 SINTEFPC7430 INFO [graftwerk.core] - Graftwerk started visit http://localhost:3000/
graftwerk.log:16-Dec-07 11:55:03 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------662109343127471589485664", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------662109343127471589485664", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6921e3ea>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:55:03 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------662109343127471589485664", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------662109343127471589485664", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6921e3ea>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:55:03 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46687", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------662109343127471589485664", "connection" "close"}, :server-port 8083, :content-length 46687, :content-type "multipart/form-data; boundary=--------------------------662109343127471589485664", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@6921e3ea>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:55:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-7019473084874693226.tmp
graftwerk.log:16-Dec-07 11:55:03 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xls :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7019473084874693226.tmp", context #<AccessControlContext java.security.AccessControlContext@35345195>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@175f3b23>}
graftwerk.log:16-Dec-07 11:55:06 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-7019473084874693226.tmp")
graftwerk.log:16-Dec-07 11:55:07 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 11:55:07 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 11:55:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 11:55:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 11:55:07 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 11:55:07 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 11:56:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46688", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------547118361600547580473845", "connection" "close"}, :server-port 8083, :content-length 46688, :content-type "multipart/form-data; boundary=--------------------------547118361600547580473845", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@47446917>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:56:26 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46688", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------547118361600547580473845", "connection" "close"}, :server-port 8083, :content-length 46688, :content-type "multipart/form-data; boundary=--------------------------547118361600547580473845", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@47446917>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:56:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "46688", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------547118361600547580473845", "connection" "close"}, :server-port 8083, :content-length 46688, :content-type "multipart/form-data; boundary=--------------------------547118361600547580473845", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@47446917>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:56:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-5375732240509362655.tmp
graftwerk.log:16-Dec-07 11:56:26 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5375732240509362655.tmp", context #<AccessControlContext java.security.AccessControlContext@126d108>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@7b6c29ef>}
graftwerk.log:16-Dec-07 11:56:26 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11251", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------068193951568182237820071", "connection" "close"}, :server-port 8083, :content-length 11251, :content-type "multipart/form-data; boundary=--------------------------068193951568182237820071", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5b91edb8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:57:16 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Received request {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11251", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------068193951568182237820071", "connection" "close"}, :server-port 8083, :content-length 11251, :content-type "multipart/form-data; boundary=--------------------------068193951568182237820071", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5b91edb8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 DEBUG [graftwerk.middleware] - {:ssl-client-cert nil, :remote-addr "192.168.56.1", :headers {"host" "localhost:8083", "content-length" "11251", "transfer-encoding" "chuncked", "content-type" "multipart/form-data; boundary=--------------------------068193951568182237820071", "connection" "close"}, :server-port 8083, :content-length 11251, :content-type "multipart/form-data; boundary=--------------------------068193951568182237820071", :character-encoding nil, :uri "/evaluate/pipe", :server-name "localhost", :query-string nil, :body #<HttpInput org.eclipse.jetty.server.HttpInput@5b91edb8>, :scheme :http, :request-method :post}
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Input data path C:\Users\Dinas\AppData\Local\Temp\ring-multipart-4677181536870436092.tmp
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - build-sandbox => {pipeline-sexp (do (defn double-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Double/parseDouble s))) (defn integer-literal [s] (if (nil? (re-matches (read-string "#\"[0-9.]+\"") s)) 0 (Integer/parseInt s))) (defn join [& strings] (clojure.string/join " " strings)) (defn join-with [sep] (fn [& strings] (clojure.string/join sep strings))) (defn organize-date "Transform date dd/mm/yyyy ~> yyyy-mm-dd" [date] (when (seq date) (let [[d m y] (clojure.string/split date (read-string "#\"/\""))] (apply str (interpose "-" [y m d]))))) (defn remove-blanks [s] (when (seq s) (clojure.string/replace s " " ""))) (defn replace-varible-string [cell] (-> cell (clojure.string/replace (read-string "#\".* #\"") "number") (clojure.string/replace (read-string "#\"[0-9]{4} \"") ""))) (def string-literal s) (defn stringToNumeric [x] (if (= "" x) nil (if (.contains x ".") (Double/parseDouble x) (Integer/parseInt x)))) (defn titleize [st] (when (seq st) (let [a (clojure.string/split st (read-string "#\" \"")) c (map clojure.string/capitalize a)] (->> c (interpose " ") (apply str) clojure.string/trim)))) (def transform-gender {"f" (s "female"), "m" (s "male")}) (defn get-lat-long-strings-replacement [easting northing hemisphere zoneNumber] (let [utmCoords (. gov.nasa.worldwind.geom.coords.UTMCoord fromUTM (Integer/parseInt zoneNumber) (if (= hemisphere "N") "gov.nasa.worldwind.avkey.North" (if (= hemisphere "S") "gov.nasa.worldwind.avkey.East" (throw (Exception. "Wrong hemisphere input")))) (Double/parseDouble easting) (Double/parseDouble northing))] (vector (re-pattern easting) (str (.getDegrees (.getLongitude utmCoords))) (re-pattern northing) (str (.getDegrees (.getLatitude utmCoords)))))) (defn replace-several [content replacements] (let [replacement-list (partition 2 replacements)] (reduce (fn [arg1 arg2] (apply clojure.string/replace arg1 arg2)) content replacement-list))) (defn fill-when [col] (grafter.sequences/fill-when col)) (defn convert-col-lat-long [col hemisphere zoneNumber] (let [all-coords (re-seq (re-pattern "-?[0-9.]+?(?=[, )])") col)] (replace-several col (flatten (map (fn [coord-pair] (get-lat-long-strings-replacement (nth coord-pair 0) (nth coord-pair 1) hemisphere zoneNumber)) (partition 2 all-coords)))))) (def not-empty? (complement empty?)) (def make-graph (graph-fn [{:keys []}])) (defpipe my-pipe "Grafter pipeline for data clean-up and preparation." [data-file] (-> (read-dataset data-file :format :xlsx :sheet "Sheet1"))) (defgraft my-graft "Transformation that converts input CSV data into RDF graph data." my-pipe make-graph)), file-path "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4677181536870436092.tmp", context #<AccessControlContext java.security.AccessControlContext@541b9cf8>, namespace-form (ns graftwerk.pipeline (:require [grafter.tabular :refer :all] [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]] [tabular_functions.datatypes :as datatypes] [tabular_functions.pipeline :as new-tabular] [grafter.rdf :refer [prefixer s]] [grafter.rdf.templater :refer [graph]] [grafter.vocabularies.rdf :refer :all] [grafter.vocabularies.qb :refer :all] [grafter.vocabularies.sdmx-measure :refer :all] [grafter.vocabularies.sdmx-attribute :refer :all] [grafter.vocabularies.skos :refer :all] [grafter.vocabularies.foaf :refer :all] [grafter.vocabularies.owl :refer :all] [grafter.vocabularies.dcterms :refer :all] [graftwerk.shape.shape-support :refer :all]) (:import [gov.nasa.worldwind.geom.coords.UTMCoord] [org.openrdf.model.impl.URIImpl])), sb #<core$sandbox$fn__11434 clojail.core$sandbox$fn__11434@45326e98>}
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-4677181536870436092.tmp")
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - About to apply pipe in sandbox (my-pipe "C:\\Users\\Dinas\\AppData\\Local\\Temp\\ring-multipart-5375732240509362655.tmp")
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.routes.evaluate] - Paging results  50  per page.  Page # 0
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Type" "application/octet-stream"}
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Selected format:  application/edn
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Client sent accept headers: application/edn selected  application/edn
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.middleware] - 200   :post   /evaluate/pipe   {"Content-Disposition" "attachment; filename=\"results\"", "Content-Type" "application/edn"}
graftwerk.log:16-Dec-07 11:57:17 SINTEFPC7430 INFO [graftwerk.middleware.dataset] - Dataset streamed
graftwerk.log:16-Dec-07 11:57:18 SINTEFPC7430 WARN [graftwerk.middleware.dataset] - Unknown error caught.  Returning 500 with stack trace
graftwerk.log:                                                      [33mring.adapter.jetty/proxy-handler/[1;33mfn[m  [32m                  jetty.clj:   18[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                               [33mnoir-exception.core/wrap-internal-error/[1;33mfn[m  [32m                   core.clj:  121[m
graftwerk.log:                             [33mring.middleware.session-timeout/wrap-idle-session-timeout/[1;33mfn[m  [32m        session_timeout.clj:   25[m
graftwerk.log:                 [33mgraftwerk.middleware.dataset/wrap-write-dataset/[1;33mwrite-dataset-middleware[m  [32m                dataset.clj:  113[m
graftwerk.log:                                                      [33mgraftwerk.middleware/log-request/[1;33mfn[m  [32m             middleware.clj:   19[m
graftwerk.log:                                                      [33mprone.middleware/wrap-exceptions/[1;33mfn[m  [32m             middleware.clj:   92[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                                   [33mprone.stacks/[1;33madd-cause[m  [32m                 stacks.clj:   84[m
graftwerk.log:                                                         [33mprone.stacks/[1;33mnormalize-exception[m  [32m                 stacks.clj:  111[m
graftwerk.log:                                                      [33mprone.stacks/[1;33madd-frame-from-message[m  [32m                 stacks.clj:   88[m
graftwerk.log:                                                                     [33mclojure.core/[1;33mre-find[m  [32m                   core.clj: 4512[m
graftwerk.log:                                                                  [33mclojure.core/[1;33mre-matcher[m  [32m                   core.clj: 4460[m
graftwerk.log:16-Dec-07 11:57:19 SINTEFPC7430 INFO [graftwerk.middleware] - 500   :post   /evaluate/pipe   {"Content-Type" "application/edn"}
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1-SNAPSHOT.pom:<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1-SNAPSHOT.pom:  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1-SNAPSHOT.pom:  <version>0.0.1-SNAPSHOT</version>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1-SNAPSHOT.pom:  <name>geo-converter</name>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1-SNAPSHOT.pom:    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1-SNAPSHOT.pom:            <artifactId>gt-shapefile</artifactId>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1-SNAPSHOT.pom:            <id>maven2-repository.dev.java.net</id>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1-SNAPSHOT.pom:    <artifactId>geo-converter</artifactId>
Binary file maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/geo-converter-0.0.1.jar matches
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/maven-metadata-local.xml:<?xml version="1.0" encoding="UTF-8"?>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/maven-metadata-local.xml:  <artifactId>geo-converter</artifactId>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/maven-metadata-local.xml:  <version>0.0.1-SNAPSHOT</version>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/maven-metadata-local.xml:        <value>0.0.1-SNAPSHOT</value>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/maven-metadata-local.xml:        <value>0.0.1-SNAPSHOT</value>
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/resolver-status.properties:maven-metadata-local.xml.lastUpdated=1475743449715
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/resolver-status.properties:maven-metadata-clojars.xml.error=
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/resolver-status.properties:maven-metadata-local.xml.error=
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/resolver-status.properties:maven-metadata-clojars.xml.lastUpdated=1475743452092
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/_remote.repositories:geo-converter-0.0.1-SNAPSHOT.jar>=
maven_repository/datagraft/geo-converter/0.0.1-SNAPSHOT/_remote.repositories:geo-converter-0.0.1-SNAPSHOT.pom>=
maven_repository/datagraft/geo-converter/maven-metadata-local.xml:<?xml version="1.0" encoding="UTF-8"?>
maven_repository/datagraft/geo-converter/maven-metadata-local.xml:  <artifactId>geo-converter</artifactId>
maven_repository/datagraft/geo-converter/maven-metadata-local.xml:      <version>0.0.1-SNAPSHOT</version>
Binary file maven_repository/ww-geo-coords/ww-geo-coords/1.0/ww-geo-coords-1.0.jar matches
maven_repository/ww-geo-coords/ww-geo-coords/1.0/ww-geo-coords-1.0.pom:<?xml version="1.0" encoding="UTF-8"?>
maven_repository/ww-geo-coords/ww-geo-coords/1.0/ww-geo-coords-1.0.pom:<project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd" xmlns="http://maven.apache.org/POM/4.0.0"
maven_repository/ww-geo-coords/ww-geo-coords/1.0/ww-geo-coords-1.0.pom:    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
maven_repository/ww-geo-coords/ww-geo-coords/1.0/ww-geo-coords-1.0.pom:  <groupId>ww-geo-coords</groupId>
maven_repository/ww-geo-coords/ww-geo-coords/1.0/ww-geo-coords-1.0.pom:  <artifactId>ww-geo-coords</artifactId>
maven_repository/ww-geo-coords/ww-geo-coords/maven-metadata.xml:<?xml version="1.0" encoding="UTF-8"?>
maven_repository/ww-geo-coords/ww-geo-coords/maven-metadata.xml:  <groupId>ww-geo-coords</groupId>
maven_repository/ww-geo-coords/ww-geo-coords/maven-metadata.xml:  <artifactId>ww-geo-coords</artifactId>
namespace.edn:            [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]]
namespace.edn:            [tabular_functions.pipeline :as new-tabular]
namespace.edn:            [grafter.vocabularies.sdmx-measure :refer :all]
namespace.edn:            [grafter.vocabularies.sdmx-attribute :refer :all]
namespace.edn:            [graftwerk.shape.shape-support :refer :all]
namespace.example.edn:               [grafter.vocabularies.sdmx-measure :refer :all]
namespace.example.edn:               [grafter.vocabularies.sdmx-attribute :refer :all]
project.clj:  :license {:name "Eclipse Public License - v1.0 (c) 2016 Swirrl IT Ltd"
project.clj:            :url "https://www.eclipse.org/legal/epl-v10.html"}
project.clj:                 [ring-server "0.3.1"]
project.clj:                 [ring/ring-defaults "0.1.3"]
project.clj:                 [ring/ring-session-timeout "0.1.0"]
project.clj:                 [ring-middleware-format "0.4.0"]
project.clj:                 [noir-exception "0.2.3"]
project.clj:                 [org.slf4j/slf4j-simple "1.6.1"]
project.clj:                 [ww-geo-coords "1.0"]
project.clj:                 [datagraft/geo-converter "0.0.1-SNAPSHOT"]
project.clj:  :min-lein-version "2.5.0"
project.clj:  :uberjar-name "graftwerk.jar"
project.clj:  :repl-options {:init-ns graftwerk.core
project.clj:                 :init (-main)
project.clj:  :jvm-opts ["-server" "-Djava.security.manager" "-Djava.security.policy=.java.policy"]
project.clj:  :plugins [[lein-ring "0.9.1"]
project.clj:            [lein-environ "1.0.0"]
project.clj:            [lein-ancient "0.6.0"]]
project.clj:         :uberwar-name "graftwerk.war"}
project.clj:  {:uberjar {:omit-source true
project.clj:   :production {:ring {:open-browser? false
project.clj:                       :auto-reload?  false}}
project.clj:   :dev {:dependencies [[ring-mock "0.1.5"]
project.clj:                        [ring/ring-devel "1.3.2"]
project.clj:                        [pjstadig/humane-test-output "0.6.0"]]
project.clj:         :injections [(require 'pjstadig.humane-test-output)
project.clj:                      (pjstadig.humane-test-output/activate!)]
README.org:java -jar graftwerk.jar -Djava.security.policy=~/.java.policy
README.org:=java -jar graftwerk.jar=
README.org:=example-data.csv=.  The server currently only works with CSV files as
README.org:(defn ->integer
README.org:(def base-domain (prefixer "http://my-domain.com"))
README.org:(def base-graph (prefixer (base-domain "/graph/")))
README.org:(def base-id (prefixer (base-domain "/id/")))
README.org:(def base-vocab (prefixer (base-domain "/def/")))
README.org:(def base-data (prefixer (base-domain "/data/")))
README.org:(def make-graph
README.org:  (graph-fn [{:keys [name sex age person-uri gender]}]
README.org:            (graph (base-graph "example")
README.org:                   [person-uri
README.org:(defpipe my-pipe
README.org:  [data-file]
README.org:  (-> (read-dataset data-file :format :csv)
README.org:      (drop-rows 1)
README.org:      (make-dataset [:name :sex :age])
README.org:      (derive-column :person-uri [:name] base-id)
README.org:      (mapc {:age ->integer
README.org:(defgraft my-graft
README.org:  my-pipe make-graph)
README.org:          [grafter.vocabularies.sdmx-measure :refer :all]
README.org:          [grafter.vocabularies.sdmx-attribute :refer :all]
README.org:- Visit [[http://localhost:3000/pipe][/pipe]] in your browser to access the test form for pipes.
README.org:- Visit [[http://localhost:3000/graft][/graft]] in your browser to access the test form for grafts.
README.org:|-------------+------------------------+------------------------------------------------------------------------------------------------------------|
README.org:|-------------------+--------|
README.org:The POSTs body =MUST= contain valid =multipart/form-data= and =MUST=
README.org:have the =Content-Type= of the request set to =multipart/form-data=.
README.org:For more details see the [[http://www.w3.org/TR/html401/interact/forms.html#h-17.13.4.2][W3C recommendations on Form Content Types]].
README.org:| Name (form key) | Description                                 | Content-Disposition |
README.org:|-----------------+---------------------------------------------+---------------------|
README.org:| command         | The name of the pipe/graft function to call | form-data           |
README.org:run the pipe below you would set command to =my-pipeline=.  This works
README.org:(defpipe my-pipeline [dataset]
README.org:  (-> (read-dataset dataset)
README.org:and n-triples for grafts.
README.org:|------------+-----------------------|
README.org:| graft      | application/n-triples |
README.org:|-------------+---------+-----------------------------------------------------------------|
README.org:| =page=      | Integer | Requests the page number =page=.  Assuming =page-size= results. |
README.org:| =page-size= | Integer | The number of results per page.  Defaults to =50=               |
README.org:return only all of the results as n-triples.  This section describes
README.org:|-----------+---------+---------------------------------------------------------|
README.org:commands =graph-fn= template.  The specified =row= is then transformed via the
README.org:grafts pipe and the data injected into the =graph-fn= template.  Graftwerk
README.org:finally returns a data-structure containing the body of the graph-fn template
README.org:returned data-structure also contains additional data which may be useful for
README.org:=graph-fn='s arguments list.
README.org:For example given the following =graph-fn=
README.org:(def my-graph-template (graph-fn [{:strs [persons-graph-uri person-uri person-name person-age friend-uri friend-name friend-age]}]
README.org:                          (graph persons-graph-uri
README.org:                             [person-uri
README.org:                                [foaf:name person-name]
README.org:                                [foaf:age  person-age]
README.org:                                [foaf:knows friend-uri]]
README.org:                             [friend-uri
README.org:                                [foaf:name friend-name]
README.org:                                [foaf:age  friend-age]
README.org:                                [foaf:knows person-uri]])))
README.org:| persons-graph-uri | person-uri     | person-name | person-age | friend-uri    | friend-name | friend-age |
README.org:|-------------------+----------------+-------------+------------+---------------+-------------+------------|
README.org:  [persons-graph-uri person-uri person-name
README.org:   person-age friend-uri friend-name friend-age]},
README.org: {"friend-age" 30, "friend-name" "Alice", "friend-uri" "http://alice/",
README.org:  "person-age" 35, "person-name" "Bob",  "person-uri" "http://bob/",
README.org:  "persons-graph-uri" "http://graph/"},
README.org:the =graph-fn= function with all the column variables substituted for the
README.org:=:bindings= contains the bindings specified for the =graph-fn= function.  Most
README.org: { :column-names ["one" :two "three"]
src/graftwerk/core.clj:            [ring.adapter.jetty :refer [run-jetty]]
src/graftwerk/core.clj:  (:gen-class))
src/graftwerk/core.clj:(defn -main [& args]
src/graftwerk/core.clj:    (run-jetty #'app {:port port :host host :join? false})))
src/graftwerk/handler.clj:            [graftwerk.routes.evaluate :refer [pipe-route graft-route]]
src/graftwerk/handler.clj:            [graftwerk.middleware :refer [common-api-middleware
src/graftwerk/handler.clj:                                          development-middleware
src/graftwerk/handler.clj:                                          production-middleware]]
src/graftwerk/handler.clj:(defroutes base-routes
src/graftwerk/handler.clj:       (redirect "https://github.com/Swirrl/graftwerk#running-pipes-and-grafts-on-the-whole-dataset"))
src/graftwerk/handler.clj:  (route/not-found "Not Found"))
src/graftwerk/handler.clj:  (timbre/merge-config!
src/graftwerk/handler.clj:   {:appenders {:spit (appenders/spit-appender {:fname "graftwerk.log"})}
src/graftwerk/handler.clj:  (timbre/info "\n-=[ graftwerk started successfully"
src/graftwerk/handler.clj:               (when (env :dev) "using the development profile") "]=-"))
src/graftwerk/handler.clj:  (-> (routes
src/graftwerk/handler.clj:       #'pipe-route
src/graftwerk/handler.clj:       #'graft-route
src/graftwerk/handler.clj:       #'base-routes)
src/graftwerk/handler.clj:      common-api-middleware
src/graftwerk/handler.clj:      development-middleware
src/graftwerk/handler.clj:      production-middleware))
src/graftwerk/middleware/dataset.clj:  (:require [grafter.tabular :refer [make-dataset dataset? write-dataset]]
src/graftwerk/middleware/dataset.clj:            [grafter.tabular.common :refer [write-dataset* dataset->seq-of-seqs]]
src/graftwerk/middleware/dataset.clj:            [grafter.rdf.io :refer [rdf-serializer]]
src/graftwerk/middleware/dataset.clj:            [grafter.rdf.preview :refer [->printable-form]]
src/graftwerk/middleware/dataset.clj:            [ring.middleware.format-response :refer [parse-accept-header]]
src/graftwerk/middleware/dataset.clj:            [clojure.java.io :refer [output-stream]]
src/graftwerk/middleware/dataset.clj:            [ring.util.mime-type :refer [default-mime-types]]
src/graftwerk/middleware/dataset.clj:            [ring.util.io :refer [piped-input-stream]]
src/graftwerk/middleware/dataset.clj:            [clojure.data.csv :refer [write-csv]])
src/graftwerk/middleware/dataset.clj:(defn stream-csv [output dataset]
src/graftwerk/middleware/dataset.clj:  (let [rows (dataset->seq-of-seqs dataset)
src/graftwerk/middleware/dataset.clj:        stringified-rows (map (partial map str) rows)]
src/graftwerk/middleware/dataset.clj:    (write-csv output stringified-rows)))
src/graftwerk/middleware/dataset.clj:(defmacro with-out-stream [ostream & body]
src/graftwerk/middleware/dataset.clj:(defn stream-edn [output dataset]
src/graftwerk/middleware/dataset.clj:  (let [dataset (->printable-form dataset)
src/graftwerk/middleware/dataset.clj:        cols (:column-names dataset)]
src/graftwerk/middleware/dataset.clj:    (with-out-stream output
src/graftwerk/middleware/dataset.clj:      (prn {:column-names cols :rows rows}))))
src/graftwerk/middleware/dataset.clj:;; this.  Essentially I'd like to use ring.middleware.format-response
src/graftwerk/middleware/dataset.clj:;; strings, where-as really we want to stream a response to the
src/graftwerk/middleware/dataset.clj:;; I submitted a bug-report/feature-request here:
src/graftwerk/middleware/dataset.clj:;; See: https://github.com/ngrunwald/ring-middleware-format/issues/41
src/graftwerk/middleware/dataset.clj:;; regards to content-neg.
src/graftwerk/middleware/dataset.clj:(defn- select-content-type [types]
src/graftwerk/middleware/dataset.clj:  (let [accepts (->> types
src/graftwerk/middleware/dataset.clj:                     parse-accept-header
src/graftwerk/middleware/dataset.clj:                     (sort-by :q)
src/graftwerk/middleware/dataset.clj:        {:keys [sub-type type]} (first accepts)
src/graftwerk/middleware/dataset.clj:        chosen (str type "/" sub-type)]
src/graftwerk/middleware/dataset.clj:(def ^:private mime-type->streamer {"application/csv" stream-csv
src/graftwerk/middleware/dataset.clj:                                    "application/edn" stream-edn})
src/graftwerk/middleware/dataset.clj:(def ^:private mime-type->serialization-format {"application/n-triples" rdf-ntriples
src/graftwerk/middleware/dataset.clj:                                                "application/rdf+xml" rdf-xml
src/graftwerk/middleware/dataset.clj:                                                "text/turtle" rdf-turtle
src/graftwerk/middleware/dataset.clj:                                                "application/n-quads"  rdf-nquads
src/graftwerk/middleware/dataset.clj:                                                "text/n3" rdf-n3
src/graftwerk/middleware/dataset.clj:                                                "application/trix" rdf-trix
src/graftwerk/middleware/dataset.clj:                                                "application/trig" rdf-trig
src/graftwerk/middleware/dataset.clj:                                                "application/ld+json" rdf-jsonld})
src/graftwerk/middleware/dataset.clj:(defn map-values [f m]
src/graftwerk/middleware/dataset.clj:(defn serialise-grafter-s
src/graftwerk/middleware/dataset.clj:  (let [reified-s-classes #{(class (s "foo"))
src/graftwerk/middleware/dataset.clj:    (make-dataset (map (partial map-values (fn [st]
src/graftwerk/middleware/dataset.clj:                                             (if (reified-s-classes (class st))
src/graftwerk/middleware/dataset.clj:                  (:column-names ds))))
src/graftwerk/middleware/dataset.clj:(defn- ->stream
src/graftwerk/middleware/dataset.clj:  piped-input-stream to stream the dataset to the client."
src/graftwerk/middleware/dataset.clj:  (piped-input-stream
src/graftwerk/middleware/dataset.clj:       (with-open [writer (clojure.java.io/writer ostream)]
src/graftwerk/middleware/dataset.clj:         (streamer writer (serialise-grafter-s dataset)))
src/graftwerk/middleware/dataset.clj:(defn wrap-write-dataset [app]
src/graftwerk/middleware/dataset.clj:  (fn write-dataset-middleware
src/graftwerk/middleware/dataset.clj:            accepts (get-in req [:headers "accept"] "application/edn")
src/graftwerk/middleware/dataset.clj:            selected-format (select-content-type accepts)]
src/graftwerk/middleware/dataset.clj:        (log/info "Client sent accept headers:" accepts "selected " selected-format)
src/graftwerk/middleware/dataset.clj:                                selected-streamer (get mime-type->streamer selected-format stream-edn)]
src/graftwerk/middleware/dataset.clj:                            (-> response
src/graftwerk/middleware/dataset.clj:                                (assoc :body (->stream dataset selected-streamer))
src/graftwerk/middleware/dataset.clj:                                (assoc-in [:headers "Content-Type"] selected-format)
src/graftwerk/middleware/dataset.clj:                                (assoc-in [:headers "Content-Disposition"] "attachment; filename=\"results\"")))
src/graftwerk/middleware/dataset.clj:                        (let [accepts (get-in req [:headers "accept"] "application/edn")
src/graftwerk/middleware/dataset.clj:                              selected-format (select-content-type accepts)
src/graftwerk/middleware/dataset.clj:                              printed-edn (java.io.StringWriter.)]
src/graftwerk/middleware/dataset.clj:                          (pprint body printed-edn)
src/graftwerk/middleware/dataset.clj:                          (-> response
src/graftwerk/middleware/dataset.clj:                              (assoc :body (str printed-edn))
src/graftwerk/middleware/dataset.clj:                              (assoc-in [:headers "Content-Type"] "application/edn"))))
src/graftwerk/middleware/dataset.clj:                               (-> response
src/graftwerk/middleware/dataset.clj:                                   (assoc-in [:headers "Content-Type"] selected-format)
src/graftwerk/middleware/dataset.clj:                                   (assoc :body (piped-input-stream (fn [ostream]
src/graftwerk/middleware/dataset.clj:                                                                        (with-open [writer (clojure.java.io/writer ostream)]
src/graftwerk/middleware/dataset.clj:                                                                          (grafter.rdf/add (rdf-serializer writer :format (mime-type->serialization-format  selected-format))
src/graftwerk/middleware/dataset.clj:         :headers {"Content-Type" "application/edn"}
src/graftwerk/middleware/dataset.clj:         :body (prn-str {:type :error
src/graftwerk/middleware.clj:            [selmer.middleware :refer [wrap-error-page]]
src/graftwerk/middleware.clj:            [prone.middleware :refer [wrap-exceptions]]
src/graftwerk/middleware.clj:            [grafter.tabular :refer [make-dataset dataset?]]
src/graftwerk/middleware.clj:            [graftwerk.middleware.dataset :refer [wrap-write-dataset]]
src/graftwerk/middleware.clj:            [ring.middleware.defaults :refer [api-defaults wrap-defaults]]
src/graftwerk/middleware.clj:            [ring.middleware.session-timeout :refer [wrap-idle-session-timeout]]
src/graftwerk/middleware.clj:            [noir-exception.core :refer [wrap-internal-error]]
src/graftwerk/middleware.clj:            [ring.middleware.format :refer [wrap-restful-format]]))
src/graftwerk/middleware.clj:(def middleware-params (assoc-in api-defaults [:params :multipart] true))
src/graftwerk/middleware.clj:(defn log-request [handler]
src/graftwerk/middleware.clj:      (timbre/info status " " (:request-method req) " " (:uri req) " " headers)
src/graftwerk/middleware.clj:(defn common-api-middleware [handler]
src/graftwerk/middleware.clj:  (-> handler
src/graftwerk/middleware.clj:      (wrap-defaults middleware-params)))
src/graftwerk/middleware.clj:(defn development-middleware [handler]
src/graftwerk/middleware.clj:    (-> handler
src/graftwerk/middleware.clj:        wrap-error-page
src/graftwerk/middleware.clj:        wrap-exceptions
src/graftwerk/middleware.clj:        log-request)
src/graftwerk/middleware.clj:(defn production-middleware [handler]
src/graftwerk/middleware.clj:  (-> handler
src/graftwerk/middleware.clj:      wrap-write-dataset
src/graftwerk/middleware.clj:      (wrap-idle-session-timeout
src/graftwerk/middleware.clj:         :timeout-response (redirect "/")})
src/graftwerk/middleware.clj:      (wrap-internal-error :log #(timbre/error %))
src/graftwerk/middleware.clj:      log-request))
src/graftwerk/routes/evaluate.clj:            [clojure.stacktrace :refer [root-cause]]
src/graftwerk/routes/evaluate.clj:            [grafter.tabular :refer [make-dataset dataset?]]
src/graftwerk/routes/evaluate.clj:            [clojail.core :refer [sandbox safe-read eagerly-consume]]
src/graftwerk/routes/evaluate.clj:            [clojail.testers :refer [secure-tester-without-def blanket blacklist-objects blacklist-packages blacklist-symbols blacklist-nses]]
src/graftwerk/routes/evaluate.clj:            [graftwerk.validations :refer [if-invalid valid? validate-pipe-run-request validate-graft-run-request]]
src/graftwerk/routes/evaluate.clj:            [graftwerk.shape.shape-support :refer [convert-shape]]
src/graftwerk/routes/evaluate.clj:(def default-namespace-declaration
src/graftwerk/routes/evaluate.clj:               [clojure.string :refer [capitalize lower-case upper-case trim trim-newline triml trimr]]
src/graftwerk/routes/evaluate.clj:               [tabular_functions.pipeline :as new-tabular]
src/graftwerk/routes/evaluate.clj:               [grafter.vocabularies.sdmx-measure :refer :all]
src/graftwerk/routes/evaluate.clj:               [grafter.vocabularies.sdmx-attribute :refer :all]
src/graftwerk/routes/evaluate.clj:(defn namespace-symbol
src/graftwerk/routes/evaluate.clj:  [ns-form]
src/graftwerk/routes/evaluate.clj:  (second ns-form))
src/graftwerk/routes/evaluate.clj:(defn namespace-declaration []
src/graftwerk/routes/evaluate.clj:  (let [requires (try (edn/read-string (slurp "namespace.edn"))
src/graftwerk/routes/evaluate.clj:                        default-namespace-declaration))]
src/graftwerk/routes/evaluate.clj:(defn namespace-qualify [namespace-name-sym command]
src/graftwerk/routes/evaluate.clj:  (symbol (str namespace-name-sym "/" command)))
src/graftwerk/routes/evaluate.clj:  modified-secure-tester-without-def
src/graftwerk/routes/evaluate.clj:  [(blacklist-objects [clojure.lang.Compiler clojure.lang.Ref clojure.lang.Reflector
src/graftwerk/routes/evaluate.clj:   (blacklist-packages ["java.lang.reflect"
src/graftwerk/routes/evaluate.clj:   (blacklist-symbols
src/graftwerk/routes/evaluate.clj:    '#{alter-var-root intern eval catch *read-eval*
src/graftwerk/routes/evaluate.clj:       load-string load-reader addMethod ns-resolve resolve find-var
src/graftwerk/routes/evaluate.clj:       ns-publics ns-unmap set! ns-map ns-interns the-ns
src/graftwerk/routes/evaluate.clj:       push-thread-bindings
src/graftwerk/routes/evaluate.clj:       pop-thread-bindings
src/graftwerk/routes/evaluate.clj:       future-call agent send
src/graftwerk/routes/evaluate.clj:       send-off pmap pcalls pvals in-ns System/out System/in System/err
src/graftwerk/routes/evaluate.clj:       with-redefs-fn Class/forName})
src/graftwerk/routes/evaluate.clj:   (blacklist-nses '[clojure.main])
src/graftwerk/routes/evaluate.clj:(defn build-sandbox
src/graftwerk/routes/evaluate.clj:  [pipeline-sexp file-path]
src/graftwerk/routes/evaluate.clj:  (let [context (-> (permissions (FilePermission. file-path "read") (PropertyPermission. "file.separator" "read")  )
src/graftwerk/routes/evaluate.clj:        namespace-form (namespace-declaration)
src/graftwerk/routes/evaluate.clj:        sb (sandbox modified-secure-tester-without-def
src/graftwerk/routes/evaluate.clj:                    :init namespace-form
src/graftwerk/routes/evaluate.clj:                    :namespace (namespace-symbol namespace-form)
src/graftwerk/routes/evaluate.clj:                    :transform eagerly-consume
src/graftwerk/routes/evaluate.clj:                    :max-defs 500)]
src/graftwerk/routes/evaluate.clj:    (log/log-env :info "build-sandbox")
src/graftwerk/routes/evaluate.clj:    (sb pipeline-sexp)
src/graftwerk/routes/evaluate.clj:;(defn read-dataset-with-filename-meta
src/graftwerk/routes/evaluate.clj:;  "Returns an sexp that opens a dataset with read-dataset and sets the supplied
src/graftwerk/routes/evaluate.clj:;  [data-file filename]
src/graftwerk/routes/evaluate.clj:;  `(with-meta
src/graftwerk/routes/evaluate.clj:;     (grafter.tabular/read-dataset ~data-file :format :csv)
src/graftwerk/routes/evaluate.clj:;     {:grafter.tabular/data-source ~filename}))
src/graftwerk/routes/evaluate.clj:(defn evaluate-command [sandbox command data]
src/graftwerk/routes/evaluate.clj:  (let [apply-pipe (list command data)]
src/graftwerk/routes/evaluate.clj:    (log/info "About to apply pipe in sandbox" apply-pipe)
src/graftwerk/routes/evaluate.clj:    (sandbox apply-pipe)))
src/graftwerk/routes/evaluate.clj:(def default-page-size "50")
src/graftwerk/routes/evaluate.clj:(defn paginate-seq [results page-size page-number]
src/graftwerk/routes/evaluate.clj:  (if (and page-number (not (empty? page-number)))
src/graftwerk/routes/evaluate.clj:    (let [page-number (Integer/parseInt page-number)
src/graftwerk/routes/evaluate.clj:          page-size (Integer/parseInt (or page-size default-page-size))]
src/graftwerk/routes/evaluate.clj:      (log/info "Paging results " page-size " per page.  Page #" page-number)
src/graftwerk/routes/evaluate.clj:      (->>  results
src/graftwerk/routes/evaluate.clj:            (drop (* page-number page-size))
src/graftwerk/routes/evaluate.clj:            (take page-size)))
src/graftwerk/routes/evaluate.clj:  [ds page-size page-number]
src/graftwerk/routes/evaluate.clj:  (make-dataset (paginate-seq (:rows ds)
src/graftwerk/routes/evaluate.clj:                              page-size page-number)
src/graftwerk/routes/evaluate.clj:                (:column-names ds)))
src/graftwerk/routes/evaluate.clj:(defn read-pipeline
src/graftwerk/routes/evaluate.clj:  "Takes a ring style multi-part form map that contains a file reference to
src/graftwerk/routes/evaluate.clj:  a :tempfile, reads the s-expressions out of the file and returns it wrapped in
src/graftwerk/routes/evaluate.clj:  (let [code (-> pipeline :tempfile slurp)]
src/graftwerk/routes/evaluate.clj:    ;; read/read-string and safe-read only read one
src/graftwerk/routes/evaluate.clj:    (safe-read (str "(do "
src/graftwerk/routes/evaluate.clj:(defn- find-read-shape [pipeline shape-command]
src/graftwerk/routes/evaluate.clj:  "Checks whether the first transformation step's name is equal to expected shape-reading command"
src/graftwerk/routes/evaluate.clj:  (let [pipe (second (first (:body (first pipeline))))      ;; finds out the body of the pipeline form passed which contains the transformation steps. First value is (->) and second value leads to a list of commands.
src/graftwerk/routes/evaluate.clj:        is-shape-reader (= shape-command (name (first pipe)))] ;; check whether the name of the first symbol (assumed read-data always starts the pipeline) is equal to the command
src/graftwerk/routes/evaluate.clj:    is-shape-reader
src/graftwerk/routes/evaluate.clj:(defn- get-processable-input [ data pipeline-forms]
src/graftwerk/routes/evaluate.clj:  "Private function to determine \"sandbox-processeble\" input data"
src/graftwerk/routes/evaluate.clj:  (println "**********************pipeline-forms")
src/graftwerk/routes/evaluate.clj:    (let [is-shape-related (->
src/graftwerk/routes/evaluate.clj:                             pipeline-forms
src/graftwerk/routes/evaluate.clj:                             (pl/find-pipelines (namespace-symbol (namespace-declaration)) {})
src/graftwerk/routes/evaluate.clj:                             (find-read-shape "read-shape-csv")
src/graftwerk/routes/evaluate.clj:          temp-file-location (-> data :tempfile .getPath)   ;the default data
src/graftwerk/routes/evaluate.clj:          input-data (if (= true is-shape-related) (convert-shape temp-file-location) temp-file-location )
src/graftwerk/routes/evaluate.clj:      (log/info "Input data path" input-data)
src/graftwerk/routes/evaluate.clj:      input-data
src/graftwerk/routes/evaluate.clj:(defn execute-pipeline [data command pipeline]
src/graftwerk/routes/evaluate.clj:  (let [forms (read-pipeline pipeline)
src/graftwerk/routes/evaluate.clj:        ;data-file (-> data :tempfile .getPath)
src/graftwerk/routes/evaluate.clj:        data-file (get-processable-input data forms)
src/graftwerk/routes/evaluate.clj:        sandbox (build-sandbox forms data-file)]
src/graftwerk/routes/evaluate.clj:    (evaluate-command sandbox command data-file )))
src/graftwerk/routes/evaluate.clj:(defroutes pipe-route
src/graftwerk/routes/evaluate.clj:  (POST "/evaluate/pipe" {{:keys [pipeline data page-size page command] :as params} :params}
src/graftwerk/routes/evaluate.clj:        (if-invalid [errors (validate-pipe-run-request params)]
src/graftwerk/routes/evaluate.clj:                     {:status 200 :body (-> data
src/graftwerk/routes/evaluate.clj:                                            (execute-pipeline command pipeline)
src/graftwerk/routes/evaluate.clj:                                            (paginate page-size page))})))
src/graftwerk/routes/evaluate.clj:(defn find-graft [pipelines-seq name]
src/graftwerk/routes/evaluate.clj:  (if-let [graft (first (filter (fn [g]
src/graftwerk/routes/evaluate.clj:                                pipelines-seq))]
src/graftwerk/routes/evaluate.clj:(defn find-pipe-for-graft [pipeline-forms graft-command]
src/graftwerk/routes/evaluate.clj:  (let [graft-command (symbol graft-command)
src/graftwerk/routes/evaluate.clj:        namespace-name (namespace-symbol (namespace-declaration))
src/graftwerk/routes/evaluate.clj:        graft-comp (-> pipeline-forms
src/graftwerk/routes/evaluate.clj:                       (pl/find-pipelines namespace-name {})
src/graftwerk/routes/evaluate.clj:                       (find-graft graft-command)
src/graftwerk/routes/evaluate.clj:        pipe-sym (last graft-comp) ;; find pipe-command its the last '(comp .. .. pipe-command)]
src/graftwerk/routes/evaluate.clj:        template-sym (second graft-comp)]
src/graftwerk/routes/evaluate.clj:    [pipe-sym template-sym]))
src/graftwerk/routes/evaluate.clj:(defn preview-graft-with-row
src/graftwerk/routes/evaluate.clj:  "Returns a grafter.rdf.preview/preview-graph representation of a graft run,
src/graftwerk/routes/evaluate.clj:  when given a row a datafile a graft-command and a pipeline.
src/graftwerk/routes/evaluate.clj:  It will find the specified graft-command function in the supplied pipeline
src/graftwerk/routes/evaluate.clj:   {:keys [filename] data-file :tempfile :as data}
src/graftwerk/routes/evaluate.clj:   graft-command
src/graftwerk/routes/evaluate.clj:   render-constants?]
src/graftwerk/routes/evaluate.clj:  (let [graft-sym (symbol graft-command)
src/graftwerk/routes/evaluate.clj:        pipeline-forms (read-pipeline pipeline)
src/graftwerk/routes/evaluate.clj:        [pipe-sym template-sym] (find-pipe-for-graft pipeline-forms graft-sym)
src/graftwerk/routes/evaluate.clj:        data-file (get-processable-input data pipeline-forms)                                          ;(-> data-file .getCanonicalPath)
src/graftwerk/routes/evaluate.clj:        sandbox (build-sandbox pipeline-forms data-file)
src/graftwerk/routes/evaluate.clj:        executable-code-form `(grafter.rdf.preview/preview-graph (~pipe-sym ~data-file) ~template-sym ~row ~(if render-constants? :render-constants false))]
src/graftwerk/routes/evaluate.clj:    (log/info "code form is" executable-code-form)
src/graftwerk/routes/evaluate.clj:    (sandbox executable-code-form)))
src/graftwerk/routes/evaluate.clj:(defroutes graft-route
src/graftwerk/routes/evaluate.clj:        (if-invalid [errors (validate-graft-run-request params)]
src/graftwerk/routes/evaluate.clj:                    (if-let [row (and (not (blank? row)) (Integer/parseInt row))]
src/graftwerk/routes/evaluate.clj:                      {:status 200 :body (preview-graft-with-row row data command pipeline (if (= "on" constants)
src/graftwerk/routes/evaluate.clj:                      {:status 200 :body (execute-pipeline data command pipeline)}))))
src/graftwerk/routes/evaluate.clj:  (preview-graft-with-row 1 "/Users/rick/repos/grafter-template/resources/leiningen/new/grafter/example-data.csv" "my-graft" {:tempfile (clojure.java.io/file "/Users/rick/repos/graftwerk/test/data/example_pipeline.clj")} false)
src/graftwerk/shape/shape_support.clj:(ns graftwerk.shape.shape-support
src/graftwerk/shape/shape_support.clj:  (:require [ grafter.tabular.common :refer [read-dataset ]]
src/graftwerk/shape/shape_support.clj:(defn read-shape-csv [data-path]
src/graftwerk/shape/shape_support.clj:  (read-dataset data-path :format :csv :separator \;)
src/graftwerk/shape/shape_support.clj:(defn convert-shape [shape-path]
src/graftwerk/shape/shape_support.clj:  (let [zipFile (GeoShapeFromZip. shape-path)]
src/graftwerk/validations.clj:(defn try-convert [f]
src/graftwerk/validations.clj:(def try->integer (try-convert (fn [i]
src/graftwerk/validations.clj:(v/defvalidator empty-or-number {:optional true} [i]
src/graftwerk/validations.clj:    (try->integer i) true
src/graftwerk/validations.clj:(v/defvalidator clojure-content
src/graftwerk/validations.clj:  {:default-message-format "Content type of file is not application/clojure"}
src/graftwerk/validations.clj:  [mime-type]
src/graftwerk/validations.clj:  (= "application/clojure" mime-type))
src/graftwerk/validations.clj:(v/defvalidator tabular-file
src/graftwerk/validations.clj:  {:default-message-format "Content type of file is not application/csv"}
src/graftwerk/validations.clj:  [mime-type]
src/graftwerk/validations.clj:  (#{"application/csv"} mime-type))
src/graftwerk/validations.clj:(defn validate-pipe-run-request [params]
src/graftwerk/validations.clj:              :page empty-or-number
src/graftwerk/validations.clj:              :page-size empty-or-number
src/graftwerk/validations.clj:(defn validate-graft-run-request [params]
src/graftwerk/validations.clj:              :row empty-or-number
src/graftwerk/validations.clj:              ;;[:pipeline :content-type] clojure-content
src/graftwerk/validations.clj:              ;;[:data :content-type] tabular-file
src/graftwerk/validations.clj:(defn valid? [validation-result]
src/graftwerk/validations.clj:  (let [[errors data] validation-result]
src/graftwerk/validations.clj:(defmacro if-invalid
src/graftwerk/validations.clj:  "Like an if-let but with validation results."
src/graftwerk/validations.clj:  [[bound-var test-form] invalid-body valid-body]
src/graftwerk/validations.clj:  `(let [validation-result# ~test-form]
src/graftwerk/validations.clj:     (if-let [~bound-var (when (not (valid? validation-result#))
src/graftwerk/validations.clj:                           (first validation-result#))]
src/graftwerk/validations.clj:       ~invalid-body
src/graftwerk/validations.clj:       ~valid-body)))
target/stale/leiningen.core.classpath.extract-native-dependencies:[{:dependencies {org.openrdf.sesame/sesame-queryalgebra-model {:vsn "2.7.14", :native-prefix nil}, com.cognitect/transit-java {:vsn "0.8.257", :native-prefix nil}, selmer {:vsn "0.8.0", :native-prefix nil}, args4j {:vsn "2.0.26", :native-prefix nil}, org.clojure/data.json {:vsn "0.2.3", :native-prefix nil}, org.clojure/clojure {:vsn "1.6.0", :native-prefix nil}, com.ibm.icu/icu4j {:vsn "53.1", :native-prefix nil}, bultitude {:vsn "0.1.6", :native-prefix nil}, org.ccil.cowan.tagsoup/tagsoup {:vsn "1.2.1", :native-prefix nil}, junit {:vsn "4.8.2", :native-prefix nil}, org.openrdf.sesame/sesame-runtime {:vsn "2.7.14", :native-prefix nil}, org.apache.poi/poi {:vsn "3.9", :native-prefix nil}, org.apache.commons/commons-compress {:vsn "1.8", :native-prefix nil}, ring/ring-devel {:vsn "1.3.2", :native-prefix nil}, org.openrdf.sesame/sesame-sail-inferencer {:vsn "2.7.14", :native-prefix nil}, grafter/vocabularies {:vsn "0.1.0", :native-prefix nil}, org.clojure/tools.logging {:vsn "0.3.1", :native-prefix nil}, org.tukaani/xz {:vsn "1.5", :native-prefix nil}, ns-tracker {:vsn "0.2.2", :native-prefix nil}, net.sourceforge.jtransforms/jtransforms {:vsn "2.4.0", :native-prefix nil}, org.openrdf.sesame/sesame-queryresultio-api {:vsn "2.7.14", :native-prefix nil}, com.googlecode.efficient-java-matrix-library/core {:vsn "0.26", :native-prefix nil}, com.vividsolutions/jts {:vsn "1.13", :native-prefix nil}, org.apache.poi/poi-ooxml-schemas {:vsn "3.9", :native-prefix nil}, com.fasterxml.jackson.core/jackson-databind {:vsn "2.3.2", :native-prefix nil}, clj-stacktrace {:vsn "0.2.8", :native-prefix nil}, bouncer {:vsn "0.3.2", :native-prefix nil}, org.openrdf.sesame/sesame-queryresultio-binary {:vsn "2.7.14", :native-prefix nil}, clj-time {:vsn "0.7.0", :native-prefix nil}, ring/ring-ssl {:vsn "0.2.1", :native-prefix nil}, crypto-random {:vsn "1.2.0", :native-prefix nil}, net.sourceforge.parallelcolt/optimization {:vsn "1.0", :native-prefix nil}, org.openrdf.sesame/sesame-http-protocol {:vsn "2.7.14", :native-prefix nil}, org.openrdf.sesame/sesame-rio-trix {:vsn "2.7.14", :native-prefix nil}, org.eclipse.jetty/jetty-http {:vsn "7.6.8.v20121106", :native-prefix nil}, org.eclipse.jetty/jetty-util {:vsn "7.6.8.v20121106", :native-prefix nil}, com.taoensso/encore {:vsn "1.37.0", :native-prefix nil}, org.openrdf.sesame/sesame-sail-nativerdf {:vsn "2.7.14", :native-prefix nil}, javax.media/jai_core {:vsn "1.1.3", :native-prefix nil}, org.openrdf.sesame/sesame-http-client {:vsn "2.7.14", :native-prefix nil}, org.openrdf.sesame/sesame-rio-rdfjson {:vsn "2.7.14", :native-prefix nil}, compojure {:vsn "1.3.2", :native-prefix nil}, org.openrdf.sesame/sesame-repository-sail {:vsn "2.7.14", :native-prefix nil}, riddley {:vsn "0.1.7", :native-prefix nil}, commons-fileupload {:vsn "1.3", :native-prefix nil}, net.sourceforge.csparsej/csparsej {:vsn "1.1.1", :native-prefix nil}, org.apache.directory.studio/org.apache.commons.codec {:vsn "1.8", :native-prefix nil}, com.googlecode.netlib-java/netlib-java {:vsn "0.9.3", :native-prefix nil}, org.apache.tika/tika-core {:vsn "1.7", :native-prefix nil}, prone {:vsn "0.8.0", :native-prefix nil}, org.clojure/tools.macro {:vsn "0.1.5", :native-prefix nil}, com.fasterxml.jackson.dataformat/jackson-dataformat-cbor {:vsn "2.4.4", :native-prefix nil}, org.flatland/useful {:vsn "0.9.3", :native-prefix nil}, org.openrdf.sesame/sesame-rio-trig {:vsn "2.7.14", :native-prefix nil}, com.googlecode.json-simple/json-simple {:vsn "1.1.1", :native-prefix nil}, org.eclipse.jetty/jetty-continuation {:vsn "7.6.8.v20121106", :native-prefix nil}, ring/ring-defaults {:vsn "0.1.3", :native-prefix nil}, environ {:vsn "1.0.0", :native-prefix nil}, org.openrdf.sesame/sesame-rio-nquads {:vsn "2.7.14", :native-prefix nil}, org.clojure/google-closure-library {:vsn "0.0-20140718-946a7d39", :native-prefix nil}, io.aviso/pretty {:vsn "0.1.18", :native-prefix nil}, org.openrdf.sesame/sesame-rio-rdfxml {:vsn "2.7.14", :native-prefix nil}, ring/ring-session-timeout {:vsn "0.1.0", :native-prefix nil}, serializable-fn {:vsn "1.1.3", :native-prefix nil}, stax/stax-api {:vsn "1.0.1", :native-prefix nil}, org.openrdf.sesame/sesame-rio-ntriples {:vsn "2.7.14", :native-prefix nil}, org.clojure/clojurescript {:vsn "0.0-2511", :native-prefix nil}, incanter/incanter-core {:vsn "1.5.5", :native-prefix nil}, ring/ring-jetty-adapter {:vsn "1.2.1", :native-prefix nil}, org.openrdf.sesame/sesame-rio-api {:vsn "2.7.14", :native-prefix nil}, net.sourceforge.jplasma/core-lapack {:vsn "0.1", :native-prefix nil}, org.openrdf.sesame/sesame-queryresultio-sparqljson {:vsn "2.7.14", :native-prefix nil}, org.openrdf.sesame/sesame-query {:vsn "2.7.14", :native-prefix nil}, ring-refresh {:vsn "0.1.2", :native-prefix nil}, medley {:vsn "0.5.5", :native-prefix nil}, org.clojure/tools.namespace {:vsn "0.2.4", :native-prefix nil}, org.openrdf.sesame/sesame-queryalgebra-evaluation {:vsn "2.7.14", :native-prefix nil}, net.java.dev.jsr-275/jsr-275 {:vsn "1.0-beta-2", :native-prefix nil}, com.outpace/clj-excel {:vsn "0.0.6", :native-prefix nil}, org.openrdf.sesame/sesame-rio-languages {:vsn "2.7.14", :native-prefix nil}, com.github.rwl/BTFJ {:vsn "1.0.1", :native-prefix nil}, dom4j {:vsn "1.6.1", :native-prefix nil}, com.fasterxml.jackson.core/jackson-core {:vsn "2.4.4", :native-prefix nil}, com.github.rwl/COLAMDJ {:vsn "1.0.1", :native-prefix nil}, slingshot {:vsn "0.10.3", :native-prefix nil}, ww-geo-coords {:vsn "1.0", :native-prefix nil}, org.yaml/snakeyaml {:vsn "1.5", :native-prefix nil}, ring-mock {:vsn "0.1.5", :native-prefix nil}, org.openrdf.sesame/sesame-repository-http {:vsn "2.7.14", :native-prefix nil}, clojail {:vsn "1.0.6", :native-prefix nil}, ring {:vsn "1.2.1", :native-prefix nil}, cheshire {:vsn "5.4.0", :native-prefix nil}, org.geotools/gt-metadata {:vsn "15.1", :native-prefix nil}, markdown-clj {:vsn "0.9.54", :native-prefix nil}, org.slf4j/slf4j-simple {:vsn "1.6.1", :native-prefix nil}, grafter/url {:vsn "0.2.0", :native-prefix nil}, potemkin {:vsn "0.3.11", :native-prefix nil}, watchtower {:vsn "0.1.1", :native-prefix nil}, org.openrdf.sesame/sesame-sail-rdbms {:vsn "2.7.14", :native-prefix nil}, org.openrdf.sesame/sesame-queryparser-api {:vsn "2.7.14", :native-prefix nil}, org.geotools/gt-data {:vsn "15.1", :native-prefix nil}, org.geotools/gt-shapefile {:vsn "15.1", :native-prefix nil}, org.mozilla/rhino {:vsn "1.7R4", :native-prefix nil}, com.taoensso/tower {:vsn "3.0.2", :native-prefix nil}, crypto-equality {:vsn "1.0.0", :native-prefix nil}, ring/ring-headers {:vsn "0.1.1", :native-prefix nil}, org.clojure/google-closure-library-third-party {:vsn "0.0-20140718-946a7d39", :native-prefix nil}, clj-yaml {:vsn "0.4.0", :native-prefix nil}, datagraft/geo-converter {:vsn "0.0.1-SNAPSHOT", :native-prefix nil}, org.openrdf.sesame/sesame-sail-memory {:vsn "2.7.14", :native-prefix nil}, com.fasterxml.jackson.core/jackson-annotations {:vsn "2.3.0", :native-prefix nil}, pjstadig/humane-test-output {:vsn "0.6.0", :native-prefix nil}, org.openrdf.sesame/sesame-model {:vsn "2.7.14", :native-prefix nil}, org.apache.xmlbeans/xmlbeans {:vsn "2.3.0", :native-prefix nil}, org.jblas/jblas {:vsn "1.2.3", :native-prefix nil}, org.apache.poi/poi-ooxml {:vsn "3.9", :native-prefix nil}, org.openrdf.sesame/sesame-util {:vsn "2.7.14", :native-prefix nil}, com.google.javascript/closure-compiler-externs {:vsn "v20140625", :native-prefix nil}, org.javassist/javassist {:vsn "3.18.1-GA", :native-prefix nil}, org.clojure/java.classpath {:vsn "0.2.2", :native-prefix nil}, net.sf.geographiclib/GeographicLib-Java {:vsn "1.44", :native-prefix nil}, org.clojure/tools.nrepl {:vsn "0.2.12", :native-prefix nil}, commons-codec {:vsn "1.10", :native-prefix nil}, clojure-complete {:vsn "0.2.4", :native-prefix nil}, org.openrdf.sesame/sesame-queryparser-sparql {:vsn "2.7.14", :native-prefix nil}, com.google.guava/guava {:vsn "17.0", :native-prefix nil}, com.github.rwl/JKLU {:vsn "1.0.0", :native-prefix nil}, json-html {:vsn "0.2.0", :native-prefix nil}, org.openrdf.sesame/sesame-rio-turtle {:vsn "2.7.14", :native-prefix nil}, grafter {:vsn "0.5.0", :native-prefix nil}, net.sf.opencsv/opencsv {:vsn "2.0", :native-prefix nil}, org.msgpack/msgpack {:vsn "0.6.10", :native-prefix nil}, commons-logging {:vsn "1.1.1", :native-prefix nil}, org.openrdf.sesame/sesame-repository-contextaware {:vsn "2.7.14", :native-prefix nil}, org.clojure/data.csv {:vsn "0.1.2", :native-prefix nil}, com.taoensso/timbre {:vsn "4.0.1", :native-prefix nil}, com.cognitect/transit-clj {:vsn "0.8.247", :native-prefix nil}, hiccup {:vsn "1.0.5", :native-prefix nil}, com.google.javascript/closure-compiler {:vsn "v20140625", :native-prefix nil}, org.clojure/algo.monads {:vsn "0.1.5", :native-prefix nil}, org.openrdf.sesame/sesame-rio-n3 {:vsn "2.7.14", :native-prefix nil}, ring/ring-codec {:vsn "1.0.0", :native-prefix nil}, com.sun/tools {:vsn "1.5", :native-prefix nil}, com.cemerick/piggieback {:vsn "0.1.3", :native-prefix nil}, ring/ring-anti-forgery {:vsn "1.0.0", :native-prefix nil}, prismatic/schema {:vsn "0.4.3", :native-prefix nil}, commons-httpclient {:vsn "3.1", :native-prefix nil}, instaparse {:vsn "1.3.4", :native-prefix nil}, org.clojure/math.combinatorics {:vsn "0.0.4", :native-prefix nil}, clout {:vsn "2.1.0", :native-prefix nil}, org.openrdf.sesame/sesame-repository-api {:vsn "2.7.14", :native-prefix nil}, net.mikera/core.matrix {:vsn "0.7.2", :native-prefix nil}, com.fasterxml.jackson.datatype/jackson-datatype-json-org {:vsn "2.3.2", :native-prefix nil}, ring-server {:vsn "0.3.1", :native-prefix nil}, com.andrewmcveigh/cljs-time {:vsn "0.3.0", :native-prefix nil}, org.clojure/core.incubator {:vsn "0.1.0", :native-prefix nil}, com.cemerick/austin {:vsn "0.1.5", :native-prefix nil}, org.eclipse.jetty/jetty-io {:vsn "7.6.8.v20121106", :native-prefix nil}, enlive {:vsn "1.1.5", :native-prefix nil}, org.geotools/gt-opengis {:vsn "15.1", :native-prefix nil}, org.clojure/tools.reader {:vsn "0.8.5", :native-prefix nil}, net.sourceforge.jplasma/jplasma {:vsn "1.2.0", :native-prefix nil}, joda-time {:vsn "2.7", :native-prefix nil}, org.geotools/gt-referencing {:vsn "15.1", :native-prefix nil}, org.openrdf.sesame/sesame-queryresultio-sparqlxml {:vsn "2.7.14", :native-prefix nil}, org.eclipse.jetty.orbit/javax.servlet {:vsn "2.5.0.v201103041518", :native-prefix nil}, grafterizer/tabular_functions {:vsn "0.1.2", :native-prefix nil}, tigris {:vsn "0.1.1", :native-prefix nil}, net.sf.corn/corn-cps {:vsn "1.1.7", :native-prefix nil}, jgridshift {:vsn "1.0", :native-prefix nil}, javax.servlet/servlet-api {:vsn "2.5", :native-prefix nil}, org.jsoup/jsoup {:vsn "1.7.2", :native-prefix nil}, com.github.rwl/AMDJ {:vsn "1.0.1", :native-prefix nil}, org.openrdf.sesame/sesame-queryparser-serql {:vsn "2.7.14", :native-prefix nil}, net.sourceforge.parallelcolt/parallelcolt {:vsn "0.10.1", :native-prefix nil}, org.openrdf.sesame/sesame-sail-api {:vsn "2.7.14", :native-prefix nil}, org.slf4j/slf4j-api {:vsn "1.6.1", :native-prefix nil}, org.openrdf.sesame/sesame-repository-sparql {:vsn "2.7.14", :native-prefix nil}, clatrix {:vsn "0.3.0", :native-prefix nil}, me.raynes/fs {:vsn "1.4.6", :native-prefix nil}, clj-tuple {:vsn "0.1.7", :native-prefix nil}, xml-apis {:vsn "1.0.b2", :native-prefix nil}, com.google.protobuf/protobuf-java {:vsn "2.5.0", :native-prefix nil}, org.openrdf.sesame/sesame-queryresultio-text {:vsn "2.7.14", :native-prefix nil}, ring/ring-servlet {:vsn "1.2.1", :native-prefix nil}, org.geotools/gt-api {:vsn "15.1", :native-prefix nil}, org.clojure/core.memoize {:vsn "0.5.6", :native-prefix nil}, org.geotools/gt-main {:vsn "15.1", :native-prefix nil}, org.slf4j/slf4j-jdk14 {:vsn "1.7.5", :native-prefix nil}, commons-dbcp {:vsn "1.3", :native-prefix nil}, org.openrdf.sesame/sesame-sail-federation {:vsn "2.7.14", :native-prefix nil}, org.clojure/data.priority-map {:vsn "0.0.2", :native-prefix nil}, org.eclipse.jetty/jetty-server {:vsn "7.6.8.v20121106", :native-prefix nil}, net.sourceforge.f2j/arpack_combined_all {:vsn "0.1", :native-prefix nil}, commons-io {:vsn "2.4", :native-prefix nil}, com.google.code.findbugs/jsr305 {:vsn "1.3.9", :native-prefix nil}, noir-exception {:vsn "0.2.3", :native-prefix nil}, ring/ring-core {:vsn "1.3.2", :native-prefix nil}, org.clojure/core.cache {:vsn "0.6.3", :native-prefix nil}, ring-middleware-format {:vsn "0.4.0", :native-prefix nil}, org.openrdf.sesame/sesame-rio-binary {:vsn "2.7.14", :native-prefix nil}, com.novemberain/pantomime {:vsn "2.4.0", :native-prefix nil}, com.fasterxml.jackson.dataformat/jackson-dataformat-smile {:vsn "2.4.4", :native-prefix nil}, org.jdom/jdom {:vsn "1.1.3", :native-prefix nil}, org.openrdf.sesame/sesame-rio-datatypes {:vsn "2.7.14", :native-prefix nil}, org.json/json {:vsn "20090211", :native-prefix nil}, commons-pool {:vsn "1.5.4", :native-prefix nil}, org.openrdf.sesame/sesame-repository-dataset {:vsn "2.7.14", :native-prefix nil}}, :native-path "target/native"} {:native-path "target/native", :dependencies {org.openrdf.sesame/sesame-queryalgebra-model {:vsn "2.7.14", :native-prefix nil, :native? false}, com.cognitect/transit-java {:vsn "0.8.257", :native-prefix nil, :native? false}, selmer {:vsn "0.8.0", :native-prefix nil, :native? false}, args4j {:vsn "2.0.26", :native-prefix nil, :native? false}, org.clojure/data.json {:vsn "0.2.3", :native-prefix nil, :native? false}, org.clojure/clojure {:vsn "1.6.0", :native-prefix nil, :native? false}, com.ibm.icu/icu4j {:vsn "53.1", :native-prefix nil, :native? false}, bultitude {:vsn "0.1.6", :native-prefix nil, :native? false}, org.ccil.cowan.tagsoup/tagsoup {:vsn "1.2.1", :native-prefix nil, :native? false}, junit {:vsn "4.8.2", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-runtime {:vsn "2.7.14", :native-prefix nil, :native? false}, org.apache.poi/poi {:vsn "3.9", :native-prefix nil, :native? false}, org.apache.commons/commons-compress {:vsn "1.8", :native-prefix nil, :native? false}, ring/ring-devel {:vsn "1.3.2", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-sail-inferencer {:vsn "2.7.14", :native-prefix nil, :native? false}, grafter/vocabularies {:vsn "0.1.0", :native-prefix nil, :native? false}, org.clojure/tools.logging {:vsn "0.3.1", :native-prefix nil, :native? false}, org.tukaani/xz {:vsn "1.5", :native-prefix nil, :native? false}, ns-tracker {:vsn "0.2.2", :native-prefix nil, :native? false}, net.sourceforge.jtransforms/jtransforms {:vsn "2.4.0", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-queryresultio-api {:vsn "2.7.14", :native-prefix nil, :native? false}, com.googlecode.efficient-java-matrix-library/core {:vsn "0.26", :native-prefix nil, :native? false}, com.vividsolutions/jts {:vsn "1.13", :native-prefix nil, :native? false}, org.apache.poi/poi-ooxml-schemas {:vsn "3.9", :native-prefix nil, :native? false}, com.fasterxml.jackson.core/jackson-databind {:vsn "2.3.2", :native-prefix nil, :native? false}, clj-stacktrace {:vsn "0.2.8", :native-prefix nil, :native? false}, bouncer {:vsn "0.3.2", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-queryresultio-binary {:vsn "2.7.14", :native-prefix nil, :native? false}, clj-time {:vsn "0.7.0", :native-prefix nil, :native? false}, ring/ring-ssl {:vsn "0.2.1", :native-prefix nil, :native? false}, crypto-random {:vsn "1.2.0", :native-prefix nil, :native? false}, net.sourceforge.parallelcolt/optimization {:vsn "1.0", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-http-protocol {:vsn "2.7.14", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-trix {:vsn "2.7.14", :native-prefix nil, :native? false}, org.eclipse.jetty/jetty-http {:vsn "7.6.8.v20121106", :native-prefix nil, :native? false}, org.eclipse.jetty/jetty-util {:vsn "7.6.8.v20121106", :native-prefix nil, :native? false}, com.taoensso/encore {:vsn "1.37.0", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-sail-nativerdf {:vsn "2.7.14", :native-prefix nil, :native? false}, javax.media/jai_core {:vsn "1.1.3", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-http-client {:vsn "2.7.14", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-rdfjson {:vsn "2.7.14", :native-prefix nil, :native? false}, compojure {:vsn "1.3.2", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-repository-sail {:vsn "2.7.14", :native-prefix nil, :native? false}, riddley {:vsn "0.1.7", :native-prefix nil, :native? false}, commons-fileupload {:vsn "1.3", :native-prefix nil, :native? false}, net.sourceforge.csparsej/csparsej {:vsn "1.1.1", :native-prefix nil, :native? false}, org.apache.directory.studio/org.apache.commons.codec {:vsn "1.8", :native-prefix nil, :native? false}, com.googlecode.netlib-java/netlib-java {:vsn "0.9.3", :native-prefix nil, :native? false}, org.apache.tika/tika-core {:vsn "1.7", :native-prefix nil, :native? false}, prone {:vsn "0.8.0", :native-prefix nil, :native? false}, org.clojure/tools.macro {:vsn "0.1.5", :native-prefix nil, :native? false}, com.fasterxml.jackson.dataformat/jackson-dataformat-cbor {:vsn "2.4.4", :native-prefix nil, :native? false}, org.flatland/useful {:vsn "0.9.3", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-trig {:vsn "2.7.14", :native-prefix nil, :native? false}, com.googlecode.json-simple/json-simple {:vsn "1.1.1", :native-prefix nil, :native? false}, org.eclipse.jetty/jetty-continuation {:vsn "7.6.8.v20121106", :native-prefix nil, :native? false}, ring/ring-defaults {:vsn "0.1.3", :native-prefix nil, :native? false}, environ {:vsn "1.0.0", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-nquads {:vsn "2.7.14", :native-prefix nil, :native? false}, org.clojure/google-closure-library {:vsn "0.0-20140718-946a7d39", :native-prefix nil, :native? false}, io.aviso/pretty {:vsn "0.1.18", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-rdfxml {:vsn "2.7.14", :native-prefix nil, :native? false}, ring/ring-session-timeout {:vsn "0.1.0", :native-prefix nil, :native? false}, serializable-fn {:vsn "1.1.3", :native-prefix nil, :native? false}, stax/stax-api {:vsn "1.0.1", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-ntriples {:vsn "2.7.14", :native-prefix nil, :native? false}, org.clojure/clojurescript {:vsn "0.0-2511", :native-prefix nil, :native? false}, incanter/incanter-core {:vsn "1.5.5", :native-prefix nil, :native? false}, ring/ring-jetty-adapter {:vsn "1.2.1", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-api {:vsn "2.7.14", :native-prefix nil, :native? false}, net.sourceforge.jplasma/core-lapack {:vsn "0.1", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-queryresultio-sparqljson {:vsn "2.7.14", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-query {:vsn "2.7.14", :native-prefix nil, :native? false}, ring-refresh {:vsn "0.1.2", :native-prefix nil, :native? false}, medley {:vsn "0.5.5", :native-prefix nil, :native? false}, org.clojure/tools.namespace {:vsn "0.2.4", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-queryalgebra-evaluation {:vsn "2.7.14", :native-prefix nil, :native? false}, net.java.dev.jsr-275/jsr-275 {:vsn "1.0-beta-2", :native-prefix nil, :native? false}, com.outpace/clj-excel {:vsn "0.0.6", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-languages {:vsn "2.7.14", :native-prefix nil, :native? false}, com.github.rwl/BTFJ {:vsn "1.0.1", :native-prefix nil, :native? false}, dom4j {:vsn "1.6.1", :native-prefix nil, :native? false}, com.fasterxml.jackson.core/jackson-core {:vsn "2.4.4", :native-prefix nil, :native? false}, com.github.rwl/COLAMDJ {:vsn "1.0.1", :native-prefix nil, :native? false}, slingshot {:vsn "0.10.3", :native-prefix nil, :native? false}, ww-geo-coords {:vsn "1.0", :native-prefix nil, :native? false}, org.yaml/snakeyaml {:vsn "1.5", :native-prefix nil, :native? false}, ring-mock {:vsn "0.1.5", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-repository-http {:vsn "2.7.14", :native-prefix nil, :native? false}, clojail {:vsn "1.0.6", :native-prefix nil, :native? false}, ring {:vsn "1.2.1", :native-prefix nil, :native? false}, cheshire {:vsn "5.4.0", :native-prefix nil, :native? false}, org.geotools/gt-metadata {:vsn "15.1", :native-prefix nil, :native? false}, markdown-clj {:vsn "0.9.54", :native-prefix nil, :native? false}, org.slf4j/slf4j-simple {:vsn "1.6.1", :native-prefix nil, :native? false}, grafter/url {:vsn "0.2.0", :native-prefix nil, :native? false}, potemkin {:vsn "0.3.11", :native-prefix nil, :native? false}, watchtower {:vsn "0.1.1", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-sail-rdbms {:vsn "2.7.14", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-queryparser-api {:vsn "2.7.14", :native-prefix nil, :native? false}, org.geotools/gt-data {:vsn "15.1", :native-prefix nil, :native? false}, org.geotools/gt-shapefile {:vsn "15.1", :native-prefix nil, :native? false}, org.mozilla/rhino {:vsn "1.7R4", :native-prefix nil, :native? false}, com.taoensso/tower {:vsn "3.0.2", :native-prefix nil, :native? false}, crypto-equality {:vsn "1.0.0", :native-prefix nil, :native? false}, ring/ring-headers {:vsn "0.1.1", :native-prefix nil, :native? false}, org.clojure/google-closure-library-third-party {:vsn "0.0-20140718-946a7d39", :native-prefix nil, :native? false}, clj-yaml {:vsn "0.4.0", :native-prefix nil, :native? false}, datagraft/geo-converter {:vsn "0.0.1-SNAPSHOT", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-sail-memory {:vsn "2.7.14", :native-prefix nil, :native? false}, com.fasterxml.jackson.core/jackson-annotations {:vsn "2.3.0", :native-prefix nil, :native? false}, pjstadig/humane-test-output {:vsn "0.6.0", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-model {:vsn "2.7.14", :native-prefix nil, :native? false}, org.apache.xmlbeans/xmlbeans {:vsn "2.3.0", :native-prefix nil, :native? false}, org.jblas/jblas {:vsn "1.2.3", :native-prefix nil, :native? false}, org.apache.poi/poi-ooxml {:vsn "3.9", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-util {:vsn "2.7.14", :native-prefix nil, :native? false}, com.google.javascript/closure-compiler-externs {:vsn "v20140625", :native-prefix nil, :native? false}, org.javassist/javassist {:vsn "3.18.1-GA", :native-prefix nil, :native? false}, org.clojure/java.classpath {:vsn "0.2.2", :native-prefix nil, :native? false}, net.sf.geographiclib/GeographicLib-Java {:vsn "1.44", :native-prefix nil, :native? false}, org.clojure/tools.nrepl {:vsn "0.2.12", :native-prefix nil, :native? false}, commons-codec {:vsn "1.10", :native-prefix nil, :native? false}, clojure-complete {:vsn "0.2.4", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-queryparser-sparql {:vsn "2.7.14", :native-prefix nil, :native? false}, com.google.guava/guava {:vsn "17.0", :native-prefix nil, :native? false}, com.github.rwl/JKLU {:vsn "1.0.0", :native-prefix nil, :native? false}, json-html {:vsn "0.2.0", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-turtle {:vsn "2.7.14", :native-prefix nil, :native? false}, grafter {:vsn "0.5.0", :native-prefix nil, :native? false}, net.sf.opencsv/opencsv {:vsn "2.0", :native-prefix nil, :native? false}, org.msgpack/msgpack {:vsn "0.6.10", :native-prefix nil, :native? false}, commons-logging {:vsn "1.1.1", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-repository-contextaware {:vsn "2.7.14", :native-prefix nil, :native? false}, org.clojure/data.csv {:vsn "0.1.2", :native-prefix nil, :native? false}, com.taoensso/timbre {:vsn "4.0.1", :native-prefix nil, :native? false}, com.cognitect/transit-clj {:vsn "0.8.247", :native-prefix nil, :native? false}, hiccup {:vsn "1.0.5", :native-prefix nil, :native? false}, com.google.javascript/closure-compiler {:vsn "v20140625", :native-prefix nil, :native? false}, org.clojure/algo.monads {:vsn "0.1.5", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-n3 {:vsn "2.7.14", :native-prefix nil, :native? false}, ring/ring-codec {:vsn "1.0.0", :native-prefix nil, :native? false}, com.sun/tools {:vsn "1.5", :native-prefix nil, :native? false}, com.cemerick/piggieback {:vsn "0.1.3", :native-prefix nil, :native? false}, ring/ring-anti-forgery {:vsn "1.0.0", :native-prefix nil, :native? false}, prismatic/schema {:vsn "0.4.3", :native-prefix nil, :native? false}, commons-httpclient {:vsn "3.1", :native-prefix nil, :native? false}, instaparse {:vsn "1.3.4", :native-prefix nil, :native? false}, org.clojure/math.combinatorics {:vsn "0.0.4", :native-prefix nil, :native? false}, clout {:vsn "2.1.0", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-repository-api {:vsn "2.7.14", :native-prefix nil, :native? false}, net.mikera/core.matrix {:vsn "0.7.2", :native-prefix nil, :native? false}, com.fasterxml.jackson.datatype/jackson-datatype-json-org {:vsn "2.3.2", :native-prefix nil, :native? false}, ring-server {:vsn "0.3.1", :native-prefix nil, :native? false}, com.andrewmcveigh/cljs-time {:vsn "0.3.0", :native-prefix nil, :native? false}, org.clojure/core.incubator {:vsn "0.1.0", :native-prefix nil, :native? false}, com.cemerick/austin {:vsn "0.1.5", :native-prefix nil, :native? false}, org.eclipse.jetty/jetty-io {:vsn "7.6.8.v20121106", :native-prefix nil, :native? false}, enlive {:vsn "1.1.5", :native-prefix nil, :native? false}, org.geotools/gt-opengis {:vsn "15.1", :native-prefix nil, :native? false}, org.clojure/tools.reader {:vsn "0.8.5", :native-prefix nil, :native? false}, net.sourceforge.jplasma/jplasma {:vsn "1.2.0", :native-prefix nil, :native? false}, joda-time {:vsn "2.7", :native-prefix nil, :native? false}, org.geotools/gt-referencing {:vsn "15.1", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-queryresultio-sparqlxml {:vsn "2.7.14", :native-prefix nil, :native? false}, org.eclipse.jetty.orbit/javax.servlet {:vsn "2.5.0.v201103041518", :native-prefix nil, :native? false}, grafterizer/tabular_functions {:vsn "0.1.2", :native-prefix nil, :native? false}, tigris {:vsn "0.1.1", :native-prefix nil, :native? false}, net.sf.corn/corn-cps {:vsn "1.1.7", :native-prefix nil, :native? false}, jgridshift {:vsn "1.0", :native-prefix nil, :native? false}, javax.servlet/servlet-api {:vsn "2.5", :native-prefix nil, :native? false}, org.jsoup/jsoup {:vsn "1.7.2", :native-prefix nil, :native? false}, com.github.rwl/AMDJ {:vsn "1.0.1", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-queryparser-serql {:vsn "2.7.14", :native-prefix nil, :native? false}, net.sourceforge.parallelcolt/parallelcolt {:vsn "0.10.1", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-sail-api {:vsn "2.7.14", :native-prefix nil, :native? false}, org.slf4j/slf4j-api {:vsn "1.6.1", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-repository-sparql {:vsn "2.7.14", :native-prefix nil, :native? false}, clatrix {:vsn "0.3.0", :native-prefix nil, :native? false}, me.raynes/fs {:vsn "1.4.6", :native-prefix nil, :native? false}, clj-tuple {:vsn "0.1.7", :native-prefix nil, :native? false}, xml-apis {:vsn "1.0.b2", :native-prefix nil, :native? false}, com.google.protobuf/protobuf-java {:vsn "2.5.0", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-queryresultio-text {:vsn "2.7.14", :native-prefix nil, :native? false}, ring/ring-servlet {:vsn "1.2.1", :native-prefix nil, :native? false}, org.geotools/gt-api {:vsn "15.1", :native-prefix nil, :native? false}, org.clojure/core.memoize {:vsn "0.5.6", :native-prefix nil, :native? false}, org.geotools/gt-main {:vsn "15.1", :native-prefix nil, :native? false}, org.slf4j/slf4j-jdk14 {:vsn "1.7.5", :native-prefix nil, :native? false}, commons-dbcp {:vsn "1.3", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-sail-federation {:vsn "2.7.14", :native-prefix nil, :native? false}, org.clojure/data.priority-map {:vsn "0.0.2", :native-prefix nil, :native? false}, org.eclipse.jetty/jetty-server {:vsn "7.6.8.v20121106", :native-prefix nil, :native? false}, net.sourceforge.f2j/arpack_combined_all {:vsn "0.1", :native-prefix nil, :native? false}, commons-io {:vsn "2.4", :native-prefix nil, :native? false}, com.google.code.findbugs/jsr305 {:vsn "1.3.9", :native-prefix nil, :native? false}, noir-exception {:vsn "0.2.3", :native-prefix nil, :native? false}, ring/ring-core {:vsn "1.3.2", :native-prefix nil, :native? false}, org.clojure/core.cache {:vsn "0.6.3", :native-prefix nil, :native? false}, ring-middleware-format {:vsn "0.4.0", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-binary {:vsn "2.7.14", :native-prefix nil, :native? false}, com.novemberain/pantomime {:vsn "2.4.0", :native-prefix nil, :native? false}, com.fasterxml.jackson.dataformat/jackson-dataformat-smile {:vsn "2.4.4", :native-prefix nil, :native? false}, org.jdom/jdom {:vsn "1.1.3", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-rio-datatypes {:vsn "2.7.14", :native-prefix nil, :native? false}, org.json/json {:vsn "20090211", :native-prefix nil, :native? false}, commons-pool {:vsn "1.5.4", :native-prefix nil, :native? false}, org.openrdf.sesame/sesame-repository-dataset {:vsn "2.7.14", :native-prefix nil, :native? false}}}]
test/data/example_pipeline.clj:(defn ->integer
test/data/example_pipeline.clj:(def base-domain (prefixer "http://my-domain.com"))
test/data/example_pipeline.clj:(def base-graph (prefixer (base-domain "/graph/")))
test/data/example_pipeline.clj:(def base-id (prefixer (base-domain "/id/")))
test/data/example_pipeline.clj:(def base-vocab (prefixer (base-domain "/def/")))
test/data/example_pipeline.clj:(def base-data (prefixer (base-domain "/data/")))
test/data/example_pipeline.clj:(def make-graph
test/data/example_pipeline.clj:  (graph-fn [{:keys [name sex age person-uri gender]}]
test/data/example_pipeline.clj:            (graph (base-graph "example")
test/data/example_pipeline.clj:                   [person-uri
test/data/example_pipeline.clj:(defpipe my-pipe
test/data/example_pipeline.clj:  [data-file]
test/data/example_pipeline.clj:  (-> (read-dataset data-file :format :csv)
test/data/example_pipeline.clj:      (drop-rows 1)
test/data/example_pipeline.clj:      (make-dataset [:name :sex :age])
test/data/example_pipeline.clj:      (derive-column :person-uri [:name] base-id)
test/data/example_pipeline.clj:      (mapc {:age ->integer
test/data/example_pipeline.clj:(defgraft my-graft
test/data/example_pipeline.clj:  my-pipe make-graph)
test/data/haxor_pipeline.clj:(def make-graph
test/data/haxor_pipeline.clj:  (graph-fn [{:keys [foo bar baz]}]))
test/data/haxor_pipeline.clj:(defpipe haxorz-teh-syst3mz
test/data/haxor_pipeline.clj:  [data-file]
test/data/haxor_pipeline.clj:(defgraft my-graft
test/data/haxor_pipeline.clj:  haxorz-teh-syst3mz make-graph)
test/data/identity.clj:(defpipe my-pipe [ds]
test/data/non_printable_results.clj:(defn ->integer
test/data/non_printable_results.clj:(def base-domain (prefixer "http://my-domain.com"))
test/data/non_printable_results.clj:(def base-graph (prefixer (base-domain "/graph/")))
test/data/non_printable_results.clj:(def base-id (prefixer (base-domain "/id/")))
test/data/non_printable_results.clj:(def base-vocab (prefixer (base-domain "/def/")))
test/data/non_printable_results.clj:(def base-data (prefixer (base-domain "/data/")))
test/data/non_printable_results.clj:(def make-graph
test/data/non_printable_results.clj:  (graph-fn [{:keys [name sex age person-uri gender]}]
test/data/non_printable_results.clj:            (graph (base-graph "example")
test/data/non_printable_results.clj:                   [person-uri
test/data/non_printable_results.clj:(defpipe my-pipe
test/data/non_printable_results.clj:  [data-file]
test/data/non_printable_results.clj:  (-> (read-dataset data-file :format :csv)
test/data/non_printable_results.clj:      (drop-rows 1)
test/data/non_printable_results.clj:      (make-dataset [:name :sex :age])
test/data/non_printable_results.clj:      (derive-column :person-uri [:name] base-id)
test/data/non_printable_results.clj:      (mapc {:age ->integer
test/data/non_printable_results.clj:(defgraft my-graft
test/data/non_printable_results.clj:  my-pipe make-graph)
test/graftwerk/example.clj:(defn ->integer
test/graftwerk/example.clj:(def base-domain (prefixer "http://my-domain.com"))
test/graftwerk/example.clj:(def base-graph (prefixer (base-domain "/graph/")))
test/graftwerk/example.clj:(def base-id (prefixer (base-domain "/id/")))
test/graftwerk/example.clj:(def base-vocab (prefixer (base-domain "/def/")))
test/graftwerk/example.clj:(def base-data (prefixer (base-domain "/data/")))
test/graftwerk/example.clj:(def make-graph
test/graftwerk/example.clj:  (graph-fn [{:keys [name sex age person-uri gender]}]
test/graftwerk/example.clj:            (graph (base-graph "example")
test/graftwerk/example.clj:                   [person-uri
test/graftwerk/example.clj:(defpipe convert-persons-data
test/graftwerk/example.clj:  [data-file]
test/graftwerk/example.clj:  (-> (read-dataset data-file :format :csv)
test/graftwerk/example.clj:      (drop-rows 1)
test/graftwerk/example.clj:      (make-dataset [:name :sex :age])
test/graftwerk/example.clj:      (derive-column :person-uri [:name] base-id)
test/graftwerk/example.clj:      (mapc {:age ->integer
test/graftwerk/example.clj:(defgraft convert-persons-data-to-graph
test/graftwerk/example.clj:  convert-persons-data make-graph)
test/graftwerk/handler_test.clj:(ns graftwerk.handler-test
test/graftwerk/handler_test.clj:(deftest test-app
test/graftwerk/handler_test.clj:  (testing "not-found route"
test/graftwerk/routes/evaluate_test.clj:(ns graftwerk.routes.evaluate-test
test/graftwerk/routes/evaluate_test.clj:            [graftwerk.middleware :refer [common-api-middleware]]
test/graftwerk/routes/evaluate_test.clj:            [graftwerk.middleware.dataset :refer [wrap-write-dataset]]
test/graftwerk/routes/evaluate_test.clj:            [ring.middleware.multipart-params :refer [multipart-params-request]]
test/graftwerk/routes/evaluate_test.clj:            [grafter.tabular :refer [make-dataset]]
test/graftwerk/routes/evaluate_test.clj:(defn stream->string
test/graftwerk/routes/evaluate_test.clj:  ;; http://stackoverflow.com/questions/309424/read-convert-an-inputstream-to-a-string
test/graftwerk/routes/evaluate_test.clj:    (if (-> scanner .hasNext)
test/graftwerk/routes/evaluate_test.clj:(def preview-response-schema {:bindings {(s/optional-key :strs) [s/Symbol]
test/graftwerk/routes/evaluate_test.clj:                                         (s/optional-key :keys) [s/Symbol]}
test/graftwerk/routes/evaluate_test.clj:(defn stub-multipart-file [file-path]
test/graftwerk/routes/evaluate_test.clj:  {:tempfile (io/file file-path)})
test/graftwerk/routes/evaluate_test.clj:(deftest preview-graft-test
test/graftwerk/routes/evaluate_test.clj:  (is (s/validate preview-response-schema
test/graftwerk/routes/evaluate_test.clj:                  (preview-graft-with-row 1 (stub-multipart-file "./test/data/example-data.csv") "my-graft" (stub-multipart-file "./test/data/example_pipeline.clj") false))))
test/graftwerk/routes/evaluate_test.clj:(deftest stop-hacking-attempts-test
test/graftwerk/routes/evaluate_test.clj:     (preview-graft-with-row 1 (stub-multipart-file "./test/data/example-data.csv") "my-graft" (stub-multipart-file "./test/data/haxor_pipeline.clj") false)
test/graftwerk/routes/evaluate_test.clj:(defn get-file-request-data [path content-type]
test/graftwerk/routes/evaluate_test.clj:     :content-type content-type}))
test/graftwerk/routes/evaluate_test.clj:(defn add-multipart [request part-key part-value]
test/graftwerk/routes/evaluate_test.clj:  (assoc-in request [:params part-key] part-value))
test/graftwerk/routes/evaluate_test.clj:(defn evaluate-request [path command]
test/graftwerk/routes/evaluate_test.clj:  (-> (req/request :post path)
test/graftwerk/routes/evaluate_test.clj:      (add-multipart :pipeline (get-file-request-data "./test/data/example_pipeline.clj" app:edn))
test/graftwerk/routes/evaluate_test.clj:      (add-multipart :data (get-file-request-data "./test/data/example-data.csv" app:csv))
test/graftwerk/routes/evaluate_test.clj:      (add-multipart :command command)))
test/graftwerk/routes/evaluate_test.clj:(defn add-param [req param value]
test/graftwerk/routes/evaluate_test.clj:  (assoc-in req [:params param] value))
test/graftwerk/routes/evaluate_test.clj:(deftest paginate-seq-test
test/graftwerk/routes/evaluate_test.clj:  (let [results (paginate-seq (range 100) "10" "2")]
test/graftwerk/routes/evaluate_test.clj:(deftest paginate-test
test/graftwerk/routes/evaluate_test.clj:  (let [ds (make-dataset (repeat 100 [:a :b :c]))]
test/graftwerk/routes/evaluate_test.clj:(deftest pipe-route-test
test/graftwerk/routes/evaluate_test.clj:  (let [pipe-route (common-api-middleware pipe-route)]
test/graftwerk/routes/evaluate_test.clj:      (let [test-request (evaluate-request "/evaluate/pipe" "my-pipe")
test/graftwerk/routes/evaluate_test.clj:            {:keys [status body]} (pipe-route test-request)]
test/graftwerk/routes/evaluate_test.clj:        (is (= [:name :sex :age :person-uri] (:column-names body)))))
test/graftwerk/routes/evaluate_test.clj:      (let [test-request (-> (evaluate-request "/evaluate/pipe" "my-pipe")
test/graftwerk/routes/evaluate_test.clj:                             (add-param :page "foo"))
test/graftwerk/routes/evaluate_test.clj:            response (pipe-route test-request)]
test/graftwerk/routes/evaluate_test.clj:(deftest pipe-route-unprintable-test
test/graftwerk/routes/evaluate_test.clj:  ;; NOTE we mix on the extra wrap-write-dataset middleware here to convert types into UnreadableForms
test/graftwerk/routes/evaluate_test.clj:  (let [pipe-route (wrap-write-dataset (common-api-middleware pipe-route))]
test/graftwerk/routes/evaluate_test.clj:      (let [test-request (-> (req/request :post "/evaluate/pipe")
test/graftwerk/routes/evaluate_test.clj:                             (add-multipart :pipeline (get-file-request-data "./test/data/non_printable_results.clj" app:edn))
test/graftwerk/routes/evaluate_test.clj:                             (add-multipart :data (get-file-request-data "./test/data/example-data.csv" app:csv))
test/graftwerk/routes/evaluate_test.clj:                             (add-multipart :command "my-pipe"))
test/graftwerk/routes/evaluate_test.clj:            {:keys [status body] :as response} (pipe-route test-request)]
test/graftwerk/routes/evaluate_test.clj:                       (->  (stream->string body)
test/graftwerk/routes/evaluate_test.clj:                            read-string
test/graftwerk/routes/evaluate_test.clj:(def quad-schema {:s s/Any :p s/Any :o s/Any :c s/Any})
test/graftwerk/routes/evaluate_test.clj:(deftest graft-route-test
test/graftwerk/routes/evaluate_test.clj:    (let [graft-route (common-api-middleware graft-route)]
test/graftwerk/routes/evaluate_test.clj:        (let [test-request (evaluate-request "/evaluate/graft" "my-graft")
test/graftwerk/routes/evaluate_test.clj:              {:keys [status body] :as response} (graft-route test-request)]
test/graftwerk/routes/evaluate_test.clj:          (is (s/validate [quad-schema] body))))
test/graftwerk/routes/evaluate_test.clj:        (let [test-request (-> (evaluate-request "/evaluate/graft" "my-graft")
test/graftwerk/routes/evaluate_test.clj:                               (add-param :row "foo"))
test/graftwerk/routes/evaluate_test.clj:              response (graft-route test-request)]
test/graftwerk/routes/evaluate_test.clj:(deftest graft-preview-route-test
test/graftwerk/routes/evaluate_test.clj:    (let [graft-route (common-api-middleware graft-route)]
test/graftwerk/routes/evaluate_test.clj:        (let [test-request (-> (evaluate-request "/evaluate/graft" "my-graft")
test/graftwerk/routes/evaluate_test.clj:                               (add-param :row "0"))
test/graftwerk/routes/evaluate_test.clj:              {:keys [status body] :as response} (graft-route test-request)]
test/graftwerk/routes/evaluate_test.clj:          (is (s/validate preview-response-schema body)
test/graftwerk/validations_test.clj:(ns graftwerk.validations-test
test/graftwerk/validations_test.clj:(def valid-params {:page 1
test/graftwerk/validations_test.clj:                   :command "my-foo-pipe-or-graft"})
test/graftwerk/validations_test.clj:(defn dissoc-in
test/graftwerk/validations_test.clj:  "Yes this is really missing from clojure.core :-()"
test/graftwerk/validations_test.clj:  (update-in m (drop-last path) (fn [v] (dissoc v (last path)))))
test/graftwerk/validations_test.clj:(deftest validate-pipe-run-request-test
test/graftwerk/validations_test.clj:         (validate-pipe-run-request valid-params))))
test/graftwerk/validations_test.clj:    (is (validate-pipe-run-request (assoc valid-params :page "foo"))
test/graftwerk/validations_test.clj:    (is (not (-> valid-params
test/graftwerk/validations_test.clj:                 (dissoc-in [:pipeline :filename])
test/graftwerk/validations_test.clj:                 validate-pipe-run-request
test/graftwerk/validations_test.clj:(deftest validate-graft-run-request-test
test/graftwerk/validations_test.clj:         (validate-graft-run-request valid-params))))
test/graftwerk/validations_test.clj:    (is (validate-graft-run-request (assoc valid-params :page "foo"))
test/graftwerk/validations_test.clj:    (is (not (-> valid-params
test/graftwerk/validations_test.clj:                 (dissoc-in [:pipeline :filename])
test/graftwerk/validations_test.clj:                 validate-graft-run-request
